rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========== 组织和活动（只读）==========
    match /organizations/{orgId} {
      // 允许所有人读取组织信息
      allow read: if true;
      // 只有认证用户可以写入
      allow write: if request.auth != null;
      
      // 活动子集合
      match /events/{eventId} {
        // 允许所有人读取活动信息
        allow read: if true;
        // 只有认证用户可以写入
        allow write: if request.auth != null;
        
        // 活动用户子集合
        match /users/{userId} {
          // 允许读取
          allow read: if true;
          // 只有认证用户可以写入
          allow write: if request.auth != null;
        }
      }
    }
    
    // ========== 系统配置（只读）==========
    match /system_config/{docId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // ========== 用户集合 ==========
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // ========== 管理员白名单（只读）==========
    match /admin_uids/{uid} {
      allow read: if request.auth != null;
      allow write: if false;
    }
    
    // ========== 其他集合默认拒绝 ==========
    match /{document=**} {
      allow read, write: if false;
    }
  }
}