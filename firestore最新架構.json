{
  "firestoreArchitecture": {
    "description": "MyBazaar æ…ˆå–„ä¹‰å–ç®¡ç†ç³»ç»Ÿ - Firestore æ•°æ®æ¶æ„ï¼ˆå®Œå…¨æ­£ç¡®ç‰ˆï¼‰",
    "version": "2025-12-27-v7",
    "lastUpdated": "2025-12-27",
    "architectureChanges": {
      "version_2025-12-27-v7": [
        "ğŸ†• æ–°å¢ pointSeller è§’è‰²ï¼ˆç‚¹æ•°å¡é”€å”®å‘˜ï¼‰",
        "ğŸ’° å¤§å¹…æ‰©å…… financeManager è§’è‰²ç»Ÿè®¡å­—æ®µ",
        "ğŸ“Š events.financeSummary: å®Œæ•´è´¢åŠ¡æ±‡æ€»å¯¹è±¡",
        "ğŸ“ˆ events.roleStats: æ–°å¢ pointSellers å’Œ financeManagers ç»Ÿè®¡",
        "ğŸ“ cashSubmissions é›†åˆï¼šå®Œæ•´æ–‡æ¡£ç»“æ„å®šä¹‰ï¼ˆç¬¬ 969 è¡Œï¼‰",
        "âš¡ æ–°å¢ 8 ä¸ª Cloud Functions",
        "ğŸ”’ Security Rules æ›´æ–°",
        "ğŸ“‘ æ–°å¢ 5 ä¸ªç´¢å¼•",
        "ğŸ¯ å®Œå–„ç°é‡‘æµç®¡ç†ä½“ç³»"
      ],
      "version_2025-12-26-v6": [
        "ğŸ” Customerä»˜æ¬¾å’Œè½¬è´¦ä»OTPéªŒè¯æ”¹ä¸ºPINç ï¼ˆäº¤æ˜“å¯†ç ï¼‰éªŒè¯",
        "transactionsé›†åˆï¼šotpVerified/otpSessionId æ”¹ä¸º pinVerified/pinVerifiedAt/verificationMethod",
        "processCustomerPaymentå’ŒtransferPointså‡½æ•°ï¼šå‚æ•°ä»otpSessionIdæ”¹ä¸ºtransactionPin",
        "æ–°å¢ verifyTransactionPinInternal å’Œ updatePinVerificationStatus è¾…åŠ©å‡½æ•°",
        "platform_settings.otpRequiredï¼šæ ‡æ³¨customerPaymentå’ŒcustomerTransferå·²å¼ƒç”¨OTP",
        "æ”¯æŒbcryptå’ŒSHA256åŒé‡åŠ å¯†æ–¹å¼ï¼ˆå‘åå…¼å®¹ï¼‰",
        "PINéªŒè¯å¤±è´¥æœºåˆ¶ï¼š5æ¬¡å¤±è´¥é”å®š1å°æ—¶",
        "æå‡å®‰å…¨æ€§ï¼šåç«¯ç»Ÿä¸€éªŒè¯ï¼Œæ— éœ€çŸ­ä¿¡æˆæœ¬"
      ],
      "version_2025-12-17-v5": [
        "æ–°å¢ platform_settings é¡¶å±‚é›†åˆï¼ˆPlatformçº§åˆ«OTPé…ç½®ï¼‰",
        "æ–°å¢ pointCards Eventå­é›†åˆï¼ˆä¸è®°åç‚¹æ•°å¡ï¼‰",
        "æ‰©å…… otp_sessions é›†åˆä¸ºé€šç”¨OTPç³»ç»Ÿ",
        "å¤§å¹…æ‰©å…… users.customer æ•°æ®ç»“æ„",
        "transactions æ–°å¢ä¸‰ç§äº¤æ˜“ç±»å‹ï¼šcustomer_transfer, point_card_payment, point_card_topup",
        "Event.roleStats.customers æ–°å¢è¯¦ç»†ç»Ÿè®¡å­—æ®µ",
        "æ–°å¢6ä¸ªCustomerç›¸å…³Cloud Functions",
        "å®Œæ•´æ”¯æŒCustomerDashboardåŠŸèƒ½"
      ],
      "version_2025-12-08-v4": [
        "å®Œå…¨ç§»é™¤ Event.contactPerson å­—æ®µ",
        "Event Manager æœ¬èº«å°±æ˜¯æ´»åŠ¨è”ç»œäººï¼Œå…¶ basicInfo å³ä¸ºå¯¹å¤–è”ç»œä¿¡æ¯",
        "users.identityInfo æ–°å¢ position å­—æ®µï¼ˆèŒä½ï¼‰",
        "Organization.contact åœ¨åˆ›å»ºç»„ç»‡æ—¶å¡«å†™ï¼ˆç»„ç»‡ä¸»è¦è”ç³»äººï¼‰",
        "åˆ›å»º Event æ—¶åŒæ—¶åˆ›å»º Event Managerï¼ˆæ´»åŠ¨è´Ÿè´£äººå³è”ç»œäººï¼‰",
        "ç®€åŒ–æ¶æ„ï¼šä¸éœ€è¦é¢å¤–çš„ contactPerson æˆ– contactPersons æ•°ç»„",
        "Event æ–‡æ¡£ä¸­å®Œå…¨ç§»é™¤ contactPersonï¼ŒEvent Manager æœ¬èº«å°±æ˜¯æ´»åŠ¨è”ç»œäºº",
        "Event Manager ä» Event.eventManager å¯¹è±¡ç§»åˆ° users é›†åˆ",
        "Event æ–‡æ¡£ä¸­ç§»é™¤ eventManager å¯¹è±¡ï¼Œæ”¹ä¸º contactPersonï¼ˆçº¯è”ç»œç”¨é€”ï¼‰",
        "Event Manager æˆä¸º users é›†åˆä¸­çš„ç‰¹æ®Šè§’è‰²ï¼Œä¸ Finance Manager å½¢æˆåˆ¶è¡¡",
        "Event Manager ä¸åˆ†é…ç‚¹æ•°ï¼Œçº¯ç›‘æ§æ‰€æœ‰äººå‘˜æ•°æ®",
        "åˆ é™¤ Event çº§åˆ«çš„ pointAllocations é›†åˆ",
        "Seller Manager åªç®¡ç† studentsï¼Œåªèƒ½å•äººåˆ†é…",
        "Platform Admin åˆ›å»º Event æ—¶æ‰‹åŠ¨è¾“å…¥ contactPerson ä¿¡æ¯"
      ],
      "version_2025-11-28-v2": [
        "ä¿®æ­£ Event é›†åˆè·¯å¾„ï¼šä»é¡¶çº§é›†åˆæ”¹ä¸º Organization çš„å­é›†åˆ",
        "ä¿®æ­£æ‰€æœ‰å­é›†åˆè·¯å¾„ï¼šusers, pointAllocations, departmentStats ç­‰éƒ½åœ¨ Event ä¸‹",
        "å®Œæ•´è·¯å¾„ç¤ºä¾‹ï¼šorganizations/{orgId}/events/{eventId}/users/{userId}",
        "æ·»åŠ  admin_uids é›†åˆï¼Œæ˜ç¡® Platform Admin å­˜å‚¨ä½ç½®",
        "Organization é›†åˆï¼šåˆ é™¤ adminUsers å­—æ®µï¼Œæ·»åŠ  contact è”ç³»äººä¿¡æ¯",
        "Event.eventManagerï¼šä» admins æ•°ç»„æ”¹ä¸ºå•ä¸ªå¯¹è±¡ï¼ŒåŒ…å«è¯¦ç»†ä¿¡æ¯å’Œç™»å½•å¯†ç ",
        "åˆ é™¤ GlobalUsers é›†åˆï¼Œç®€åŒ–æ¶æ„ï¼ˆç”¨æˆ·åªå‚ä¸å•ä¸ª Eventï¼‰",
        "æ˜ç¡®ä¸‰å±‚æƒé™æ¶æ„ï¼šPlatform Admin -> Organization -> Event (Event Manager)"
      ]
    },
    "keyArchitecturePrinciples": {
      "hierarchicalStructure": "organizations/{orgId}/events/{eventId}/users/{userId}",
      "dataIsolation": "æ¯ä¸ª Organization çš„æ•°æ®å®Œå…¨éš”ç¦»",
      "eventManager": "æ¯ä¸ª Event åªæœ‰ä¸€ä¸ª Event Managerï¼Œå­˜å‚¨åœ¨ users é›†åˆä¸­ï¼Œé€šè¿‡ roles è¯†åˆ«",
      "contactPerson": "Event Manager æœ¬èº«å°±æ˜¯æ´»åŠ¨è”ç»œäººï¼Œæ— éœ€é¢å¤–çš„ contactPerson å­—æ®µ",
      "subcollections": "users, departmentStats, sellerManagerStats ç­‰éƒ½æ˜¯ Event çš„å­é›†åˆ"
    },
    "collections": {
      "admin_uids": {
        "path": "admin_uids/{adminUid}",
        "description": "å¹³å°ç®¡ç†å‘˜ï¼ˆPlatform Adminï¼‰ä¿¡æ¯",
        "level": "Platform",
        "documentStructure": {
          "adminUid": "string (Platform Adminçš„è®¤è¯UIDï¼Œæ–‡æ¡£ID)",
          "email": "string (é‚®ç®±)",
          "phoneNumber": "string (ç”µè¯å·ç )",
          "displayName": "string (æ˜¾ç¤ºåç§°ï¼Œå¯é€‰)",
          "role": "string (å›ºå®šå€¼ï¼š'platformAdmin')",
          "isActive": "boolean (æ˜¯å¦æ¿€æ´»)",
          "permissions": "array (æƒé™åˆ—è¡¨ï¼Œå¯é€‰)",
          "createdAt": "timestamp (åˆ›å»ºæ—¶é—´)",
          "lastLoginAt": "timestamp (æœ€åç™»å½•æ—¶é—´)"
        },
        "indexes": [
          "email",
          "isActive"
        ],
        "securityRules": "åªæœ‰å·²è®¤è¯çš„Platform Adminå¯ä»¥è¯»å–ï¼›åˆ›å»ºå’Œä¿®æ”¹éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™"
      },
      "organizations": {
        "path": "organizations/{organizationId}",
        "description": "ç»„ç»‡ï¼ˆå­¦æ ¡ï¼‰åŸºæœ¬ä¿¡æ¯",
        "level": "Organization",
        "documentStructure": {
          "organizationId": "string (è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID)",
          "orgCode": "string (ç»„ç»‡ä»£ç ï¼Œå¦‚ 'chhs')",
          "orgName": {
            "zh-CN": "string (ä¸­æ–‡åç§°)",
            "en-US": "string (è‹±æ–‡åç§°ï¼Œå¯é€‰)"
          },
          "orgType": "string ('school' | 'community' | 'company')",
          "address": {
            "street": "string",
            "city": "string",
            "state": "string",
            "postcode": "string",
            "country": "string (é»˜è®¤ 'Malaysia')"
          },
          "contactInfo": {
            "phone": "string (æœºæ„ç”µè¯)",
            "email": "string (æœºæ„é‚®ç®±)",
            "website": "string (å¯é€‰)"
          },
          "contact": {
            "name": "string (è”ç³»äººå§“å)",
            "phone": "string (è”ç³»ç”µè¯)",
            "email": "string (è”ç³»é‚®ç®±)",
            "position": "string (èŒä½ï¼Œå¦‚'æ ¡é•¿'ã€'ä¸»ä»»')"
          },
          "identityTags": [
            {
              "id": "string (æ ‡ç­¾IDï¼Œå¦‚ 'student')",
              "name": {
                "zh-CN": "string (ä¸­æ–‡åï¼Œå¦‚ 'å­¦ç”Ÿ')",
                "en-US": "string (è‹±æ–‡åï¼Œå¦‚ 'Student')"
              },
              "isActive": "boolean (æ˜¯å¦æ¿€æ´»)",
              "displayOrder": "number (æ˜¾ç¤ºé¡ºåº)"
            }
          ],
          "departments": [
            {
              "id": "string (éƒ¨é—¨IDï¼Œå¦‚ 'J1A')",
              "name": "string (éƒ¨é—¨åç§°ï¼Œå¦‚ 'ä¸€å¹´çº§Aç­')",
              "isActive": "boolean (æ˜¯å¦æ¿€æ´»)",
              "userCount": "number (éƒ¨é—¨ç”¨æˆ·æ•°)",
              "displayOrder": "number (æ˜¾ç¤ºé¡ºåº)",
              "createdBy": "string ('system' | 'manual')",
              "createdAt": "timestamp"
            }
          ],
          "settings": {
            "defaultLanguage": "string (é»˜è®¤ 'zh-CN')",
            "timezone": "string (é»˜è®¤ 'Asia/Kuala_Lumpur')",
            "currency": "string (é»˜è®¤ 'MYR')"
          },
          "statistics": {
            "totalEvents": "number (æ€»æ´»åŠ¨æ•°)",
            "activeEvents": "number (è¿›è¡Œä¸­æ´»åŠ¨æ•°)",
            "totalUsers": "number (æ€»ç”¨æˆ·æ•°)",
            "lastUpdated": "timestamp"
          },
          "status": "string ('active' | 'inactive' | 'suspended')",
          "createdAt": "timestamp",
          "updatedAt": "timestamp",
          "createdBy": "string (Platform Admin UID)"
        },
        "indexes": [
          "orgCode",
          "status"
        ],
        "securityRules": "åªæœ‰ Platform Admin å¯ä»¥åˆ›å»º/ä¿®æ”¹ç»„ç»‡ä¿¡æ¯",
        "subcollections": {
          "events": {
            "path": "organizations/{organizationId}/events/{eventId}",
            "description": "ä¹‰å–æ´»åŠ¨ä¿¡æ¯ï¼ˆOrganization çš„å­é›†åˆï¼‰",
            "level": "Event",
            "documentStructure": {
              "eventId": "string (è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID)",
              "eventCode": "string (æ´»åŠ¨ä»£ç ï¼Œå¦‚ 'ban')",
              "orgCode": "string (ç»„ç»‡ä»£ç ï¼Œå†—ä½™å­—æ®µç”¨äºæŸ¥è¯¢)",
              "eventName": {
                "zh-CN": "string (ä¸­æ–‡åç§°)",
                "en-US": "string (è‹±æ–‡åç§°ï¼Œå¯é€‰)"
              },
              "eventInfo": {
                "description": "string (æ´»åŠ¨æè¿°)",
                "fairDate": "timestamp (å¸‚é›†æ—¥æœŸ)",
                "consumptionPeriod": {
                  "startDate": "timestamp (æ¶ˆè´¹å¼€å§‹æ—¥æœŸ)",
                  "endDate": "timestamp (æ¶ˆè´¹ç»“æŸæ—¥æœŸ)"
                }
              },
              "eventManager": {
                "description": "æ´»åŠ¨è´Ÿè´£äººåŸºæœ¬è”ç»œä¿¡æ¯ï¼ˆä» users é›†åˆå¤åˆ¶ï¼‰",
                "chineseName": "string (ä¸­æ–‡å§“å)",
                "englishName": "string (è‹±æ–‡å§“å)",
                "phoneNumber": "string (è”ç»œç”µè¯)",
                "position": "string (èŒåŠ¡ï¼Œå¦‚ 'æ´»åŠ¨è´Ÿè´£äºº')",
                "note": "æ­¤å­—æ®µä»…ç”¨äºå¿«é€Ÿæ˜¾ç¤ºè”ç»œä¿¡æ¯ï¼Œå®Œæ•´æ•°æ®å­˜å‚¨åœ¨ users é›†åˆä¸­"
              },
              "globalPointsStats": {
                "description": "å…¨å±€ç‚¹æ•°ç»Ÿè®¡ï¼ˆå®æ—¶ç»´æŠ¤ï¼‰",
                "totalAllocated": "number (ç´¯è®¡åˆ†é…çš„ç‚¹æ•°æ€»é¢)",
                "currentCirculation": "number (å½“å‰æµé€šä¸­çš„ç‚¹æ•°)",
                "totalSold": "number (ç´¯è®¡å”®å‡ºç‚¹æ•°)",
                "totalRevenue": "number (ç´¯è®¡é”€å”®é¢ RMï¼Œ1:1æ¯”ä¾‹)",
                "totalCollected": "number (ç´¯è®¡å·²æ”¶æ¬¾é¡¹ RM)",
                "pendingCollection": "number (å¾…æ”¶æ¬¾é¡¹ RM)",
                "collectionRate": "number (æ”¶æ¬¾ç‡ï¼Œ0-1ä¹‹é—´)",
                "lastUpdated": "timestamp",
                "lastCalculated": "timestamp (ä¸Šæ¬¡å®Œæ•´è®¡ç®—æ—¶é—´)"
              },
              "roleStats": {
                "description": "å„è§’è‰²ç»Ÿè®¡ä¿¡æ¯",
                "eventManagers": {
                  "count": "number (Event Manager æ•°é‡ï¼Œå›ºå®šä¸º1)"
                },
                "sellerManagers": {
                  "count": "number (Seller Manager æ•°é‡)",
                  "totalAllocations": "number (ç´¯è®¡åˆ†é…æ¬¡æ•°)",
                  "totalPointsAllocated": "number (ç´¯è®¡åˆ†é…ç‚¹æ•°)",
                  "averageCollectionRate": "number (å¹³å‡æ”¶æ¬¾ç‡)"
                },
                "sellers": {
                  "count": "number (Seller æ€»æ•°)",
                  "activeCount": "number (æœ‰äº¤æ˜“è®°å½•çš„ Seller æ•°)",
                  "totalRevenue": "number (ç´¯è®¡é”€å”®é¢)"
                },
                "merchants": {
                  "count": "number (Merchant æ€»æ•°)",
                  "activeCount": "number (æœ‰äº¤æ˜“è®°å½•çš„ Merchant æ•°)",
                  "totalRevenue": "number (ç´¯è®¡é”€å”®é¢)"
                },
                "customers": {
                  "count": "number (Customeræ€»æ•°)",
                  "activeCount": "number (æœ‰äº¤æ˜“è®°å½•çš„Customeræ•°)",
                  "totalSpent": "number (ç´¯è®¡æ¶ˆè´¹é¢)",
                  "totalTransferred": "number (ç´¯è®¡è½¬è®©ç‚¹æ•°)",
                  "totalPointCardsRedeemed": "number (ç´¯è®¡å…‘æ¢ç‚¹æ•°å¡æ•°é‡)",
                  "averageBalance": "number (å¹³å‡ä½™é¢)",
                  "totalBalance": "number (æ‰€æœ‰Customerçš„ç‚¹æ•°æ€»å’Œ)",
                  "lastUpdated": "timestamp"
                },
                "pointSellers": {
                  "count": "number (PointSeller æ€»æ•°)",
                  "activeCount": "number (æ´»è·ƒçš„ PointSeller æ•°)",
                  "totalCardsIssued": "number (æ€»å‘è¡Œå¡æ•°)",
                  "totalPointsIssued": "number (æ€»å‘è¡Œç‚¹æ•°)",
                  "totalCashReceived": "number (æ€»æ”¶åˆ°ç°é‡‘ RM)",
                  "averageCardsPerSeller": "number (å¹³å‡æ¯ä½ PointSeller å‘è¡Œå¡æ•°)",
                  "lastUpdated": "timestamp"
                },
                "financeManagers": {
                  "count": "number (FinanceManager æ€»æ•°)",
                  "activeCount": "number (æ´»è·ƒçš„ FinanceManager æ•°)",
                  "totalCashCollected": "number (æ€»æ”¶æ¬¾ RM)",
                  "totalCollections": "number (æ€»æ”¶æ¬¾ç¬”æ•°)",
                  "pendingConfirmations": "number (å¾…ç¡®è®¤ç¬”æ•°)",
                  "lastUpdated": "timestamp"
                }
              },
              "departmentOverview": {
                "description": "éƒ¨é—¨æ¦‚è§ˆç»Ÿè®¡",
                "totalDepartments": "number (éƒ¨é—¨æ€»æ•°)",
                "topPerformers": [
                  {
                    "departmentCode": "string",
                    "departmentName": "string",
                    "totalRevenue": "number",
                    "collectionRate": "number"
                  }
                ],
                "lowestCollectionRate": {
                  "departmentCode": "string",
                  "departmentName": "string",
                  "collectionRate": "number"
                }
              },
              "statistics": {
                "totalUsers": "number (æ€»ç”¨æˆ·æ•°)",
                "totalManagers": "number (ç®¡ç†å‘˜æ€»æ•°)",
                "totalSellers": "number (Seller æ€»æ•°)",
                "totalMerchants": "number (Merchant æ€»æ•°)",
                "totalCustomers": "number (Customer æ€»æ•°)",
                "lastUpdated": "timestamp"
              },
              "cashCollections": {
                "description": "ç°é‡‘æ”¶æ¬¾ç»Ÿè®¡",
                "totalSubmitted": "number (ç´¯è®¡ä¸Šäº¤ç°é‡‘ RM)",
                "totalVerified": "number (ç´¯è®¡éªŒè¯ç°é‡‘ RM)",
                "pendingVerification": "number (å¾…éªŒè¯ç°é‡‘ RM)",
                "lastUpdated": "timestamp"
              },
              "// === è´¢åŠ¡æ±‡æ€» ===": "",
              "financeSummary": {
                "// === ç‚¹æ•°ç»Ÿè®¡ ===": "",
                "points": {
                  "totalAllocated": "number (æ€»åˆ†é…ç‚¹æ•°)",
                  "totalSold": "number (æ€»é”€å”®ç‚¹æ•° - Seller å”®ç»™ Customer)",
                  "totalSpent": "number (æ€»æ¶ˆè´¹ç‚¹æ•° - Customer åœ¨ Merchant æ¶ˆè´¹)",
                  "totalFromPointCards": "number (ç‚¹æ•°å¡å‘è¡Œæ€»ç‚¹æ•°)",
                  "remainingInSystem": "number (ç³»ç»Ÿä¸­å‰©ä½™ç‚¹æ•°)"
                },
                "// === ç°é‡‘ç»Ÿè®¡ ===": "",
                "cash": {
                  "// é¢„æœŸæ”¶æ¬¾": "",
                  "expectedFromSales": "number (é”€å”®é¢„æœŸæ”¶æ¬¾ RM = totalSold)",
                  "expectedFromPointCards": "number (ç‚¹æ•°å¡é¢„æœŸæ”¶æ¬¾ RM = totalFromPointCards)",
                  "totalExpected": "number (æ€»é¢„æœŸæ”¶æ¬¾ RM)",
                  "// å®é™…æ”¶æ¬¾": "",
                  "collectedFromSellers": "number (ä» Seller æ”¶åˆ°çš„ç°é‡‘ RM)",
                  "collectedFromSellerManagers": "number (ä» SellerManager æ”¶åˆ°çš„ç°é‡‘ RM)",
                  "collectedFromPointSellers": "number (ä» PointSeller æ”¶åˆ°çš„ç°é‡‘ RM)",
                  "totalCollected": "number (æ€»å®é™…æ”¶æ¬¾ RM)",
                  "// å¾…æ”¶æ¬¾": "",
                  "pendingFromSellers": "number (Seller å¾…ä¸Šäº¤ RM)",
                  "pendingFromSellerManagers": "number (SellerManager å¾…ä¸Šäº¤ RM)",
                  "pendingFromPointSellers": "number (PointSeller å¾…ä¸Šäº¤ RM)",
                  "totalPending": "number (æ€»å¾…æ”¶æ¬¾ RM)",
                  "// æœªæ”¶æ¬¾": "",
                  "outstandingCash": "number (æœªæ”¶æ¬¾ RM = totalExpected - totalCollected - totalPending)"
                },
                "// === å¯¹è´¦ç‡ ===": "",
                "reconciliation": {
                  "collectionRate": "number (æ”¶æ¬¾ç‡ = totalCollected / totalExpected)",
                  "salesCollectionRate": "number (é”€å”®æ”¶æ¬¾ç‡)",
                  "pointCardCollectionRate": "number (ç‚¹æ•°å¡æ”¶æ¬¾ç‡)",
                  "lastReconciled": "timestamp (æœ€åå¯¹è´¦æ—¶é—´)",
                  "isBalanced": "boolean (æ˜¯å¦å¹³è¡¡)",
                  "discrepancy": "number (å·®å¼‚é‡‘é¢ RM)"
                },
                "// === æ”¶æ¬¾åˆ†å¸ƒ ===": "",
                "collectionsByFinanceManager": {
                  "<financeManagerId>": {
                    "managerName": "string (Finance Manager å§“å)",
                    "totalCollected": "number (æ€»æ”¶æ¬¾ RM)",
                    "collectionsCount": "number (æ”¶æ¬¾ç¬”æ•°)",
                    "lastCollection": "timestamp (æœ€åæ”¶æ¬¾æ—¶é—´)",
                    "cashSources": {
                      "fromSellers": "number (æ¥è‡ª Seller RM)",
                      "fromSellerManagers": "number (æ¥è‡ª SellerManager RM)",
                      "fromPointSellers": "number (æ¥è‡ª PointSeller RM)"
                    }
                  }
                },
                "// === ç‚¹æ•°å¡æ±‡æ€» ===": "",
                "pointCardSummary": {
                  "totalCardsIssued": "number (æ€»å‘è¡Œå¡æ•°)",
                  "totalPointsIssued": "number (æ€»å‘è¡Œç‚¹æ•°)",
                  "totalCashFromCards": "number (ç‚¹æ•°å¡æ”¶åˆ°ç°é‡‘ RM)",
                  "activeCards": "number (æœ‰æ•ˆå¡ç‰‡æ•°)",
                  "usedCards": "number (å·²ä½¿ç”¨å¡ç‰‡æ•°)",
                  "expiredCards": "number (å·²è¿‡æœŸå¡ç‰‡æ•°)",
                  "destroyedCards": "number (å·²é”€æ¯å¡ç‰‡æ•°)",
                  "unusedBalance": "number (æœªä½¿ç”¨ä½™é¢)",
                  "lastUpdated": "timestamp"
                },
                "// === æ›´æ–°ä¿¡æ¯ ===": "",
                "lastUpdatedAt": "timestamp (æœ€åæ›´æ–°æ—¶é—´)",
                "lastUpdatedBy": "string (æœ€åæ›´æ–°è€… userId)"
              },
              "status": "string ('planning' | 'active' | 'completed' | 'cancelled')",
              "createdAt": "timestamp",
              "updatedAt": "timestamp",
              "createdBy": "string (Platform Admin UID)"
            },
            "indexes": [
              "orgCode",
              "eventCode",
              "status",
              "eventInfo.fairDate"
            ],
            "securityRules": "Platform Admin å¯ä»¥åˆ›å»ºæ´»åŠ¨ï¼›Event Manager å¯ä»¥ç®¡ç†æ´»åŠ¨å†…å®¹",
            "subcollections": {
              "users": {
                "path": "organizations/{organizationId}/events/{eventId}/users/{userId}",
                "description": "æ´»åŠ¨å‚ä¸è€…ä¿¡æ¯ï¼ˆEvent çš„å­é›†åˆï¼‰",
                "documentStructure": {
                  "userId": "string (Firebase Auth UIDï¼Œæ–‡æ¡£ID)",
                  "authUid": "string (è®¤è¯UIDï¼Œä¸userIdç›¸åŒ)",
                  "roles": [
                    "string ('eventManager' | 'sellerManager' | 'merchantManager' | 'customerManager' | 'financeManager' | 'pointSeller' | 'seller' | 'merchant' | 'customer')"
                  ],
                  "identityTag": "string ('student' | 'teacher' | 'parent' | 'staff' | 'volunteer' | 'external')",
                  "identityInfo": {
                    "identityId": "string (èº«ä»½ç¼–å·ï¼Œå¦‚å­¦å·ã€å·¥å·)",
                    "identityTag": "string (èº«ä»½æ ‡ç­¾)",
                    "identityName": "string (èº«ä»½åç§°)",
                    "department": "string (éƒ¨é—¨ä»£ç )",
                    "position": "string (èŒä½ï¼Œå¦‚ 'æ´»åŠ¨è´Ÿè´£äºº'ã€'ç­ä¸»ä»»'ï¼Œå¯é€‰)"
                  },
                  "basicInfo": {
                    "phoneNumber": "string (ç”µè¯å·ç ï¼Œ+60æ ¼å¼)",
                    "englishName": "string (è‹±æ–‡å)",
                    "chineseName": "string (ä¸­æ–‡å)",
                    "email": "string (é‚®ç®±ï¼Œå¯é€‰)",
                    "isPhoneVerified": "boolean (ç”µè¯æ˜¯å¦éªŒè¯)",
                    "COMMENT_LOGIN_PASSWORD": "========== ç™»å½•å¯†ç ç›¸å…³å­—æ®µ ==========",
                    "passwordHash": "string (ç™»å½•å¯†ç çš„å“ˆå¸Œå€¼ï¼Œä½¿ç”¨ bcryptï¼Œcost factor 10-12)",
                    "passwordSalt": "string (ç™»å½•å¯†ç çš„ç›å€¼ï¼Œbcrypt è‡ªåŠ¨ç”Ÿæˆ)",
                    "isFirstLogin": "boolean (æ˜¯å¦é¦–æ¬¡ç™»å½•ï¼Œæ‰¹é‡å¯¼å…¥ç”¨æˆ·é»˜è®¤ trueï¼Œæ³¨å†Œç”¨æˆ·é»˜è®¤ false)",
                    "hasDefaultPassword": "boolean (æ˜¯å¦ä½¿ç”¨é»˜è®¤å¯†ç ï¼Œæ‰¹é‡å¯¼å…¥ç”¨æˆ·é»˜è®¤ trueï¼Œé»˜è®¤å¯†ç ä¸º orgId+eventId)",
                    "passwordLastChanged": "timestamp (å¯†ç æœ€åä¿®æ”¹æ—¶é—´ï¼Œå¯é€‰)",
                    "COMMENT_TRANSACTION_PIN": "========== äº¤æ˜“å¯†ç ç›¸å…³å­—æ®µ ==========",
                    "transactionPinHash": "string (äº¤æ˜“å¯†ç çš„å“ˆå¸Œå€¼ï¼Œ6ä½æ•°å­—ï¼Œä½¿ç”¨ bcrypt)",
                    "transactionPinSalt": "string (äº¤æ˜“å¯†ç çš„ç›å€¼ï¼Œbcrypt è‡ªåŠ¨ç”Ÿæˆ)",
                    "pinFailedAttempts": "number (äº¤æ˜“å¯†ç è¿ç»­é”™è¯¯æ¬¡æ•°ï¼Œé»˜è®¤ 0ï¼Œ5æ¬¡åé”å®š1å°æ—¶)",
                    "pinLockedUntil": "timestamp (äº¤æ˜“å¯†ç é”å®šåˆ°æœŸæ—¶é—´ï¼Œå¯é€‰)",
                    "pinLastChanged": "timestamp (äº¤æ˜“å¯†ç æœ€åä¿®æ”¹æ—¶é—´ï¼Œå¯é€‰)"
                  },
                  "pointsStats": {
                    "description": "ç‚¹æ•°ç»Ÿè®¡ï¼ˆå®æ—¶ç»´æŠ¤ï¼Œä¸»è¦ç”¨äº seller è§’è‰²ï¼‰",
                    "totalReceived": "number (ç´¯è®¡æ”¶åˆ°çš„ç‚¹æ•°)",
                    "currentBalance": "number (å½“å‰æ‹¥æœ‰ç‚¹æ•°/åº“å­˜)",
                    "totalSold": "number (ç´¯è®¡å·²å”®å‡ºç‚¹æ•°)",
                    "totalRevenue": "number (ç´¯è®¡é”€å”®é¢ RM)",
                    "totalCollected": "number (ç´¯è®¡å·²æ”¶æ¬¾ RM)",
                    "pendingCollection": "number (å¾…æ”¶æ¬¾ RM)",
                    "collectionRate": "number (ä¸ªäººæ”¶æ¬¾ç‡ï¼Œ0-1ä¹‹é—´)",
                    "receivedFromEventManager": "number (ä» Event Manager è·å¾—çš„ç‚¹æ•°)",
                    "receivedFromSellerManager": "number (ä» Seller Manager è·å¾—çš„ç‚¹æ•°)",
                    "lastReceived": "timestamp (æœ€åä¸€æ¬¡æ”¶åˆ°ç‚¹æ•°)",
                    "lastSold": "timestamp (æœ€åä¸€æ¬¡é”€å”®)",
                    "lastCollected": "timestamp (æœ€åä¸€æ¬¡æ”¶æ¬¾)",
                    "lastUpdated": "timestamp"
                  },
                  "seller": {
                    "availablePoints": "number (å½“å‰å¯ç”¨ç‚¹æ•°ä½™é¢)",
                    "totalPointsSold": "number (ç´¯è®¡å”®å‡ºç‚¹æ•°)",
                    "totalRevenue": "number (ç´¯è®¡é”€å”®é¢ RM)",
                    "totalCashCollected": "number (ç´¯è®¡å·²æ”¶ç°é‡‘)",
                    "pendingCollection": "number (å¾…æ”¶æ¬¾é‡‘é¢)",
                    "transactions": "object (äº¤æ˜“è®°å½•)",
                    "totalSubmitted": "number (ç´¯è®¡æäº¤ç°é‡‘)",
                    "collectionAlert": {
                      "hasWarning": "boolean (æ˜¯å¦æœ‰æ”¶æ¬¾è­¦ç¤º)",
                      "warningLevel": "string ('none' | 'low' | 'medium' | 'high')",
                      "pendingAmount": "number (å¾…æ”¶æ¬¾é‡‘é¢)",
                      "pendingRatio": "number (å¾…æ”¶æ¬¾æ¯”ä¾‹ 0-1)"
                    }
                  },
                  "merchant": {
                    "merchantId": "string (å…³è”çš„ merchant æ–‡æ¡£ ID)",
                    "stallName": "string (æ‘Šä½åç§°ï¼Œå†—ä½™å­—æ®µ)",
                    "permissions": {
                      "canViewAllTransactions": "boolean (å¯æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“)",
                      "canEditProfile": "boolean (å¯ç¼–è¾‘æ‘Šä½èµ„æ–™)",
                      "canToggleStatus": "boolean (å¯åˆ‡æ¢è¥ä¸šçŠ¶æ€)"
                    },
                    "statistics": {
                      "totalRevenue": "number (æ€»æ”¶å…¥ï¼Œä¸ merchants åŒæ­¥)",
                      "transactionCount": "number (äº¤æ˜“ç¬”æ•°)",
                      "lastSyncAt": "timestamp (æœ€ååŒæ­¥æ—¶é—´)"
                    }
                  },
                  "customer": {
                    "pointsAccount": {
                      "availablePoints": "number (å¯ç”¨ç‚¹æ•°)",
                      "reservedPoints": "number (é¢„ç•™ç‚¹æ•°)",
                      "totalReceived": "number (ç´¯è®¡è·å¾—)",
                      "totalSpent": "number (ç´¯è®¡æ¶ˆè´¹)",
                      "totalTransferredOut": "number (ç´¯è®¡è½¬å‡º)",
                      "totalTransferredIn": "number (ç´¯è®¡æ¥æ”¶è½¬å…¥)"
                    },
                    "qrCodeData": {
                      "type": "string (å›ºå®šå€¼ 'CUSTOMER_RECEIVE_POINTS')",
                      "version": "string",
                      "userId": "string",
                      "eventId": "string",
                      "organizationId": "string",
                      "generatedAt": "timestamp"
                    },
                    "stats": {
                      "transactionCount": "number (æ€»äº¤æ˜“æ¬¡æ•°)",
                      "merchantPaymentCount": "number (æ”¯ä»˜ç»™Merchantæ¬¡æ•°)",
                      "merchantsVisited": [
                        "array<string> (æ¶ˆè´¹è¿‡çš„å•†å®¶IDåˆ—è¡¨)"
                      ],
                      "pointCardsRedeemed": "number (å…‘æ¢çš„ç‚¹æ•°å¡æ•°é‡)",
                      "pointCardsTopupAmount": "number (ç‚¹æ•°å¡å……å€¼æ€»é¢)",
                      "transfersSent": "number (è½¬è®©æ¬¡æ•°)",
                      "transfersReceived": "number (æ¥æ”¶è½¬è®©æ¬¡æ•°)",
                      "lastActivityAt": "timestamp"
                    }
                  },
                  "eventManager": {
                    "description": "Event Manager è§’è‰²ä¸“ç”¨æ•°æ®",
                    "permissions": {
                      "canManageUsers": "boolean (å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç”¨æˆ·)",
                      "canManageRoles": "boolean (å¯ä»¥åˆ†é…è§’è‰²ç»™ç”¨æˆ·)",
                      "canAssignManagers": "boolean (å¯ä»¥æŒ‡æ´¾ Seller Managerã€Finance Manager)",
                      "canViewAllData": "boolean (å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®)",
                      "canMonitorAll": "boolean (å¯ä»¥ç›‘æ§æ‰€æœ‰äººå‘˜æ´»åŠ¨)",
                      "canModifyEventSettings": "boolean (å¯ä»¥ä¿®æ”¹æ´»åŠ¨è®¾ç½®)"
                    },
                    "restrictions": {
                      "cannotAllocatePoints": "boolean (ä¸èƒ½åˆ†é…ç‚¹æ•°)",
                      "cannotModifyOwnRoles": "boolean (ä¸èƒ½ä¿®æ”¹è‡ªå·±çš„è§’è‰²)",
                      "cannotDeleteSelf": "boolean (ä¸èƒ½åˆ é™¤è‡ªå·±)",
                      "cannotHoldOtherRoles": "boolean (ä¸èƒ½å…¼ä»»å…¶ä»–è§’è‰²)"
                    },
                    "monitoringScope": {
                      "canMonitorFinanceManager": "boolean (å¯ä»¥ç›‘æ§ Finance Manager çš„ç‚¹æ•°åˆ†é…)",
                      "canMonitorSellerManager": "boolean (å¯ä»¥ç›‘æ§ Seller Manager çš„æ”¶æ¬¾æ´»åŠ¨)",
                      "canMonitorAllTransactions": "boolean (å¯ä»¥æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“è®°å½•)",
                      "canViewAllStats": "boolean (å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç»Ÿè®¡æ•°æ®)"
                    },
                    "notes": "Event Manager çº¯ç›‘æ§è§’è‰²ï¼Œä¸å‚ä¸ç‚¹æ•°åˆ†é…å’Œç°é‡‘æµï¼›ä¸ Finance Manager å½¢æˆåˆ¶è¡¡ï¼›æ¯ä¸ª Event åªæœ‰ä¸€ä¸ª Event Manager"
                  },
                  "sellerManager": {
                    "description": "Seller Manager è§’è‰²ä¸“ç”¨æ•°æ®",
                    "totalAllocations": "number (ç´¯è®¡åˆ†é…æ¬¡æ•°)",
                    "totalPointsAllocated": "number (ç´¯è®¡åˆ†é…ç‚¹æ•°)",
                    "managedDepartments": [
                      "string (ç®¡ç†çš„éƒ¨é—¨ä»£ç æ•°ç»„ï¼Œå¦‚ ['J1A', 'J1B'])"
                    ],
                    "managedIdentityTags": [
                      "student"
                    ],
                    "// === ğŸ†• ç°é‡‘ç®¡ç†ç»Ÿè®¡ ===": "",
                    "cashStats": {
                      "// ä»å­¦ç”Ÿæ”¶å–çš„ç°é‡‘": "",
                      "pendingFromSellers": "number (å¾…ç¡®è®¤çš„å­¦ç”Ÿç°é‡‘ RM - å­¦ç”Ÿå·²ä¸Šäº¤ä½†SMæœªç¡®è®¤)",
                      "confirmedFromSellers": "number (å·²ç¡®è®¤çš„å­¦ç”Ÿç°é‡‘ RM - SMå·²ç¡®è®¤æ”¶åˆ°)",
                      "totalReceivedFromSellers": "number (ç´¯è®¡ä»å­¦ç”Ÿæ”¶åˆ°çš„ç°é‡‘ RM)",
                      "lastConfirmedAt": "timestamp (æœ€åç¡®è®¤æ”¶æ¬¾æ—¶é—´)",
                      "// SMæŒæœ‰çš„ç°é‡‘": "",
                      "cashOnHand": "number (SMå½“å‰æŒæœ‰ç°é‡‘ RM - å·²ç¡®è®¤ä½†æœªä¸Šäº¤)",
                      "// SMä¸Šäº¤ç»™Financeçš„ç°é‡‘": "",
                      "totalSubmitted": "number (ç´¯è®¡ä¸Šäº¤ç»™Financeçš„ç°é‡‘ RM)",
                      "pendingSubmission": "number (å¾…Financeç¡®è®¤çš„ç°é‡‘ RM)",
                      "lastSubmittedAt": "timestamp (æœ€åä¸Šäº¤æ—¶é—´)"
                    },
                    "permissions": {
                      "canAllocatePoints": true,
                      "canCollectCash": true,
                      "canViewDepartmentStats": true,
                      "canBatchAllocate": false
                    },
                    "notes": "Seller Manager åªç®¡ç† studentsï¼Œä¸ç®¡ç† teacher/staff",
                    "alerts": {
                      "lowCollectionRate": [
                        "string (ä½æ”¶æ¬¾ç‡è­¦ç¤ºçš„ç”¨æˆ·IDåˆ—è¡¨)"
                      ]
                    },
                    "lastAllocationAt": "timestamp"
                  },
                  "financeManager": {
                    "// === åŸºæœ¬ä¿¡æ¯ ===": "",
                    "managedIdentityTags": [
                      "teacher",
                      "staff",
                      "parent",
                      "...å…¶ä»–éå­¦ç”Ÿèº«ä»½"
                    ],
                    "// === æ”¶æ¬¾ç»Ÿè®¡ ===": "",
                    "cashStats": {
                      "totalCollected": "number (ç´¯è®¡æ”¶æ¬¾æ€»é¢ RM)",
                      "todayCollected": "number (ä»Šæ—¥æ”¶æ¬¾ RM)",
                      "thisWeekCollected": "number (æœ¬å‘¨æ”¶æ¬¾ RM)",
                      "thisMonthCollected": "number (æœ¬æœˆæ”¶æ¬¾ RM)",
                      "totalCollections": "number (ç´¯è®¡æ”¶æ¬¾ç¬”æ•°)",
                      "todayCollections": "number (ä»Šæ—¥æ”¶æ¬¾ç¬”æ•°)",
                      "thisWeekCollections": "number (æœ¬å‘¨æ”¶æ¬¾ç¬”æ•°)",
                      "thisMonthCollections": "number (æœ¬æœˆæ”¶æ¬¾ç¬”æ•°)",
                      "lastCollectionAt": "timestamp (æœ€åæ”¶æ¬¾æ—¶é—´)",
                      "largestCollection": "number (æœ€å¤§å•ç¬”æ”¶æ¬¾ RM)",
                      "averageCollection": "number (å¹³å‡å•ç¬”æ”¶æ¬¾ RM)"
                    },
                    "// === å¾…ç¡®è®¤ç»Ÿè®¡ ===": "",
                    "pendingStats": {
                      "pendingAmount": "number (å¾…ç¡®è®¤é‡‘é¢ RM)",
                      "pendingCount": "number (å¾…ç¡®è®¤ç¬”æ•°)",
                      "oldestPendingDate": "timestamp (æœ€æ—©å¾…ç¡®è®¤æ—¥æœŸ)",
                      "lastReviewedAt": "timestamp (æœ€åå®¡æ ¸æ—¶é—´)"
                    },
                    "// === ç‚¹æ•°å¡ç®¡ç†ç»Ÿè®¡ ===": "",
                    "pointCardStats": {
                      "totalCardsIssued": "number (æ€»å‘è¡Œå¡æ•°)",
                      "totalPointsIssued": "number (æ€»å‘è¡Œç‚¹æ•°)",
                      "totalCashFromCards": "number (ç‚¹æ•°å¡æ”¶åˆ°çš„ç°é‡‘ RM)",
                      "activePointSellers": "number (æ´»è·ƒçš„ PointSeller æ•°é‡)",
                      "lastCheckedAt": "timestamp (æœ€åæ£€æŸ¥æ—¶é—´)",
                      "outstandingCashFromCards": "number (ç‚¹æ•°å¡æœªæ”¶ç°é‡‘ RM)"
                    },
                    "// === ç°é‡‘æ¥æºåˆ†å¸ƒ ===": "",
                    "cashSources": {
                      "fromSellers": "number (æ¥è‡ª Seller çš„ç°é‡‘ RM)",
                      "fromSellerManagers": "number (æ¥è‡ª SellerManager çš„ç°é‡‘ RM)",
                      "fromPointSellers": "number (æ¥è‡ª PointSeller çš„ç°é‡‘ RM)",
                      "lastUpdated": "timestamp"
                    },
                    "// === å·¥ä½œè®°å½• ===": "",
                    "workHistory": [
                      {
                        "date": "string (æ—¥æœŸ YYYY-MM-DD)",
                        "collectionsCount": "number (æ”¶æ¬¾ç¬”æ•°)",
                        "totalAmount": "number (æ€»é‡‘é¢ RM)",
                        "workingHours": "number (å·¥ä½œæ—¶é•¿)",
                        "confirmedCount": "number (ç¡®è®¤ç¬”æ•°)"
                      }
                    ],
                    "// === æƒé™è®¾ç½® ===": "",
                    "permissions": {
                      "canAllocateToIndividual": "boolean (å¯ä»¥å•äººåˆ†é…ç‚¹æ•°)",
                      "canBatchAllocate": "boolean (å¯ä»¥æ‰¹é‡åˆ†é…ç‚¹æ•°)",
                      "canReceiveCash": "boolean (å¯ä»¥æ”¶å–ç°é‡‘)",
                      "canVerifySubmissions": "boolean (å¯ä»¥éªŒè¯ç°é‡‘ä¸Šäº¤)",
                      "canViewAllStats": "boolean (å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç»Ÿè®¡)",
                      "canManagePointCards": "boolean (å¯ä»¥ç®¡ç†ç‚¹æ•°å¡)",
                      "canGenerateReports": "boolean (å¯ä»¥ç”ŸæˆæŠ¥å‘Š)",
                      "canExportData": "boolean (å¯ä»¥å¯¼å‡ºæ•°æ®)"
                    },
                    "// === å…¶ä»– ===": "",
                    "batchAllocationLimit": "number (æ‰¹é‡åˆ†é…é™é¢ï¼Œ0=æ— é™åˆ¶)",
                    "notes": "æ‰€æœ‰ FM éƒ½å¯å•äººåˆ†é…ï¼›æ‰¹é‡åˆ†é…éœ€ç‰¹åˆ«å¼€å¯æƒé™ï¼›è´Ÿè´£æ•´ä¸ªæ´»åŠ¨çš„ç°é‡‘æµç®¡ç†"
                  },
                  "pointSeller": {
                    "description": "PointSeller è§’è‰²ä¸“ç”¨æ•°æ®ï¼ˆç‚¹æ•°å¡é”€å”®å‘˜ï¼‰",
                    "// === åŸºæœ¬ä¿¡æ¯ ===": "",
                    "workingDate": "string (å·¥ä½œæ—¥æœŸï¼ŒYYYY-MM-DDæ ¼å¼)",
                    "workingShift": "string (å·¥ä½œç­æ¬¡ï¼š'morning' | 'afternoon' | 'fullday')",
                    "cashBoxNumber": "string (ç°é‡‘ç®±ç¼–å·)",
                    "// === å½“æ—¥ç»Ÿè®¡ ===": "",
                    "todayStats": {
                      "cardsIssued": "number (ä»Šæ—¥å‘è¡Œå¡æ•°)",
                      "totalPointsIssued": "number (ä»Šæ—¥å‘è¡Œç‚¹æ•°)",
                      "totalCashReceived": "number (ä»Šæ—¥æ”¶åˆ°ç°é‡‘ RM)",
                      "lastIssueAt": "timestamp (æœ€åä¸€æ¬¡å‘è¡Œæ—¶é—´)",
                      "firstIssueAt": "timestamp (é¦–æ¬¡å‘è¡Œæ—¶é—´)",
                      "workingHours": "number (å·¥ä½œæ—¶é•¿ï¼Œå°æ—¶)"
                    },
                    "// === ç´¯è®¡ç»Ÿè®¡ ===": "",
                    "totalStats": {
                      "totalCardsIssued": "number (ç´¯è®¡å‘è¡Œå¡æ•°)",
                      "totalPointsIssued": "number (ç´¯è®¡å‘è¡Œç‚¹æ•°)",
                      "totalCashReceived": "number (ç´¯è®¡æ”¶åˆ°ç°é‡‘ RM)",
                      "averageCardValue": "number (å¹³å‡æ¯å¡ç‚¹æ•°)",
                      "largestCardValue": "number (æœ€å¤§å•å¡ç‚¹æ•°)",
                      "smallestCardValue": "number (æœ€å°å•å¡ç‚¹æ•°)"
                    },
                    "// === ç°é‡‘ç®¡ç† ===": "",
                    "cashManagement": {
                      "cashOnHand": "number (å½“å‰æŒæœ‰ç°é‡‘ RM)",
                      "totalSubmitted": "number (ç´¯è®¡ä¸Šäº¤ç°é‡‘ RM)",
                      "pendingSubmission": "number (å¾…ä¸Šäº¤ç°é‡‘ RM)",
                      "lastSubmissionAt": "timestamp (æœ€åä¸Šäº¤æ—¶é—´)",
                      "submissionCount": "number (ä¸Šäº¤æ¬¡æ•°)"
                    },
                    "// === å·¥ä½œè®°å½• ===": "",
                    "workHistory": [
                      {
                        "date": "string (æ—¥æœŸ YYYY-MM-DD)",
                        "shift": "string (ç­æ¬¡)",
                        "cardsIssued": "number (å‘è¡Œå¡æ•°)",
                        "pointsIssued": "number (å‘è¡Œç‚¹æ•°)",
                        "cashReceived": "number (æ”¶åˆ°ç°é‡‘)",
                        "cashSubmitted": "number (ä¸Šäº¤ç°é‡‘)",
                        "workingHours": "number (å·¥ä½œæ—¶é•¿)"
                      }
                    ],
                    "// === æƒé™è®¾ç½® ===": "",
                    "permissions": {
                      "canIssueCards": "boolean (å¯ä»¥å‘è¡Œç‚¹æ•°å¡)",
                      "canPrintQRCode": "boolean (å¯ä»¥æ‰“å° QR Code)",
                      "canRecordCash": "boolean (å¯ä»¥è®°å½•ç°é‡‘æ”¶æ¬¾)",
                      "canViewOwnStats": "boolean (å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ç»Ÿè®¡)",
                      "canSubmitCash": "boolean (å¯ä»¥ä¸Šäº¤ç°é‡‘)",
                      "maxCardValue": "number (å•å¡æœ€å¤§ç‚¹æ•°é™åˆ¶ï¼Œ0=æ— é™åˆ¶)",
                      "maxDailyIssue": "number (æ¯æ—¥æœ€å¤§å‘è¡Œç‚¹æ•°é™åˆ¶ï¼Œ0=æ— é™åˆ¶)"
                    },
                    "// === çŠ¶æ€ä¿¡æ¯ ===": "",
                    "status": {
                      "isActive": "boolean (æ˜¯å¦æ¿€æ´»)",
                      "isOnDuty": "boolean (æ˜¯å¦å½“ç­ä¸­)",
                      "dutyStartedAt": "timestamp (å½“ç­å¼€å§‹æ—¶é—´)",
                      "lastActivityAt": "timestamp (æœ€åæ´»åŠ¨æ—¶é—´)"
                    },
                    "// === å¤‡æ³¨ ===": "",
                    "notes": [
                      "PointSeller åªåœ¨ä¹‰å–ä¼šå½“æ—¥æœ‰æ•ˆ",
                      "å‘è¡Œç‚¹æ•°å¡æ—¶å¿…é¡»æ”¶å–ç­‰å€¼ç°é‡‘",
                      "æ‰€æœ‰ç°é‡‘å¿…é¡»å®šæœŸä¸Šäº¤ç»™ FinanceManager",
                      "ç‚¹æ•°å¡å‘è¡Œè®°å½•ä¿å­˜åœ¨ pointCards é›†åˆ"
                    ]
                  },
                  "accountStatus": {
                    "isActive": "boolean (è´¦æˆ·æ˜¯å¦æ¿€æ´»)",
                    "isSuspended": "boolean (æ˜¯å¦è¢«æš‚åœ)",
                    "suspensionReason": "string (æš‚åœåŸå› ï¼Œå¯é€‰)",
                    "lastLoginAt": "timestamp (æœ€åç™»å½•æ—¶é—´)",
                    "requirePasswordChange": "boolean (æ˜¯å¦éœ€è¦ä¿®æ”¹å¯†ç ï¼Œç®¡ç†å‘˜å¯å¼ºåˆ¶è¦æ±‚ï¼Œé»˜è®¤ false)"
                  },
                  "activityData": {
                    "lastActiveAt": "timestamp",
                    "totalLogins": "number",
                    "createdAt": "timestamp",
                    "updatedAt": "timestamp",
                    "createdBy": "string (åˆ›å»ºè€…UID)"
                  }
                },
                "indexes": [
                  "roles",
                  "identityTag",
                  "identityInfo.department",
                  "accountStatus.isActive"
                ],
                "securityRules": "ç”¨æˆ·å¯ä»¥è¯»å–è‡ªå·±çš„æ•°æ®ï¼›Event Manager å¯ä»¥è¯»å–æ‰€æœ‰ç”¨æˆ·ï¼›Seller Manager å¯ä»¥è¯»å– managedDepartments å†…çš„ç”¨æˆ·",
                "subcollections": {
                  "pointAllocations": {
                    "path": "organizations/{organizationId}/events/{eventId}/users/{sellerManagerId}/pointAllocations/{allocationId}",
                    "description": "Seller Manager çš„ç‚¹æ•°åˆ†é…è®°å½•ï¼ˆä»… sellerManager è§’è‰²æœ‰æ­¤å­é›†åˆï¼‰",
                    "documentStructure": {
                      "allocationId": "string (åˆ†é…è®°å½•ID)",
                      "fromUserId": "string (Seller Managerçš„userId)",
                      "toUserId": "string (æ¥æ”¶è€…çš„userId)",
                      "toDepartment": "string (æ¥æ”¶è€…çš„éƒ¨é—¨)",
                      "points": "number (åˆ†é…çš„ç‚¹æ•°)",
                      "reason": "string (åˆ†é…åŸå› ï¼Œå¯é€‰)",
                      "allocatedAt": "timestamp",
                      "status": "string ('completed' | 'cancelled')"
                    },
                    "indexes": [
                      "toUserId",
                      "allocatedAt"
                    ]
                  }
                }
              },
              "departmentStats": {
                "path": "organizations/{organizationId}/events/{eventId}/departmentStats/{departmentCode}",
                "description": "éƒ¨é—¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆæŒ‰éƒ¨é—¨èšåˆï¼‰",
                "documentStructure": {
                  "departmentCode": "string (éƒ¨é—¨ä»£ç )",
                  "departmentName": "string (éƒ¨é—¨åç§°)",
                  "totalUsers": "number (éƒ¨é—¨æ€»ç”¨æˆ·æ•°)",
                  "totalSellers": "number (Seller æ•°é‡)",
                  "activeSellers": "number (æœ‰äº¤æ˜“çš„ Seller æ•°)",
                  "pointsStats": {
                    "totalReceived": "number (éƒ¨é—¨ç´¯è®¡æ”¶åˆ°ç‚¹æ•°)",
                    "currentBalance": "number (éƒ¨é—¨å½“å‰ç‚¹æ•°ä½™é¢)",
                    "totalSold": "number (éƒ¨é—¨ç´¯è®¡å”®å‡ºç‚¹æ•°)",
                    "totalRevenue": "number (éƒ¨é—¨ç´¯è®¡é”€å”®é¢ RM)",
                    "totalCollected": "number (éƒ¨é—¨ç´¯è®¡å·²æ”¶æ¬¾ RM)",
                    "pendingCollection": "number (éƒ¨é—¨å¾…æ”¶æ¬¾ RM)",
                    "collectionRate": "number (éƒ¨é—¨æ”¶æ¬¾ç‡ï¼Œ0-1ä¹‹é—´)"
                  },
                  "collectionAlerts": {
                    "count": "number (æœ‰æ”¶æ¬¾è­¦ç¤ºçš„ç”¨æˆ·æ•°)",
                    "userIds": [
                      "string (æœ‰è­¦ç¤ºçš„ç”¨æˆ·IDåˆ—è¡¨)"
                    ]
                  },
                  "topPerformers": [
                    {
                      "userId": "string",
                      "displayName": "string",
                      "totalRevenue": "number",
                      "collectionRate": "number"
                    }
                  ],
                  "lastUpdated": "timestamp",
                  "lastCalculated": "timestamp"
                },
                "indexes": [
                  "departmentCode",
                  "pointsStats.totalRevenue"
                ]
              },
              "sellerManagerStats": {
                "path": "organizations/{organizationId}/events/{eventId}/sellerManagerStats/{sellerManagerId}",
                "description": "Seller Manager çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆmanagedDepartments å­˜å‚¨åœ¨ users/{userId}/roleSpecificData/sellerManager ä¸­ï¼‰",
                "documentStructure": {
                  "sellerManagerId": "string (Seller Managerçš„userId)",
                  "displayName": "string",
                  "managedUsersCount": "number (ç®¡ç†çš„ç”¨æˆ·æ€»æ•°)",
                  "totalAllocations": "number (ç´¯è®¡åˆ†é…æ¬¡æ•°)",
                  "totalPointsAllocated": "number (ç´¯è®¡åˆ†é…ç‚¹æ•°)",
                  "managedPointsStats": {
                    "description": "ç®¡ç†èŒƒå›´å†…çš„ç‚¹æ•°ç»Ÿè®¡",
                    "totalReceived": "number (ç®¡ç†èŒƒå›´å†…ç”¨æˆ·ç´¯è®¡æ”¶åˆ°ç‚¹æ•°)",
                    "currentBalance": "number (ç®¡ç†èŒƒå›´å†…ç”¨æˆ·å½“å‰ç‚¹æ•°ä½™é¢)",
                    "totalSold": "number (ç®¡ç†èŒƒå›´å†…ç”¨æˆ·ç´¯è®¡å”®å‡ºç‚¹æ•°)",
                    "totalRevenue": "number (ç®¡ç†èŒƒå›´å†…ç´¯è®¡é”€å”®é¢)",
                    "totalCollected": "number (ç®¡ç†èŒƒå›´å†…ç´¯è®¡å·²æ”¶æ¬¾)",
                    "pendingCollection": "number (ç®¡ç†èŒƒå›´å†…å¾…æ”¶æ¬¾)",
                    "collectionRate": "number (ç®¡ç†èŒƒå›´å†…æ”¶æ¬¾ç‡)"
                  },
                  "alerts": {
                    "lowCollectionRateCount": "number (ä½æ”¶æ¬¾ç‡è­¦ç¤ºç”¨æˆ·æ•°)",
                    "lowCollectionRateUsers": [
                      {
                        "userId": "string",
                        "displayName": "string",
                        "department": "string",
                        "collectionRate": "number",
                        "pendingCollection": "number"
                      }
                    ]
                  },
                  "departmentBreakdown": [
                    {
                      "departmentCode": "string",
                      "departmentName": "string",
                      "userCount": "number",
                      "totalRevenue": "number",
                      "collectionRate": "number"
                    }
                  ],
                  "lastUpdated": "timestamp",
                  "lastCalculated": "timestamp"
                },
                "indexes": [
                  "sellerManagerId"
                ]
              },
              "firestoreArchitectureAddendum": {
                "description": "MyBazaar MerchantManager åŠŸèƒ½ - Firestore æ¶æ§‹è£œå……",
                "version": "2025-12-15-merchant-v1",
                "addedCollections": {
                  "merchants": {
                    "path": "organizations/{organizationId}/events/{eventId}/merchants/{merchantId}",
                    "description": "å•†å®¶ï¼ˆæ”¤ä½ï¼‰è³‡è¨Š",
                    "level": "Event",
                    "documentStructure": {
                      "merchantId": "string (è‡ªå‹•ç”Ÿæˆçš„æ–‡æª”ID)",
                      "userId": "string (é—œè¯çš„ç”¨æˆ¶ IDï¼Œä¾†è‡ª users é›†åˆ)",
                      "stallName": "string (æ”¤ä½åç¨±ï¼Œå¦‚ 'ç¾é£Ÿå¤©åœ°')",
                      "description": "string (æ”¤ä½æè¿°/ç°¡ä»‹)",
                      "contactInfo": {
                        "phone": "string (è¯çµ¡é›»è©±)",
                        "email": "string (è¯çµ¡éƒµç®±ï¼Œå¯é¸)",
                        "note": "string (å‚™è¨»ï¼Œå¯é¸)"
                      },
                      "qrCodeData": {
                        "type": "string (å›ºå®šå€¼ 'MERCHANT_PAYMENT')",
                        "version": "string (QR Code ç‰ˆæœ¬)",
                        "merchantId": "string (å•†å®¶ID)",
                        "eventId": "string (æ´»å‹•ID)",
                        "organizationId": "string (çµ„ç¹”ID)",
                        "generatedAt": "timestamp (ç”Ÿæˆæ™‚é–“)"
                      },
                      "revenueStats": {
                        "totalRevenue": "number (ç¸½æ”¶å…¥ï¼Œpoints)",
                        "todayRevenue": "number (ä»Šæ—¥æ”¶å…¥)",
                        "transactionCount": "number (ç¸½äº¤æ˜“ç­†æ•¸)",
                        "todayTransactionCount": "number (ä»Šæ—¥äº¤æ˜“ç­†æ•¸)",
                        "lastTransactionAt": "timestamp (æœ€å¾Œäº¤æ˜“æ™‚é–“)",
                        "averageTransactionAmount": "number (å¹³å‡äº¤æ˜“é‡‘é¡)"
                      },
                      "operationStatus": {
                        "isActive": "boolean (ç‡Ÿæ¥­ç‹€æ…‹ï¼Œtrue=ç‡Ÿæ¥­ä¸­)",
                        "lastStatusChange": "timestamp (æœ€å¾Œç‹€æ…‹è®Šæ›´æ™‚é–“)",
                        "pauseReason": "string (æš«åœåŸå› ï¼Œå¯é¸)"
                      },
                      "metadata": {
                        "createdAt": "timestamp (å‰µå»ºæ™‚é–“)",
                        "updatedAt": "timestamp (æœ€å¾Œæ›´æ–°æ™‚é–“)",
                        "createdBy": "string (å‰µå»ºè€… UID)",
                        "lastUpdatedBy": "string (æœ€å¾Œæ›´æ–°è€… UID)"
                      }
                    },
                    "indexes": [
                      "userId",
                      "operationStatus.isActive",
                      "revenueStats.totalRevenue (desc)",
                      "metadata.createdAt (desc)"
                    ],
                    "securityRules": {
                      "read": [
                        "Merchant Manager å¯ä»¥è®€å–è‡ªå·±çš„å•†å®¶è³‡æ–™ (userId == request.auth.uid)",
                        "Event Manager å¯ä»¥è®€å–æ‰€æœ‰å•†å®¶è³‡æ–™",
                        "Customer å¯ä»¥è®€å–ç‡Ÿæ¥­ä¸­çš„å•†å®¶åŸºæœ¬è³‡è¨Šï¼ˆç”¨æ–¼æƒç¢¼ä»˜æ¬¾ï¼‰"
                      ],
                      "write": [
                        "Merchant Manager å¯ä»¥æ›´æ–°ç‰¹å®šæ¬„ä½ï¼ˆstallName, description, contactInfo, isActiveï¼‰",
                        "Event Manager å¯ä»¥å‰µå»ºå’Œä¿®æ”¹å•†å®¶è³‡æ–™",
                        "totalRevenue ç­‰çµ±è¨ˆæ¬„ä½åªèƒ½ç”± Cloud Functions æ›´æ–°"
                      ]
                    }
                  }
                }
              },
              "transactions": {
                "path": "organizations/{organizationId}/events/{eventId}/transactions/{transactionId}",
                "description": "æ‰€æœ‰äº¤æ˜“è®°å½•ï¼ˆSellerå”®å‡ºç‚¹æ•°ç»™ Customerï¼›Merchantå‘ Customer æ”¶å–ç‚¹æ•°ï¼‰",
                "documentStructure": {
                  "transactionId": "string (è‡ªå‹•ç”Ÿæˆ)",
                  "eventId": "string",
                  "organizationId": "string",
                  "// äº¤æ˜“é›™æ–¹": "æ ¹æ“šé¡å‹ä¸åŒè€Œç•°",
                  "sellerId": "string (POINTS_SALE æ™‚ä½¿ç”¨)",
                  "customerId": "string (å…©ç¨®é¡å‹éƒ½æœ‰)",
                  "amount": "number (äº¤æ˜“é‡‘é¡ï¼Œpoints)",
                  "status": "string ('completed' | 'failed' | 'pending' | 'refunded')",
                  "timestamp": "timestamp (äº¤æ˜“æ™‚é–“)",
                  "metadata": {
                    "deviceInfo": "string (è¨­å‚™è³‡è¨Šï¼Œå¯é¸)",
                    "ipAddress": "string (IPåœ°å€ï¼Œå¯é¸)",
                    "location": "object (åœ°ç†ä½ç½®ï¼Œå¯é¸)"
                  },
                  "transactionType": {
                    "type": "string",
                    "values": [
                      "POINTS_SALE",
                      "customer_to_merchant",
                      "customer_transfer",
                      "point_card_payment",
                      "point_card_topup"
                    ],
                    "description": "POINTS_SALE: Sellerå–ç‚¹ç»™Customer; Mcustomer_to_merchant: Customerä»˜æ¬¾ç»™Merchant; customer_transfer: Customerè½¬è®©ç‚¹æ•°; point_card_payment: ç‚¹æ•°å¡ä»˜æ¬¾ç»™Merchant; point_card_topup: ç‚¹æ•°å¡å……å€¼åˆ°Customerè´¦æˆ·"
                  },
                  "merchantId": {
                    "type": "string",
                    "description": "å•†å®¶IDï¼ˆåƒ… MERCHANT_PAYMENT é¡å‹æœ‰å€¼ï¼‰ï¼ŒMERCHANT_PAYMENT æ™‚ä½¿ç”¨",
                    "nullable": true
                  },
                  "customerPhone": {
                    "type": "string",
                    "description": "é¡§å®¢é›»è©±ï¼ˆè„«æ•é¡¯ç¤ºï¼Œå¦‚ +601****789ï¼‰",
                    "note": "ç”¨æ–¼å•†å®¶æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„"
                  },
                  "paymentMethod": {
                    "type": "string",
                    "values": [
                      "POINTS"
                    ],
                    "description": "ä»˜æ¬¾æ–¹å¼ï¼ˆç•¶å‰åªæ”¯æ´ pointsï¼‰"
                  },
                  "// === customer_transfer ç‰¹æœ‰å­—æ®µ ===": "",
                  "fromUser": {
                    "userId": "string",
                    "userName": "string",
                    "phone": "string"
                  },
                  "toUser": {
                    "userId": "string",
                    "userName": "string",
                    "phone": "string"
                  },
                  "// === éªŒè¯æ–¹å¼ï¼ˆå·²ä»OTPæ”¹ä¸ºPINç éªŒè¯ï¼‰===": "",
                  "pinVerified": "boolean (æ˜¯å¦é€šè¿‡äº¤æ˜“å¯†ç éªŒè¯)",
                  "pinVerifiedAt": "timestamp (äº¤æ˜“å¯†ç éªŒè¯æ—¶é—´)",
                  "verificationMethod": "string (éªŒè¯æ–¹å¼: 'transaction_pin' | 'otp'ï¼Œå½“å‰ç»Ÿä¸€ä½¿ç”¨ transaction_pin)""// === point_card ç›¸å…³å­—æ®µ ===": "",
                  "cardId": "string (ç‚¹æ•°å¡ID)",
                  "cardNumber": "string (ç‚¹æ•°å¡ç¼–å·)",
                  "cardBalanceBefore": "number",
                  "cardBalanceAfter": "number",
                  "cardDestroyed": "boolean"
                },
                "indexes": [
                  "transactionType",
                  "merchantId + timestamp (desc)",
                  "customerId + timestamp (desc)",
                  "sellerId + timestamp (desc)",
                  "status"
                ]
              },
              "cashCollections": {
                "path": "organizations/{organizationId}/events/{eventId}/cashCollections/{collectionId}",
                "description": "ç°é‡‘æ”¶æ¬¾è®°å½•ï¼ˆSeller Manager ä» Seller æ”¶å–ç°é‡‘çš„è®°å½•ï¼‰",
                "level": "Event Subcollection",
                "documentStructure": {
                  "collectionId": "string (æ–‡æ¡£ID)",
                  "type": "string ('sellerToManager')",
                  "collectedBy": "string (Seller Manager ID)",
                  "collectedByName": "string",
                  "collectedByRole": "string ('sellerManager')",
                  "collectedByDepartment": "string",
                  "submittedBy": "string (Seller ID)",
                  "submittedByName": "string",
                  "submittedByRole": "string ('seller')",
                  "submittedByDepartment": "string",
                  "amount": "number",
                  "pointsValue": "number",
                  "discrepancy": "number",
                  "discrepancyReason": "string",
                  "discrepancyType": "string",
                  "status": "string",
                  "collectedAt": "timestamp",
                  "submittedAt": "timestamp",
                  "confirmedAt": "timestamp",
                  "submissionId": "string",
                  "sellerId": "string",
                  "sellerDepartment": "string",
                  "eventId": "string",
                  "organizationId": "string",
                  "note": "string",
                  "createdAt": "timestamp",
                  "updatedAt": "timestamp"
                },
                "indexes": [
                  "collectedBy",
                  "collectedAt",
                  "sellerId",
                  "status"
                ],
                "securityRules": "Seller Manager å¯è¯»å†™è‡ªå·±çš„è®°å½•; Finance Manager å’Œ Event Manager å¯è¯»æ‰€æœ‰è®°å½•"
              },
              "cashSubmissions": {
                "path": "organizations/{orgId}/events/{eventId}/cashSubmissions/{submissionId}",
                "description": "ç°é‡‘ä¸Šäº¤è®°å½•ï¼ˆSeller/SellerManager/PointSeller ä¸Šäº¤ç»™ FinanceManagerï¼‰",
                "level": "Event Subcollection",
                "documentStructure": {
                  "// === åŸºæœ¬ä¿¡æ¯ ===": "",
                  "submissionId": "string (è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID)",
                  "submissionNumber": "string (æµæ°´å·ï¼Œå¦‚ 'CS-2025-001')",
                  "// === æäº¤æ–¹ä¿¡æ¯ ===": "",
                  "submittedBy": "string (æäº¤è€… userId)",
                  "submitterName": "string (æäº¤è€…å§“å)",
                  "submitterRole": "string (æäº¤è€…è§’è‰²ï¼š'seller' | 'sellerManager' | 'pointSeller')",
                  "submitterDepartment": "string (æäº¤è€…éƒ¨é—¨ï¼Œå¯é€‰)",
                  "submitterPhone": "string (æäº¤è€…ç”µè¯)",
                  "// === æ¥æ”¶æ–¹ä¿¡æ¯ ===": "",
                  "receivedBy": "string (æ¥æ”¶è€… userId - å¯ä»¥æ˜¯SellerManageræˆ–FinanceManagerï¼Œæˆ–nullè¡¨ç¤ºå¾…è®¤é¢†æ± å­)",
                  "receiverName": "string (æ¥æ”¶è€…å§“å)",
                  "receiverRole": "string (æ¥æ”¶è€…è§’è‰²ï¼š'sellerManager' | 'financeManager' | null)", // ğŸ†• æ–°å¢
                  "receiverPhone": "string (æ¥æ”¶è€…ç”µè¯)",
                  "// === é‡‘é¢ä¿¡æ¯ ===": "",
                  "amount": "number (ä¸Šäº¤é‡‘é¢ RM)",
                  "breakdown": {
                    "cash": "number (ç°é‡‘ RM)",
                    "transfer": "number (è½¬è´¦ RM)",
                    "check": "number (æ”¯ç¥¨ RM)"
                  },
                  "currency": "string (è´§å¸ï¼Œé»˜è®¤ 'MYR')",
                  "// === çŠ¶æ€ä¿¡æ¯ ===": "",
                  "status": "string ('pending' | 'confirmed' | 'disputed' | 'rejected')",
                  "submittedAt": "timestamp (æäº¤æ—¶é—´)",
                  "confirmedAt": "timestamp (ç¡®è®¤æ—¶é—´ï¼Œå¯é€‰)",
                  "disputedAt": "timestamp (äº‰è®®æ—¶é—´ï¼Œå¯é€‰)",
                  "rejectedAt": "timestamp (æ‹’ç»æ—¶é—´ï¼Œå¯é€‰)",
                  "// === å¤‡æ³¨ä¿¡æ¯ ===": "",
                  "note": "string (å¤‡æ³¨)",
                  "receiptNumber": "string (æ”¶æ®ç¼–å·)",
                  "confirmationNote": "string (ç¡®è®¤å¤‡æ³¨ï¼ŒFinanceManager å¡«å†™)",
                  "disputeReason": "string (äº‰è®®åŸå› ï¼Œå¯é€‰)",
                  "// === åŒ…å«çš„é”€å”®è®°å½• ===": "",
                  "includedSales": [
                    {
                      "sellerId": "string (Seller IDï¼Œå¯é€‰)",
                      "sellerName": "string (Seller å§“å)",
                      "amount": "number (é‡‘é¢ RM)",
                      "salesDate": "string (é”€å”®æ—¥æœŸ YYYY-MM-DD)",
                      "transactionIds": [
                        "array<string> (åŒ…å«çš„äº¤æ˜“IDåˆ—è¡¨)"
                      ]
                    }
                  ],
                  "salesCount": "number (åŒ…å«çš„é”€å”®ç¬”æ•°)",
                  "// === ç‚¹æ•°å¡ä¿¡æ¯ ===": "",
                  "pointCardInfo": {
                    "cardsIssued": "number (å‘è¡Œå¡æ•°ï¼ŒpointSeller ä¸“ç”¨)",
                    "pointsIssued": "number (å‘è¡Œç‚¹æ•°ï¼ŒpointSeller ä¸“ç”¨)",
                    "cardIds": [
                      "array<string> (ç‚¹æ•°å¡IDåˆ—è¡¨)"
                    ]
                  },
                  "// === å…ƒæ•°æ® ===": "",
                  "metadata": {
                    "createdAt": "timestamp",
                    "updatedAt": "timestamp",
                    "eventId": "string (å†—ä½™å­—æ®µ)",
                    "organizationId": "string (å†—ä½™å­—æ®µ)",
                    "submissionSource": "string ('manual' | 'batch' | 'auto')",
                    "submissionType": "string ('sellerToManager' | 'managerToFinance' | 'sellerToFinance' | 'pointSellerToFinance')" // ğŸ†• æ–°å¢
                  }
                },
                "indexes": [
                  "status",
                  "receivedBy + status + submittedAt (desc)",
                  "submittedBy + submittedAt (desc)",
                  "submittedAt (desc)",
                  "submissionNumber (unique)"
                ],
                "securityRules": {
                  "create": [
                    "Seller/SellerManager/PointSeller å¯ä»¥åˆ›å»ºè‡ªå·±çš„ä¸Šäº¤è®°å½•",
                    "submittedBy å¿…é¡»ç­‰äº request.auth.uid"
                  ],
                  "read": [
                    "æäº¤è€…å¯ä»¥è¯»å–è‡ªå·±çš„è®°å½•",
                    "FinanceManager å¯ä»¥è¯»å–æ‰€æœ‰è®°å½•",
                    "Event Manager å¯ä»¥è¯»å–æ‰€æœ‰è®°å½•"
                  ],
                  "update": [
                    "FinanceManager å¯ä»¥æ›´æ–°çŠ¶æ€ï¼ˆç¡®è®¤/æ‹’ç»/äº‰è®®ï¼‰",
                    "åªèƒ½ä¿®æ”¹ status, confirmedAt, confirmationNote, disputedAt, disputeReason å­—æ®µ"
                  ],
                  "delete": [
                    "ä¸å…è®¸åˆ é™¤"
                  ]
                },
                "notes": [
                  "ç°é‡‘ä¸Šäº¤æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å…³é”®æµç¨‹",
                  "çŠ¶æ€å˜æ›´å¿…é¡»è®°å½•æ—¶é—´æˆ³",
                  "FinanceManager ç¡®è®¤åæ›´æ–°å„é¡¹ç»Ÿè®¡",
                  "æ”¯æŒéƒ¨åˆ†ä¸Šäº¤ï¼ˆä¸€ä¸ª Seller å¯ä»¥åˆ†å¤šæ¬¡ä¸Šäº¤ï¼‰",
                  "includedSales æä¾›è¯¦ç»†è¿½æº¯"
                ]
              },
              "departments": {
                "path": "organizations/{organizationId}/events/{eventId}/departments/{departmentCode}",
                "description": "æ´»åŠ¨ä¸­çš„éƒ¨é—¨å…ƒæ•°æ®ï¼ˆä¸ Organization.departments åŒæ­¥ï¼Œä½†å…è®¸Eventçº§åˆ«çš„è‡ªå®šä¹‰ï¼‰",
                "documentStructure": {
                  "departmentCode": "string (éƒ¨é—¨ä»£ç )",
                  "departmentName": "string (éƒ¨é—¨åç§°)",
                  "isActive": "boolean (æ˜¯å¦æ¿€æ´»)",
                  "userCount": "number (è¯¥éƒ¨é—¨çš„ç”¨æˆ·æ•°)",
                  "createdBy": "string ('system' | 'manual')",
                  "createdAt": "timestamp",
                  "updatedAt": "timestamp"
                },
                "indexes": [
                  "departmentCode",
                  "isActive"
                ]
              },
              "pointCards": {
                "path": "organizations/{orgId}/events/{eventId}/pointCards/{cardId}",
                "description": "ç‚¹æ•°å¡ç®¡ç†ï¼ˆä¸è®°åç‚¹æ•°å¡ï¼‰",
                "level": "Event Subcollection",
                "documentStructure": {
                  "// === åŸºæœ¬ä¿¡æ¯ ===": "",
                  "cardId": "string (è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID)",
                  "cardNumber": "string (æ‰“å°åœ¨å¡ä¸Šçš„ç¼–å·ï¼Œå¦‚ 'CARD-2025-001')",
                  "// === ç‚¹æ•°ä¿¡æ¯ ===": "",
                  "balance": {
                    "initial": "number (åˆå§‹ç‚¹æ•°)",
                    "current": "number (å½“å‰ä½™é¢)",
                    "spent": "number (å·²æ¶ˆè´¹)",
                    "reserved": "number (é¢„ç•™ï¼Œäº¤æ˜“è¿›è¡Œä¸­)"
                  },
                  "// === çŠ¶æ€ä¿¡æ¯ ===": "",
                  "status": {
                    "isActive": "boolean (æ˜¯å¦æœ‰æ•ˆ)",
                    "isExpired": "boolean (æ˜¯å¦è¿‡æœŸ)",
                    "isDestroyed": "boolean (æ˜¯å¦å·²é”€æ¯ï¼ŒCustomerå……å€¼åä¸ºtrue)",
                    "isEmpty": "boolean (ä½™é¢æ˜¯å¦ä¸ºé›¶)",
                    "expiresAt": "timestamp (è¿‡æœŸæ—¶é—´ï¼Œæ´»åŠ¨ç»“æŸæ—¶é—´)",
                    "lastUsedAt": "timestamp (æœ€åä½¿ç”¨æ—¶é—´)",
                    "destroyedAt": "timestamp (é”€æ¯æ—¶é—´ï¼Œå¯é€‰)",
                    "destroyedBy": {
                      "userId": "string (é”€æ¯è€…ID)",
                      "reason": "string ('customer_topup' | 'expired' | 'manual')"
                    }
                  },
                  "// === QR Codeä¿¡æ¯ ===": "",
                  "qrCodeData": {
                    "type": "string (å›ºå®šå€¼ 'POINT_CARD')",
                    "version": "string (ç‰ˆæœ¬å·)",
                    "cardId": "string (ç‚¹æ•°å¡ID)",
                    "eventId": "string (æ´»åŠ¨ID)",
                    "organizationId": "string (ç»„ç»‡ID)",
                    "generatedAt": "timestamp (ç”Ÿæˆæ—¶é—´)"
                  },
                  "// === å‘è¡Œä¿¡æ¯ ===": "",
                  "issuer": {
                    "pointSellerId": "string (PointSellerç”¨æˆ·ID)",
                    "pointSellerName": "string (PointSellerå§“å)",
                    "issuedAt": "timestamp (å‘è¡Œæ—¶é—´)",
                    "cashReceived": "number (æ”¶åˆ°çš„ç°é‡‘RMï¼Œ1:1æ¯”ä¾‹)",
                    "receiptNumber": "string (æ”¶æ®ç¼–å·)"
                  },
                  "// === ä½¿ç”¨è®°å½• ===": "",
                  "usageStats": {
                    "transactionCount": "number (ä½¿ç”¨æ¬¡æ•°)",
                    "merchantsUsed": [
                      "array<string> (ä½¿ç”¨è¿‡çš„å•†å®¶IDåˆ—è¡¨)"
                    ],
                    "firstUsedAt": "timestamp (é¦–æ¬¡ä½¿ç”¨æ—¶é—´)",
                    "lastUsedAt": "timestamp (æœ€åä½¿ç”¨æ—¶é—´)"
                  },
                  "// === å…ƒæ•°æ® ===": "",
                  "metadata": {
                    "createdAt": "timestamp",
                    "createdBy": "string (PointSeller UID)",
                    "eventId": "string (å†—ä½™å­—æ®µ)",
                    "organizationId": "string (å†—ä½™å­—æ®µ)"
                  }
                },
                "indexes": [
                  "cardNumber (unique)",
                  "status.isActive",
                  "status.expiresAt",
                  "issuer.pointSellerId",
                  "metadata.createdAt (desc)"
                ],
                "securityRules": {
                  "read": [
                    "ä»»ä½•äººæ‰«æQR Codeå¯è¯»å–ï¼ˆç”¨äºéªŒè¯å’ŒæŸ¥è¯¢ä½™é¢ï¼‰",
                    "PointSellerå¯è¯»å–è‡ªå·±å‘è¡Œçš„å¡ç‰‡",
                    "Event Managerå¯è¯»å–æ‰€æœ‰å¡ç‰‡"
                  ],
                  "write": [
                    "ä»…Cloud Functionså¯å†™ï¼ˆåˆ›å»ºã€æ›´æ–°ä½™é¢ã€é”€æ¯ï¼‰",
                    "PointSellerä¸èƒ½ç›´æ¥ä¿®æ”¹"
                  ]
                },
                "notes": [
                  "ç‚¹æ•°å¡ä¸ºä¸è®°åï¼Œä»»ä½•äººæŒæœ‰å³å¯ä½¿ç”¨",
                  "QR Codeç»Ÿä¸€æ ¼å¼ï¼Œæ ¹æ®æ‰«æè€…èº«ä»½æ‰§è¡Œä¸åŒé€»è¾‘",
                  "Customeræ‰«æ â†’ å……å€¼åˆ°è´¦æˆ·å¹¶é”€æ¯å¡ç‰‡",
                  "Merchantæ‰«æ â†’ ä»å¡ç‰‡æ‰£æ¬¾",
                  "æ´»åŠ¨ç»“æŸåè‡ªåŠ¨è¿‡æœŸ"
                ]
              }
            }
          }
        }
      },
      "otp_sessions": {
        "path": "otp_sessions/{sessionId}",
        "description": "OTPéªŒè¯ä¼šè¯ï¼ˆæ‰©å……ä¸ºé€šç”¨OTPç³»ç»Ÿï¼Œä¸ä»…é™äºç™»å½•ï¼‰",
        "level": "Platform",
        "changes": "æ‰©å……å­—æ®µï¼Œæ”¯æŒå¤šç§éªŒè¯åœºæ™¯",
        "newDocumentStructure": {
          "sessionId": "string (ä¼šè¯IDï¼Œæ ¼å¼ï¼š{userId}_{scenario}_{timestamp})",
          "userId": "string (ç”¨æˆ·UID)",
          "phoneNumber": "string (æ‰‹æœºå·)",
          "otpCode": "string (OTPç ï¼Œçº¯æ–‡æœ¬å­˜å‚¨ï¼ŒdevModeæ—¶ä¸ºå›ºå®šç )",
          "// === åœºæ™¯ä¿¡æ¯ ===": "",
          "scenario": "string (åœºæ™¯æ ‡è¯†ï¼Œå¦‚ 'customerPayment', 'customerTransfer')",
          "scenarioData": {
            "description": "åœºæ™¯ç›¸å…³æ•°æ®ï¼Œç”¨äºéªŒè¯å’Œæ¶ˆæ¯ç”Ÿæˆ",
            "example": {
              "amount": "number",
              "recipient": "string",
              "merchantName": "string"
            }
          },
          "// === çŠ¶æ€ä¿¡æ¯ ===": "",
          "status": "string ('pending' | 'verified' | 'expired' | 'locked')",
          "attempts": "number (å·²å°è¯•æ¬¡æ•°)",
          "maxAttempts": "number (æœ€å¤§å°è¯•æ¬¡æ•°)",
          "// === æ—¶é—´ä¿¡æ¯ ===": "",
          "createdAt": "timestamp (åˆ›å»ºæ—¶é—´)",
          "expiresAt": "timestamp (è¿‡æœŸæ—¶é—´)",
          "verifiedAt": "timestamp (éªŒè¯æˆåŠŸæ—¶é—´ï¼Œå¯é€‰)",
          "updatedAt": "timestamp (æœ€åæ›´æ–°æ—¶é—´)",
          "// === åºŸå¼ƒå­—æ®µï¼ˆä¿ç•™å…¼å®¹ï¼‰===": "",
          "orgCode": "string (ç»„ç»‡ä»£ç ï¼Œç™»å½•åœºæ™¯ä½¿ç”¨)",
          "eventCode": "string (æ´»åŠ¨ä»£ç ï¼Œç™»å½•åœºæ™¯ä½¿ç”¨)",
          "otpCodeHash": "string (OTPå“ˆå¸Œå€¼ï¼Œæ—§ç‰ˆæœ¬ä½¿ç”¨)",
          "devMode": "boolean (æ˜¯å¦ä¸ºå¼€å‘æ¨¡å¼ï¼Œå·²ç§»åˆ°platform_settings)"
        },
        "indexes": [
          "userId",
          "phoneNumber",
          "status",
          "expiresAt",
          "scenario"
        ],
        "securityRules": "åªè¯»ï¼›ç”±Cloud Functionsåˆ›å»ºå’Œç®¡ç†",
        "notes": [
          "é€šç”¨OTPç³»ç»Ÿï¼Œæ”¯æŒæ‰€æœ‰éœ€è¦éªŒè¯çš„åœºæ™¯",
          "sessionIdæ ¼å¼ç»Ÿä¸€ä¸ºï¼š{userId}_{scenario}_{timestamp}",
          "status='verified'åä¸å¯é‡å¤ä½¿ç”¨",
          "è¿‡æœŸsessionåº”å®šæœŸæ¸…ç†ï¼ˆCloud Schedulerï¼‰"
        ]
      },
      "platform_settings": {
        "path": "platform_settings/config",
        "description": "å¹³å°çº§åˆ«é…ç½®ï¼ˆå•æ–‡æ¡£é›†åˆï¼‰",
        "level": "Platform",
        "documentId": "config (å›ºå®šæ–‡æ¡£ID)",
        "documentStructure": {
          "COMMENT_OTP_STATUS": "========== OTPç³»ç»ŸçŠ¶æ€è¯´æ˜ ==========",
          "COMMENT_OTP_DEPRECATED_FOR_CUSTOMER": "æ³¨æ„ï¼šCustomerä»˜æ¬¾ï¼ˆprocessCustomerPaymentï¼‰å’Œè½¬è´¦ï¼ˆtransferPointsï¼‰å·²æ”¹ç”¨äº¤æ˜“å¯†ç ï¼ˆPINï¼‰éªŒè¯ï¼Œä¸å†ä½¿ç”¨OTPã€‚OTPé…ç½®ä¿ç•™ç”¨äºå…¶ä»–åœºæ™¯ï¼ˆå¦‚ç™»å½•ã€æ‰¾å›å¯†ç ç­‰ï¼‰ã€‚",
          "// === OTPé…ç½® ===": "",
          "COMMENT_OTP_DEPRECATED": "æ³¨æ„ï¼šCustomerä»˜æ¬¾å’Œè½¬è´¦å·²æ”¹ç”¨äº¤æ˜“å¯†ç ï¼ˆPINï¼‰éªŒè¯ï¼Œä¸å†ä½¿ç”¨OTPã€‚OTPé…ç½®ä¿ç•™ç”¨äºå…¶ä»–åœºæ™¯ï¼ˆå¦‚ç™»å½•ã€é‡ç½®å¯†ç ç­‰ï¼‰ã€‚",
          "otp": {
            "enabled": "boolean (OTPç³»ç»Ÿæ€»å¼€å…³)ï¼ŒCustomerä»˜æ¬¾/è½¬è´¦ä¸ä½¿ç”¨)",
            "provider": "string ('360sms' | 'twilio' | 'firebase')",
            "validityMinutes": "number (OTPæœ‰æ•ˆæœŸï¼Œåˆ†é’Ÿ)",
            "maxAttempts": "number (æœ€å¤§å°è¯•æ¬¡æ•°)",
            "smsConfig": {
              "description": "360 SMSé…ç½®",
              "apiKey": "string (360 API Key)",
              "apiSecret": "string (360 API Secret)",
              "baseUrl": "string (APIç«¯ç‚¹)",
              "sender": "string (å‘é€è€…åç§°ï¼Œå¦‚ 'MyBazaar')"
            },
            "devMode": {
              "enabled": "boolean (å¼€å‘æ¨¡å¼å¼€å…³)",
              "fixedCode": "string (å›ºå®šOTPç ï¼Œå¦‚ '223344')",
              "bypassForTestNumbers": [
                "array<string> (æµ‹è¯•å·ç åˆ—è¡¨ï¼Œä¸å‘é€çœŸå®SMS)"
              ]
            }
          },
          "// === OTPéªŒè¯åœºæ™¯å¼€å…³ï¼ˆPlatform Adminç»Ÿä¸€æ§åˆ¶ï¼‰===": "",
          "otpRequired": {
            "// --- Customerç›¸å…³ ---": "",
            "COMMENT": "ä»¥ä¸‹åœºæ™¯å·²æ”¹ç”¨PINéªŒè¯ï¼Œæ­¤é…ç½®ä¸å†ç”Ÿæ•ˆ",
            "customerPayment": "boolean (å·²å¼ƒç”¨ï¼Œæ”¹ç”¨äº¤æ˜“å¯†ç éªŒè¯)",
            "customerTransfer": "boolean (å·²å¼ƒç”¨ï¼Œæ”¹ç”¨äº¤æ˜“å¯†ç éªŒè¯)",
            "pointCardTopup": "boolean (Customeræ‰«ç‚¹æ•°å¡å……å€¼ï¼Œé€šå¸¸ä¸ºfalse)",
            "// --- SellerManagerç›¸å…³ ---": "",
            "sellerManagerAllocate": "boolean (SellerManageråˆ†é…ç‚¹æ•°)",
            "sellerManagerCollectCash": "boolean (SellerManageræ”¶æ¬¾ç¡®è®¤)",
            "sellerManagerSubmission": "boolean (Seller Manageræäº¤ç‚¹æ•°æ—¶æ˜¯å¦éœ€è¦OTP)",
            "// --- Sellerç›¸å…³ ---": "",
            "sellerSellPoints": "boolean (Sellerå‡ºå”®ç‚¹æ•°)",
            "sellerSubmitCash": "boolean (Sellerä¸Šç¼´ç°é‡‘)",
            "// --- EventManagerç›¸å…³ ---": "",
            "eventManagerBatchAllocate": "boolean (EventManageræ‰¹é‡åˆ†é…)",
            "eventManagerApproval": "boolean (EventManagerå®¡æ‰¹å¤§é¢æ“ä½œ)",
            "eventManagerOperations": "boolean (Event Manageré‡è¦æ“ä½œæ—¶æ˜¯å¦éœ€è¦OTP)",
            "// --- PointSellerç›¸å…³ ---": "",
            "pointSellerIssueCard": "boolean (PointSellerå‘è¡Œç‚¹æ•°å¡)",
            "pointSellerReceiveCash": "boolean (PointSelleræ”¶æ¬¾ç¡®è®¤)",
            "// --- FinanceManagerç›¸å…³ ---": "",
            "financeManagerVerify": "boolean (FinanceManagerè´¢åŠ¡æ ¸å®)",
            "financeManagerApproval": "boolean (Finance Managerå®¡æ‰¹æ—¶æ˜¯å¦éœ€è¦OTP)",
            "// --- Merchantç›¸å…³ ---": "",
            "merchantPayment": "boolean (Merchantæ”¶æ¬¾ï¼Œé€šå¸¸ä¸ºfalse)"
          },
          "// === OTPåœºæ™¯é…ç½®ï¼ˆæ¯ä¸ªåœºæ™¯çš„å…·ä½“è§„åˆ™ï¼‰===": "",
          "otpScenarios": {
            "customerPayment": {
              "description": "string (åœºæ™¯æè¿°)",
              "triggerCondition": {
                "minAmount": "number (è§¦å‘OTPçš„æœ€å°é‡‘é¢ï¼Œ0è¡¨ç¤ºä»»ä½•é‡‘é¢)",
                "maxAmount": "number (æœ€å¤§é‡‘é¢ï¼Œnullè¡¨ç¤ºæ— ä¸Šé™)"
              },
              "message": "string (OTPæ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡ {amount}, {recipient} ç­‰)"
            },
            "customerTransfer": {
              "description": "Customerè½¬è®©ç‚¹æ•°",
              "triggerCondition": {
                "minAmount": 10,
                "maxAmount": null
              },
              "message": "æ‚¨æ­£åœ¨è½¬è®© {amount} ç‚¹ç»™ {recipient}ï¼Œè¯·è¾“å…¥éªŒè¯ç ç¡®è®¤ã€‚"
            },
            "sellerManagerAllocate": {
              "description": "SellerManageråˆ†é…ç‚¹æ•°",
              "triggerCondition": {
                "minAmount": 100,
                "maxAmount": null
              },
              "message": "æ‚¨æ­£åœ¨åˆ†é… {amount} ç‚¹ç»™ {recipient}ï¼Œè¯·è¾“å…¥éªŒè¯ç ç¡®è®¤ã€‚"
            },
            "sellerSellPoints": {
              "description": "Sellerå‡ºå”®ç‚¹æ•°",
              "triggerCondition": {
                "minAmount": 50,
                "maxAmount": null
              },
              "message": "æ‚¨æ­£åœ¨å”®å‡º {amount} ç‚¹ï¼Œè¯·è¾“å…¥éªŒè¯ç ç¡®è®¤ã€‚"
            },
            "pointSellerIssueCard": {
              "description": "PointSellerå‘è¡Œç‚¹æ•°å¡",
              "triggerCondition": {
                "minAmount": 100,
                "maxAmount": null
              },
              "message": "æ‚¨æ­£åœ¨å‘è¡Œé¢é¢ {amount} ç‚¹çš„ç‚¹æ•°å¡ï¼Œè¯·è¾“å…¥éªŒè¯ç ç¡®è®¤ã€‚"
            },
            "eventManagerBatchAllocate": {
              "description": "EventManageræ‰¹é‡åˆ†é…",
              "triggerCondition": {
                "minAmount": 500,
                "maxAmount": null
              },
              "message": "æ‚¨æ­£åœ¨æ‰¹é‡åˆ†é…å…± {amount} ç‚¹ï¼Œè¯·è¾“å…¥éªŒè¯ç ç¡®è®¤ã€‚"
            }
          },
          "// === å…ƒæ•°æ® ===": "",
          "metadata": {
            "createdAt": "timestamp",
            "updatedAt": "timestamp",
            "updatedBy": "string (Platform Admin UID)"
          }
        },
        "indexes": [],
        "securityRules": {
          "read": "Platform Adminå’ŒEvent Managerå¯è¯»",
          "write": "ä»…Platform Adminå¯å†™"
        },
        "notes": [
          "è¿™æ˜¯å•æ–‡æ¡£é›†åˆï¼Œæ–‡æ¡£IDå›ºå®šä¸º 'config'",
          "æ‰€æœ‰Eventå…±äº«æ­¤é…ç½®",
          "Platform Adminé€šè¿‡ä¸“é—¨çš„ç®¡ç†é¡µé¢ä¿®æ”¹",
          "å‰ç«¯åº”ç¼“å­˜æ­¤é…ç½®ä»¥å‡å°‘è¯»å–"
        ]
      }
    },
    "cloudFunctions": {
      "description": "Cloud Functions è§¦å‘å™¨è®¾è®¡",
      "functions": {
        "updateUserPointsStats": {
          "trigger": "organizations/{orgId}/events/{eventId}/users/{userId} onWrite",
          "description": "å½“ç”¨æˆ·ç‚¹æ•°å˜åŒ–æ—¶ï¼Œæ›´æ–°ç›¸å…³ç»Ÿè®¡",
          "tasks": [
            "è®¡ç®—ç”¨æˆ·çš„ pointsStatsï¼ˆå®æ—¶ç»Ÿè®¡ï¼‰",
            "æ›´æ–°éƒ¨é—¨çš„ departmentStats",
            "æ›´æ–° Event çš„ globalPointsStats",
            "å¦‚æœç”¨æˆ·æ˜¯ Sellerï¼Œæ›´æ–°å¯¹åº” SellerManager çš„ stats",
            "æ£€æŸ¥æ˜¯å¦éœ€è¦è§¦å‘æ”¶æ¬¾è­¦ç¤º"
          ],
          "relatedFiles": [
            "functions/userStatsFunctions.js"
          ]
        },
        "onSellerManagerAllocation": {
          "trigger": "organizations/{orgId}/events/{eventId}/users/{sellerManagerId}/pointAllocations/{allocationId} onCreate",
          "description": "å½“ Seller Manager åˆ†é…ç‚¹æ•°æ—¶",
          "scope": "åªèƒ½åˆ†é…çµ¦ identityTag ç‚º student çš„ç”¨æˆ¶",
          "tasks": [
            "éªŒè¯æ¥æ”¶è€…çš„ identityTag æ˜¯å¦ä¸º 'student'",
            "éªŒè¯åˆ†é…é¢åº¦æ˜¯å¦è¶…å‡º maxPerAllocation é™åˆ¶",
            "æ›´æ–°æ¥æ”¶è€…çš„ seller.availablePoints",
            "æ›´æ–°æ¥æ”¶è€…çš„ pointsStats.totalReceived",
            "æ›´æ–°æ¥æ”¶è€…çš„ pointsStats.receivedFromSellerManager",
            "æ›´æ–°éƒ¨é—¨çš„ departmentStats",
            "æ›´æ–° SellerManager çš„ sellerManagerStats",
            "æ›´æ–° Event çš„ globalPointsStats.totalAllocated",
            "è®¡ç®—å¹¶æ›´æ–°æ”¶æ¬¾è­¦ç¤ºï¼ˆä»…å¯¹ studentsï¼‰"
          ],
          "relatedFiles": [
            "functions/sellerManagerFunctions.js"
          ]
        },
        "onFinanceManagerAllocation": {
          "trigger": "organizations/{orgId}/events/{eventId}/users/{financeManagerId}/pointAllocations/{allocationId} onCreate",
          "description": "å½“ Finance Manager åˆ†é…ç‚¹æ•°æ—¶ï¼ˆå•äººæˆ–æ‰¹é‡ï¼‰",
          "scope": "å¯åˆ†é…çµ¦ä»»ä½•é student çš„ identityTagï¼Œå¦‚ teacher/staff/parent ç­‰",
          "tasks": [
            "éªŒè¯ Finance Manager æ˜¯å¦æœ‰ canAllocateToIndividual æƒé™",
            "å¦‚æœæ˜¯æ‰¹é‡åˆ†é…ï¼ŒéªŒè¯ canBatchAllocate æƒé™",
            "éªŒè¯æ‰¹é‡åˆ†é…é¢åº¦æ˜¯å¦è¶…å‡º batchAllocationLimit",
            "éªŒè¯æ¥æ”¶è€…çš„ identityTag ä¸æ˜¯ 'student'",
            "æ›´æ–°æ¥æ”¶è€…çš„å¯¹åº”è§’è‰² availablePointsï¼ˆseller/merchant/customerï¼‰",
            "æ›´æ–°æ¥æ”¶è€…çš„ pointsStats.totalReceived",
            "æ›´æ–°æ¥æ”¶è€…çš„ pointsStats.receivedFromFinanceManager",
            "æ›´æ–° FinanceManager çš„ financeManagerStats",
            "æ›´æ–° Event çš„ globalPointsStats.totalAllocated",
            "ä¸è®¡ç®—æ”¶æ¬¾è­¦ç¤ºï¼ˆé students ä¸éœ€è¦ï¼‰"
          ],
          "relatedFiles": [
            "functions/financeManagerFunctions.js"
          ]
        },
        "onTransaction": {
          "trigger": "organizations/{orgId}/events/{eventId}/transactions/{transactionId} onCreate",
          "description": "å½“äº¤æ˜“å‘ç”Ÿæ—¶ï¼Œæ›´æ–°ç»Ÿè®¡",
          "tasks": [
            "éªŒè¯ Seller æœ‰è¶³å¤Ÿçš„ç‚¹æ•°ä½™é¢",
            "æ›´æ–° Seller çš„ seller.availablePointsï¼ˆå‡å°‘ï¼‰",
            "æ›´æ–° Seller çš„ seller.totalPointsSoldï¼ˆå¢åŠ ï¼‰",
            "æ›´æ–° Seller çš„ seller.totalRevenueï¼ˆå¢åŠ ï¼‰",
            "æ›´æ–° Seller çš„ seller.pendingCollectionï¼ˆå¢åŠ å¾…æ”¶æ¬¾ï¼‰",
            "æ›´æ–° Customer/Merchant çš„ availablePointsï¼ˆå¢åŠ ï¼‰",
            "æ›´æ–°éƒ¨é—¨çš„ departmentStats",
            "æ›´æ–° Event çš„ globalPointsStats.totalSold",
            "æ›´æ–° Event çš„ globalPointsStats.totalRevenue",
            "æ£€æŸ¥å¹¶æ›´æ–°æ”¶æ¬¾è­¦ç¤º"
          ],
          "relatedFiles": [
            "functions/transactionFunctions.js"
          ]
        },
        "onCashSubmission": {
          "trigger": "organizations/{orgId}/events/{eventId}/cashSubmissions/{submissionId} onCreate",
          "description": "å½“ç°é‡‘ä¸Šäº¤è®°å½•åˆ›å»ºæ—¶ï¼ˆSM ä¸Šäº¤ç»™ FMï¼‰",
          "tasks": [
            "éªŒè¯ Seller Manager çš„ä¸Šäº¤é‡‘é¢",
            "æ›´æ–° Seller Manager çš„ sellerManagerStatsï¼ˆå¾…ä¸Šäº¤é‡‘é¢å‡å°‘ï¼‰",
            "æ›´æ–° Finance Manager çš„ financeManagerStatsï¼ˆå¾…éªŒè¯é‡‘é¢å¢åŠ ï¼‰",
            "åˆ›å»ºå¾…éªŒè¯è®°å½•",
            "å‘é€é€šçŸ¥ç»™ Finance Manager"
          ],
          "relatedFiles": [
            "functions/cashSubmissionFunctions.js"
          ]
        },
        "onCashCollection": {
          "trigger": "organizations/{orgId}/events/{eventId}/cashCollections/{collectionId} onCreate",
          "description": "å½“ç°é‡‘æ”¶æ¬¾è®°å½•åˆ›å»ºæ—¶",
          "types": [
            "Seller Manager ä» Student æ”¶æ¬¾",
            "Finance Manager ç›´æ¥ä» Teacher/Staff æ”¶æ¬¾"
          ],
          "tasks": [
            "éªŒè¯æ”¶æ¬¾äººæƒé™ï¼ˆSM æˆ– FMï¼‰",
            "éªŒè¯é‡‘é¢æ˜¯å¦åˆç†ï¼ˆä¸è¶…è¿‡ pendingCollectionï¼‰",
            "æ›´æ–° Seller çš„ seller.totalCashCollected",
            "æ›´æ–° Seller çš„ seller.pendingCollectionï¼ˆå‡å°‘ï¼‰",
            "æ›´æ–°æ”¶æ¬¾äººçš„ç»Ÿè®¡ï¼ˆsellerManagerStats æˆ– financeManagerStatsï¼‰",
            "æ›´æ–°éƒ¨é—¨çš„ departmentStats",
            "æ›´æ–° Event çš„ globalPointsStats.totalCollected",
            "æ›´æ–°æ”¶æ¬¾è­¦ç¤ºçŠ¶æ€"
          ],
          "relatedFiles": [
            "functions/cashCollectionFunctions.js"
          ]
        },
        "checkCollectionWarnings": {
          "trigger": "organizations/{orgId}/events/{eventId}/users/{userId} onUpdate",
          "description": "æ£€æŸ¥å¹¶æ›´æ–°æ”¶æ¬¾è­¦ç¤º",
          "scope": "ä»…å¯¹ identityTag ä¸º student çš„ç”¨æˆ·",
          "tasks": [
            "éªŒè¯ç”¨æˆ·æ˜¯å¦ä¸º student",
            "è®¡ç®—å¾…æ”¶æ¬¾æ¯”ä¾‹",
            "æ ¹æ® Event.pointAllocationRules.sellerManager.warningThreshold åˆ¤æ–­",
            "æ›´æ–°ç”¨æˆ·çš„ seller.collectionAlert",
            "æ›´æ–°éƒ¨é—¨çš„ collectionAlerts",
            "æ›´æ–° SellerManager çš„ alerts",
            "å¦‚æœè¾¾åˆ°é«˜é£é™©çº§åˆ«ï¼Œå‘é€é€šçŸ¥"
          ],
          "relatedFiles": [
            "functions/collectionWarningFunctions.js"
          ]
        },
        "dailyStatsRecalculation": {
          "trigger": "PubSub Schedule (æ¯å¤©å‡Œæ™¨2ç‚¹)",
          "description": "å®šæ—¶é‡ç®—æ‰€æœ‰ç»Ÿè®¡æ•°æ®ï¼Œç¡®ä¿ä¸€è‡´æ€§",
          "tasks": [
            "éå†æ‰€æœ‰ Organization çš„æ‰€æœ‰ Event",
            "é‡æ–°è®¡ç®— globalPointsStats",
            "é‡æ–°è®¡ç®—æ‰€æœ‰ departmentStats",
            "é‡æ–°è®¡ç®—æ‰€æœ‰ sellerManagerStats",
            "é‡æ–°è®¡ç®—æ‰€æœ‰ financeManagerStats",
            "æ ‡è®° lastCalculated æ—¶é—´æˆ³",
            "ç”Ÿæˆæ¯æ—¥ç»Ÿè®¡æŠ¥å‘Š"
          ],
          "relatedFiles": [
            "functions/scheduledFunctions.js"
          ]
        },
        "onMerchantTransaction": {
          "trigger": "Firestore onCreate: transactions/{transactionId}",
          "description": "ç•¶å‰µå»ºå•†å®¶äº¤æ˜“è¨˜éŒ„æ™‚è§¸ç™¼ï¼ˆæ›´æ–°çµ±è¨ˆï¼‰",
          "conditions": [
            "transactionType == 'MERCHANT_PAYMENT'",
            "status == 'completed'"
          ],
          "tasks": [
            "æ›´æ–° Merchant çš„ revenueStats",
            "æ›´æ–° Merchant çš„ todayRevenueï¼ˆå¦‚æœæ˜¯ä»Šå¤©ï¼‰",
            "æ›´æ–° Merchant çš„ lastTransactionAt",
            "è¨ˆç®—ä¸¦æ›´æ–° averageTransactionAmount",
            "è§¸ç™¼å³æ™‚é€šçŸ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰"
          ],
          "relatedFiles": [
            "functions/src/merchantTriggers.js"
          ]
        },
        "sendOTP": {
          "name": "sendOTP",
          "trigger": "HTTP Callable",
          "description": "é€šç”¨OTPå‘é€å‡½æ•°ï¼ˆæ”¯æŒæ‰€æœ‰åœºæ™¯ï¼‰",
          "parameters": {
            "phoneNumber": "string (æ¥æ”¶æ–¹æ‰‹æœºå·)",
            "scenario": "string (åœºæ™¯æ ‡è¯†ï¼Œå¦‚ 'customerPayment')",
            "scenarioData": "object (åœºæ™¯æ•°æ®ï¼Œå¦‚ {amount, recipient})"
          },
          "logic": [
            "1. éªŒè¯ç”¨æˆ·èº«ä»½ï¼ˆcontext.authï¼‰",
            "2. è¯»å–platform_settings/config",
            "3. æ£€æŸ¥OTPæ€»å¼€å…³ï¼ˆotp.enabledï¼‰",
            "4. æ£€æŸ¥è¯¥åœºæ™¯æ˜¯å¦éœ€è¦OTPï¼ˆotpRequired[scenario]ï¼‰",
            "5. æ£€æŸ¥é‡‘é¢æ˜¯å¦è§¦å‘OTPï¼ˆotpScenarios[scenario].triggerConditionï¼‰",
            "6. ç”ŸæˆOTPç ï¼ˆdevModeæ—¶ä½¿ç”¨å›ºå®šç ï¼Œå¦åˆ™éšæœº6ä½ï¼‰",
            "7. æ ¹æ®åœºæ™¯æ¨¡æ¿ç”Ÿæˆæ¶ˆæ¯ï¼ˆæ›¿æ¢å˜é‡ï¼‰",
            "8. å‘é€SMSï¼ˆé€šè¿‡360 APIï¼Œæµ‹è¯•å·ç è·³è¿‡ï¼‰",
            "9. åˆ›å»ºotp_sessionsæ–‡æ¡£",
            "10. è¿”å›sessionIdå’ŒexpiresAt"
          ],
          "returns": {
            "success": "boolean",
            "otpRequired": "boolean (è¯¥åœºæ™¯æ˜¯å¦éœ€è¦OTP)",
            "sessionId": "string (ä¼šè¯IDï¼Œå¦‚æœéœ€è¦OTP)",
            "expiresAt": "number (æœ‰æ•ˆæœŸç§’æ•°)",
            "message": "string (æç¤ºä¿¡æ¯)"
          },
          "errorHandling": [
            "unauthenticated: æœªç™»å½•",
            "unavailable: OTPç³»ç»Ÿæœªå¯ç”¨",
            "internal: SMSå‘é€å¤±è´¥"
          ]
        },
        "verifyOTP": {
          "name": "verifyOTP",
          "trigger": "HTTP Callable",
          "description": "é€šç”¨OTPéªŒè¯å‡½æ•°",
          "parameters": {
            "sessionId": "string (OTPä¼šè¯ID)",
            "otpCode": "string (6ä½OTPç )"
          },
          "logic": [
            "1. éªŒè¯ç”¨æˆ·èº«ä»½",
            "2. è¯»å–otp_sessions/{sessionId}",
            "3. éªŒè¯æ‰€æœ‰æƒï¼ˆsession.userId == context.auth.uidï¼‰",
            "4. æ£€æŸ¥çŠ¶æ€ï¼ˆä¸èƒ½æ˜¯verified/expired/lockedï¼‰",
            "5. æ£€æŸ¥æ˜¯å¦è¿‡æœŸ",
            "6. æ£€æŸ¥å°è¯•æ¬¡æ•°",
            "7. éªŒè¯OTPç ",
            "8. æ›´æ–°çŠ¶æ€ä¸ºverifiedæˆ–å¢åŠ attempts"
          ],
          "returns": {
            "success": "boolean",
            "sessionId": "string",
            "scenario": "string (åœºæ™¯æ ‡è¯†)",
            "scenarioData": "object (åœºæ™¯æ•°æ®)"
          },
          "errorHandling": [
            "not-found: ä¼šè¯ä¸å­˜åœ¨",
            "permission-denied: æ— æƒéªŒè¯æ­¤OTP",
            "failed-precondition: å·²éªŒè¯/å·²è¿‡æœŸ",
            "deadline-exceeded: OTPå·²è¿‡æœŸ",
            "resource-exhausted: å°è¯•æ¬¡æ•°ç”¨å®Œ",
            "invalid-argument: OTPç é”™è¯¯"
          ]
        },
        "createCustomer": {
          "name": "createCustomer",
          "trigger": "HTTP Callable",
          "description": "åˆ›å»ºCustomerè´¦æˆ·ï¼ˆæ³¨å†Œï¼‰",
          "parameters": {
            "orgId": "string",
            "eventId": "string",
            "phoneNumber": "string",
            "displayName": "string",
            "password": "string"
          },
          "logic": [
            "1. éªŒè¯phoneNumberæ ¼å¼",
            "2. æ£€æŸ¥æ‰‹æœºå·åœ¨è¯¥Eventä¸‹æ˜¯å¦å·²å­˜åœ¨",
            "3. åˆ›å»ºFirebase Authè´¦æˆ·",
            "4. åœ¨usersé›†åˆåˆ›å»ºCustomeræ–‡æ¡£",
            "5. åˆå§‹åŒ–customerå¯¹è±¡ï¼ˆæ‰€æœ‰ç»Ÿè®¡å­—æ®µä¸º0ï¼‰",
            "6. ç”Ÿæˆä¸ªäººQR Codeæ•°æ®",
            "7. æ›´æ–°Event.roleStats.customers.count"
          ],
          "returns": {
            "success": "boolean",
            "userId": "string",
            "message": "string"
          }
        },
        "processCustomerPayment": {
          "name": "processCustomerPayment",
          "trigger": "HTTP Callable",
          "description": "Customerä»˜æ¬¾ç»™Merchantï¼ˆä½¿ç”¨äº¤æ˜“å¯†ç éªŒè¯ï¼‰",
          "parameters": {
            "merchantId": "string (å•†å®¶ID)",
            "amount": "number (ä»˜æ¬¾é‡‘é¢)",
            "transactionPin": "string (6ä½æ•°å­—äº¤æ˜“å¯†ç ï¼Œå¿…å¡«)",
            "organizationId": "string (ç»„ç»‡ID)",
            "eventId": "string (æ´»åŠ¨ID)"
          },
          "logic": [
            "1. éªŒè¯èº«ä»½ï¼ˆcontext.auth.uidï¼‰",
            "2. éªŒè¯å¿…è¦å‚æ•°ï¼ˆmerchantId, amount, organizationId, eventIdï¼‰",
            "3. éªŒè¯transactionPinæ ¼å¼ï¼ˆå¿…é¡»æ˜¯6ä½æ•°å­—ï¼š/^\\d{6}$/ï¼‰",
            "4. è¯»å–Customeræ–‡æ¡£ï¼ˆorganizations/{orgId}/events/{eventId}/users/{customerId}ï¼‰",
            "5. ä½¿ç”¨ verifyTransactionPinInternal éªŒè¯äº¤æ˜“å¯†ç ï¼š",
            "   a. æ£€æŸ¥è´¦æˆ·é”å®šçŠ¶æ€ï¼ˆpinLockedUntilï¼‰",
            "   b. æ£€æŸ¥å¤±è´¥æ¬¡æ•°ï¼ˆpinFailedAttempts < 5ï¼‰",
            "   c. è¯»å–PINå“ˆå¸Œå€¼ï¼ˆtransactionPinHashï¼‰",
            "   d. æ£€æµ‹åŠ å¯†æ–¹å¼ï¼ˆæœ‰pinSaltç”¨SHA256ï¼Œæ— pinSaltç”¨bcryptï¼‰",
            "   e. éªŒè¯PINæ­£ç¡®æ€§",
            "   f. éªŒè¯å¤±è´¥ï¼šå¢åŠ pinFailedAttemptsï¼Œ5æ¬¡åé”å®š1å°æ—¶",
            "   g. éªŒè¯æˆåŠŸï¼šé‡ç½®pinFailedAttemptså’ŒpinLockedUntil",
            "6. ä½¿ç”¨Firestore Transactionæ‰§è¡Œä»˜æ¬¾ï¼š",
            "   a. é‡æ–°è¯»å–Customeræ–‡æ¡£ï¼ˆç¡®ä¿æ•°æ®æœ€æ–°ï¼‰",
            "   b. æ£€æŸ¥ä½™é¢ï¼ˆcustomer.pointsAccount.availablePoints >= amountï¼‰",
            "   c. è¯»å–Merchantæ–‡æ¡£",
            "   d. æ£€æŸ¥å•†å®¶è¥ä¸šçŠ¶æ€ï¼ˆoperationStatus.isActiveï¼‰",
            "   e. æ‰£é™¤Customerç‚¹æ•°ï¼š",
            "      - availablePoints -= amount",
            "      - totalSpent += amount",
            "      - transactionCount += 1",
            "   f. å¢åŠ Merchantæ”¶å…¥ï¼š",
            "      - totalRevenue += amount",
            "      - transactionCount += 1",
            "   g. æ›´æ–°Customerè®¿é—®å•†å®¶åˆ—è¡¨ï¼ˆstats.merchantsVisitedï¼‰",
            "   h. åˆ›å»ºtransactionè®°å½•ï¼ˆtype='customer_to_merchant'ï¼‰ï¼š",
            "      - åŒ…å«customerId, customerName, customerPhone",
            "      - åŒ…å«merchantId, merchantName",
            "      - pinVerified=true, verificationMethod='transaction_pin'",
            "7. è¿”å›ç»“æœï¼š{ success, transactionId, remainingBalance }"
          ],
          "returns": {
            "success": "boolean",
            "transactionId": "string",
            "remainingBalance": "number",
            "message": "string"
          },
          "errors": [
            "invalid-argument: å‚æ•°æ— æ•ˆæˆ–æ ¼å¼é”™è¯¯",
            "unauthenticated: æœªç™»å½•",
            "not-found: Customeræˆ–Merchantä¸å­˜åœ¨",
            "failed-precondition: ä½™é¢ä¸è¶³ã€å•†å®¶æš‚åœè¥ä¸šã€è´¦æˆ·è¢«é”å®š",
            "permission-denied: äº¤æ˜“å¯†ç é”™è¯¯ï¼ˆåŒ…å«å‰©ä½™å°è¯•æ¬¡æ•°ï¼‰"
          ]
        },
        "transferPoints": {
          "name": "transferPoints",
          "trigger": "HTTP Callable",
          "description": "Customerä¹‹é—´è½¬è®©ç‚¹æ•°ï¼ˆä½¿ç”¨äº¤æ˜“å¯†ç éªŒè¯ï¼‰",
          "parameters": {
            "toPhoneNumber": "string (æ¥æ”¶æ–¹æ‰‹æœºå·)",
            "amount": "number (è½¬è®©é‡‘é¢)",
            "transactionPin": "string (6ä½æ•°å­—äº¤æ˜“å¯†ç ï¼Œå¿…å¡«)"
          },
          "logic": [
            "1. éªŒè¯èº«ä»½ï¼ˆcontext.auth.uidï¼‰",
            "2. ä»custom claimsè·å–organizationIdå’ŒeventId",
            "3. éªŒè¯å¿…è¦å‚æ•°ï¼ˆtoPhoneNumber, amountï¼‰",
            "4. éªŒè¯transactionPinæ ¼å¼ï¼ˆå¿…é¡»æ˜¯6ä½æ•°å­—ï¼š/^\\d{6}$/ï¼‰",
            "5. è¯»å–è½¬å‡ºæ–¹Customeræ–‡æ¡£",
            "6. ä½¿ç”¨ verifyTransactionPinInternal éªŒè¯äº¤æ˜“å¯†ç ï¼š",
            "   ï¼ˆé€»è¾‘åŒprocessCustomerPaymentï¼Œæ­¥éª¤5ï¼‰",
            "7. æŸ¥è¯¢æ¥æ”¶æ–¹Customerï¼š",
            "   a. ç”Ÿæˆæ‰‹æœºå·å˜ä½“ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰ï¼š",
            "      - åŸå§‹å·ç ï¼ˆå¦‚ï¼š0123456789ï¼‰",
            "      - å›½é™…æ ¼å¼ï¼ˆå¦‚ï¼š+60123456789ï¼‰",
            "      - å»0æ ¼å¼ï¼ˆå¦‚ï¼š123456789ï¼‰",
            "   b. éå†å˜ä½“æŸ¥è¯¢ users é›†åˆï¼ˆbasicInfo.phoneNumberï¼‰",
            "   c. éªŒè¯æ¥æ”¶æ–¹å­˜åœ¨ä¸”è§’è‰²åŒ…å«'customer'",
            "   d. éªŒè¯ä¸æ˜¯è½¬ç»™è‡ªå·±",
            "8. ä½¿ç”¨Firestore Transactionæ‰§è¡Œè½¬è´¦ï¼š",
            "   a. æ‰£é™¤è½¬å‡ºæ–¹ä½™é¢ï¼š",
            "      - availablePoints -= amount",
            "      - totalSpent += amount",
            "      - transferOutCount += 1",
            "   b. å¢åŠ æ¥æ”¶æ–¹ä½™é¢ï¼š",
            "      - availablePoints += amount",
            "      - totalReceived += amount",
            "      - transferInCount += 1",
            "   c. æ›´æ–°åŒæ–¹ç»Ÿè®¡æ•°æ®ï¼ˆtransactionCount, lastActivityAtï¼‰",
            "   d. åˆ›å»ºtransactionè®°å½•ï¼ˆtype='customer_transfer'ï¼‰ï¼š",
            "      - åŒ…å«fromUserå’ŒtoUserå®Œæ•´ä¿¡æ¯",
            "      - pinVerified=true, verificationMethod='transaction_pin'",
            "9. è¿”å›ç»“æœï¼š{ success, transactionId, remainingBalance }"
          ],
          "returns": {
            "success": "boolean",
            "transactionId": "string",
            "remainingBalance": "number",
            "recipientName": "string",
            "message": "string"
          },
          "errors": [
            "invalid-argument: å‚æ•°æ— æ•ˆæˆ–æ ¼å¼é”™è¯¯",
            "unauthenticated: æœªç™»å½•",
            "not-found: æ¥æ”¶æ–¹ä¸å­˜åœ¨æˆ–ä¸æ˜¯Customer",
            "failed-precondition: ä½™é¢ä¸è¶³ã€è´¦æˆ·è¢«é”å®šã€ä¸èƒ½è½¬ç»™è‡ªå·±",
            "permission-denied: äº¤æ˜“å¯†ç é”™è¯¯ï¼ˆåŒ…å«å‰©ä½™å°è¯•æ¬¡æ•°ï¼‰"
          ]
        },
        "topupFromPointCard": {
          "name": "topupFromPointCard",
          "trigger": "HTTP Callable",
          "description": "Customeræ‰«ç‚¹æ•°å¡å……å€¼",
          "parameters": {
            "cardId": "string"
          },
          "logic": [
            "1. è¯»å–pointCardæ–‡æ¡£",
            "2. éªŒè¯å¡ç‰‡æœ‰æ•ˆï¼ˆisActive && !isExpired && !isDestroyedï¼‰",
            "3. ä½¿ç”¨Firestore Transaction:",
            "   a. å°†å¡ç‰‡ä½™é¢è½¬å…¥Customerè´¦æˆ·",
            "   b. é”€æ¯å¡ç‰‡ï¼ˆisActive=false, isDestroyed=trueï¼‰",
            "   c. åˆ›å»ºtransactionè®°å½•ï¼ˆtype='point_card_topup'ï¼‰",
            "   d. æ›´æ–°Customerç»Ÿè®¡"
          ],
          "returns": {
            "success": "boolean",
            "amount": "number (å……å€¼é‡‘é¢)",
            "transactionId": "string"
          }
        },
        "createPointCard": {
          "name": "createPointCard",
        },
        "queryPointCardBalance": {
          "name": "queryPointCardBalance",
        },
        "processPointCardPayment": {
          "name": "processPointCardPayment",
          "trigger": "HTTP Callable",
          "description": "ç‚¹æ•°å¡æ”¯ä»˜ç»™Merchant",
          "parameters": {
            "cardId": "string",
            "merchantId": "string",
            "amount": "number"
          },
          "logic": [
            "1. è¯»å–pointCardæ–‡æ¡£",
            "2. éªŒè¯å¡ç‰‡æœ‰æ•ˆä¸”ä½™é¢å……è¶³",
            "3. ä½¿ç”¨Firestore Transaction:",
            "   a. æ‰£é™¤å¡ç‰‡ä½™é¢",
            "   b. å¢åŠ Merchant revenue",
            "   c. åˆ›å»ºtransactionè®°å½•ï¼ˆtype='point_card_payment'ï¼‰",
            "   d. æ›´æ–°å¡ç‰‡ä½¿ç”¨ç»Ÿè®¡",
            "4. å¦‚æœä½™é¢ä¸º0ï¼Œæ ‡è®°isEmpty=true"
          ],
          "returns": {
            "success": "boolean",
            "transactionId": "string",
            "remainingBalance": "number (å¡ç‰‡å‰©ä½™ä½™é¢)"
          }
        },
        "confirmCashSubmission": {
          "name": "confirmCashSubmission",
        },
        "batchConfirmSubmissions": {
          "name": "batchConfirmSubmissions",
        },
        "generateFinanceReport": {
          "name": "generateFinanceReport",
        },
        "submitCashToFinance": {
          "name": "submitCashToFinance",
        },
        "verifyTransactionPinInternal": {
          "name": "verifyTransactionPinInternal",
          "type": "Internal Function",
          "description": "éªŒè¯äº¤æ˜“å¯†ç ï¼ˆå†…éƒ¨å‡½æ•°ï¼Œä¸ç›´æ¥æš´éœ²ï¼‰",
          "parameters": {
            "transactionPin": "string (6ä½æ•°å­—)",
            "userData": "object (ç”¨æˆ·æ–‡æ¡£æ•°æ®)"
          },
          "logic": [
            "1. æ£€æŸ¥é”å®šçŠ¶æ€ï¼š",
            "   - è¯»å– userData.basicInfo.pinLockedUntil",
            "   - å¦‚æœå½“å‰æ—¶é—´ < pinLockedUntilï¼Œè¿”å›é”å®šé”™è¯¯",
            "2. æ£€æŸ¥å¤±è´¥æ¬¡æ•°ï¼š",
            "   - è¯»å– userData.basicInfo.pinFailedAttempts",
            "   - å¦‚æœ >= 5ï¼Œè¿”å›é”å®šé”™è¯¯",
            "3. æ£€æŸ¥PINæ˜¯å¦å·²è®¾ç½®ï¼š",
            "   - è¯»å– userData.basicInfo.transactionPinHash",
            "   - å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›æœªè®¾ç½®é”™è¯¯",
            "4. æ£€æµ‹åŠ å¯†æ–¹å¼ï¼š",
            "   - æ£€æŸ¥ userData.basicInfo.transactionPinSalt",
            "   - æœ‰Salt â†’ ä½¿ç”¨SHA256éªŒè¯ï¼ˆæ—§æ ¼å¼ï¼Œå‘åå…¼å®¹ï¼‰",
            "   - æ— Salt â†’ ä½¿ç”¨bcryptéªŒè¯ï¼ˆæ–°æ ¼å¼ï¼‰",
            "5. éªŒè¯PINï¼š",
            "   - SHA256: sha256(pin + salt) === pinHash",
            "   - bcrypt: bcrypt.compare(pin, pinHash)",
            "6. è¿”å›éªŒè¯ç»“æœï¼š",
            "   - æˆåŠŸï¼š{ success: true }",
            "   - å¤±è´¥ï¼š{ success: false, currentAttempts, error }",
            "   - é”å®šï¼š{ success: false, locked: true, error }"
          ],
          "constants": {
            "MAX_ATTEMPTS": "5 (æœ€å¤§å¤±è´¥æ¬¡æ•°)",
            "LOCK_DURATION": "3600000 (é”å®šæ—¶é•¿ï¼Œæ¯«ç§’ï¼Œ1å°æ—¶)"
          }
        },
        "updatePinVerificationStatus": {
          "name": "updatePinVerificationStatus",
          "type": "Internal Function",
          "description": "æ›´æ–°PINéªŒè¯çŠ¶æ€ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰",
          "parameters": {
            "userRef": "DocumentReference (ç”¨æˆ·æ–‡æ¡£å¼•ç”¨)",
            "success": "boolean (éªŒè¯æ˜¯å¦æˆåŠŸ)",
            "currentAttempts": "number (å½“å‰å¤±è´¥æ¬¡æ•°ï¼Œå¯é€‰)"
          },
          "logic": [
            "å¦‚æœéªŒè¯æˆåŠŸï¼š",
            "  - é‡ç½® basicInfo.pinFailedAttempts = 0",
            "  - æ¸…é™¤ basicInfo.pinLockedUntil = null",
            "å¦‚æœéªŒè¯å¤±è´¥ï¼š",
            "  - å¢åŠ  basicInfo.pinFailedAttempts += 1",
            "  - å¦‚æœæ–°çš„æ¬¡æ•° >= 5ï¼š",
            "    - è®¾ç½® basicInfo.pinLockedUntil = now + 1å°æ—¶",
            "    - è®°å½•é”å®šæ—¶é—´"
          ]
        }
      },
      "securityRules": {
        "description": "Firestore Security Rules æ¦‚è§ˆ",
        "principles": [
          "ä¸‰å±‚æƒé™æ¶æ„ï¼šPlatform Adminï¼ˆå¹³å°çº§ï¼‰-> Organizationï¼ˆç»„ç»‡çº§ï¼‰-> Eventï¼ˆæ´»åŠ¨çº§ï¼Œç”± Event Manager ç®¡ç†ï¼‰",
          "Platform Admin æƒé™ï¼šå¯ä»¥åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰ Organizationï¼›å¯ä»¥åˆ›å»º Event å¹¶æŒ‡å®š Event Manager",
          "Event Manager æƒé™ï¼šæ¯ä¸ª Event åªæœ‰ä¸€ä¸ª Event Managerï¼›åªèƒ½ç®¡ç†è‡ªå·±è´Ÿè´£çš„ Event å†…çš„æ•°æ®ï¼›ä¸åˆ†é…ç‚¹æ•°ï¼›ä¸å…¼ä»»å…¶ä»–è§’è‰²ï¼›çº¯ç›‘æ§æ‰€æœ‰äººå‘˜æ•°æ®",
          "å®Œå…¨æ•°æ®éš”ç¦»ï¼šä¸åŒ Organization å’Œ Event ä¹‹é—´çš„æ•°æ®å®Œå…¨éš”ç¦»",
          "è§’è‰²æƒé™ï¼šåŸºäºç”¨æˆ·è§’è‰²ï¼ˆPlatform Admin, Event Manager, Seller Manager, Seller, Merchant, Customer, Financeï¼‰æ§åˆ¶è®¿é—®",
          "æ‰€æœ‰æƒéªŒè¯ï¼šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®æˆ–ç®¡ç†èŒƒå›´å†…çš„æ•°æ®",
          "Seller Manager æƒé™ï¼šåªèƒ½ç®¡ç† managedDepartments å†…çš„ç”¨æˆ·æ•°æ®",
          "ç»Ÿè®¡æ•°æ®ä¿æŠ¤ï¼šç»Ÿè®¡æ–‡æ¡£åªèƒ½ç”±ç³»ç»Ÿï¼ˆCloud Functionsï¼‰å†™å…¥ï¼Œç”¨æˆ·åªè¯»"
        ],
        "ruleExamples": {
          "admin_uids": {
            "read": "å·²è®¤è¯çš„ Platform Admin å¯è¯»",
            "write": "ä»…è¶…çº§ç®¡ç†å‘˜æƒé™ï¼ˆé€šè¿‡ Cloud Functionsï¼‰"
          },
          "organizations": {
            "read": "Platform Admin å¯ä»¥è¯»å–æ‰€æœ‰ç»„ç»‡ï¼›Event Manager å¯ä»¥è¯»å–è‡ªå·±æ‰€åœ¨ç»„ç»‡",
            "write": "ä»… Platform Admin å¯ä»¥åˆ›å»ºå’Œä¿®æ”¹ç»„ç»‡ä¿¡æ¯"
          },
          "organizations/{orgId}/events": {
            "read": "Platform Admin å’Œå¯¹åº”çš„ Event Manager å¯è¯»",
            "write": "Platform Admin å¯ä»¥åˆ›å»º Eventï¼›Event Manager å¯ä»¥ä¿®æ”¹è‡ªå·±ç®¡ç†çš„ Event"
          },
          "organizations/{orgId}/events/{eventId}/users": {
            "read": "ç”¨æˆ·å¯ä»¥è¯»å–è‡ªå·±çš„æ•°æ®ï¼›Event Manager å¯ä»¥è¯»å–æ‰€æœ‰ç”¨æˆ·ï¼›Seller Manager å¯ä»¥è¯»å– managedDepartments å†…çš„ç”¨æˆ·",
            "write": "ç”¨æˆ·åªèƒ½æ›´æ–°è‡ªå·±çš„åŸºæœ¬ä¿¡æ¯ï¼›Event Manager å¯ä»¥åˆ›å»º/æ›´æ–°ç”¨æˆ·ï¼›Seller Manager å¯ä»¥æ›´æ–°ç®¡ç†èŒƒå›´å†…çš„ç”¨æˆ·"
          },
          "organizations/{orgId}/events/{eventId}/users/{eventManagerId}": {
            "read": "Event Manager å¯ä»¥è¯»å–è‡ªå·±çš„æ•°æ®ï¼›Platform Admin å¯è¯»ï¼›å…¶ä»–ç”¨æˆ·ä¸å¯è¯»",
            "write": "Platform Admin å¯ä»¥åˆ›å»º/ä¿®æ”¹ Event Managerï¼›Event Manager ä¸èƒ½ä¿®æ”¹è‡ªå·±çš„ rolesï¼›ä¸èƒ½åˆ é™¤è‡ªå·±",
            "note": "Event Manager é€šè¿‡ roles=['eventManager'] è¯†åˆ«ï¼Œæ¯ä¸ª Event åªèƒ½æœ‰ä¸€ä¸ª"
          },
          "organizations/{orgId}/events/{eventId}/departmentStats": {
            "read": "Event Manager å’Œç›¸å…³ Seller Manager å¯è¯»",
            "write": "ä»… Cloud Functions å¯å†™"
          },
          "organizations/{orgId}/events/{eventId}/transactions": {
            "read": "äº¤æ˜“åŒæ–¹å’Œ Event Manager å¯è¯»",
            "write": "Seller/Merchant å¯ä»¥åˆ›å»ºäº¤æ˜“ï¼›Event Manager å¯ä»¥ä¿®æ”¹äº¤æ˜“"
          }
        }
      },
      "dataFlowExamples": {
        "platformAdminCreatesEvent": {
          "description": "Platform Admin åˆ›å»º Event å¹¶æŒ‡å®š Event Manager",
          "steps": [
            "1. Platform Admin åœ¨ frontend è¾“å…¥ Event åŸºæœ¬ä¿¡æ¯",
            "2. Platform Admin æ‰‹åŠ¨è¾“å…¥ contactPerson ä¿¡æ¯ï¼ˆå§“åã€ç”µè¯ã€é‚®ç®±ã€èŒä½ï¼‰",
            "3. Platform Admin è¾“å…¥ Event Manager çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€ç”µè¯ã€å¯†ç ç­‰ï¼‰",
            "4. Frontend è°ƒç”¨ Cloud Function: createEvent",
            "5. Cloud Function åˆ›å»º Event æ–‡æ¡£ï¼ˆåŒ…å« contactPersonï¼‰",
            "6. Cloud Function åœ¨ users é›†åˆä¸­åˆ›å»º Event Manager æ–‡æ¡£ï¼š",
            "   organizations/{orgId}/events/{eventId}/users/{eventManagerId}",
            "7. Event Manager æ–‡æ¡£åŒ…å«ï¼š",
            "   - roles: ['eventManager']",
            "   - eventManager: { permissions, restrictions, monitoringScope }",
            "   - basicInfo: { å§“åã€ç”µè¯ã€é‚®ç®±ç­‰ }",
            "8. Cloud Function ä¸º Event Manager ç”Ÿæˆç™»å½•å‡­è¯",
            "9. è¿”å›æˆåŠŸï¼ŒPlatform Admin å¯ä»¥é€šçŸ¥ Event Manager ç™»å½•ä¿¡æ¯"
          ],
          "note": "contactPerson ä¸ Event Manager å¯ä»¥æ˜¯åŒä¸€äººï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒäºº"
        },
        "sellerManagerAllocatesPoints": {
          "description": "Seller Manager åˆ†é…ç‚¹æ•°ç»™éƒ¨é—¨å†…çš„ Seller",
          "steps": [
            "1. Seller Manager åœ¨ frontend è¾“å…¥åˆ†é…ä¿¡æ¯",
            "2. Frontend è°ƒç”¨ Cloud Function: allocatePointsBySellerManager",
            "3. Cloud Function éªŒè¯æƒé™ï¼ˆæ£€æŸ¥ managedDepartmentsï¼‰",
            "4. Cloud Function æ£€æŸ¥é™é¢ï¼ˆpointAllocationRules.sellerManager.maxPerAllocationï¼‰",
            "5. Cloud Function åˆ›å»ºæ–‡æ¡£ï¼šorganizations/{orgId}/events/{eventId}/users/{sellerManagerId}/pointAllocations/{allocationId}",
            "6. Firestore è§¦å‘å™¨ï¼šonSellerManagerAllocation",
            "7. æ›´æ–°æ¥æ”¶è€…çš„ pointsStats",
            "8. æ›´æ–° departmentStats",
            "9. æ›´æ–° sellerManagerStats",
            "10. æ£€æŸ¥æ”¶æ¬¾è­¦ç¤º"
          ]
        },
        "sellerSellsToCustomer": {
          "description": "Seller å”®å‡ºç‚¹æ•°ç»™ Customer",
          "steps": [
            "1. Seller åœ¨ frontend æ‰«æ Customer äºŒç»´ç ï¼Œè¾“å…¥ç‚¹æ•°",
            "2. Frontend è°ƒç”¨ Cloud Function: createTransaction",
            "3. Cloud Function éªŒè¯ï¼šSeller æœ‰è¶³å¤Ÿçš„ç‚¹æ•°ä½™é¢ï¼ˆcurrentBalanceï¼‰",
            "4. Cloud Function åˆ›å»ºäº¤æ˜“ï¼šorganizations/{orgId}/events/{eventId}/transactions/{transactionId}",
            "5. Firestore è§¦å‘å™¨ï¼šonTransaction",
            "6. æ›´æ–° Seller çš„ pointsStatsï¼ˆå‡å°‘ currentBalanceï¼Œå¢åŠ  totalSoldï¼‰",
            "7. æ›´æ–° Customer çš„ customer.availablePointsï¼ˆå¢åŠ ï¼‰",
            "8. æ›´æ–° departmentStats",
            "9. æ›´æ–° Event.globalPointsStats"
          ]
        },
        "customerPaysMerchant": {
          "description": "Customer æƒæå•†å®¶ QR Code ä¸¦ä»˜æ¬¾",
          "steps": [
            "1. Merchant åœ¨ MerchantManager Dashboard é¡¯ç¤º QR Code",
            "2. Customer ä½¿ç”¨æ‰‹æ©Ÿæƒæ QR Code",
            "3. Customer é€²å…¥ä»˜æ¬¾é é¢ï¼Œé¡¯ç¤ºå•†å®¶è³‡è¨Šå’Œè‡ªå·±çš„é¤˜é¡",
            "4. Customer è¼¸å…¥ä»˜æ¬¾é‡‘é¡ä¸¦ç¢ºèª",
            "5. Frontend èª¿ç”¨ Cloud Function: processPayment",
            "6. Cloud Function åŸ·è¡Œäº¤æ˜“ï¼ˆä½¿ç”¨ Firestore Transactionï¼‰ï¼š",
            "   - æ‰£é™¤ Customer points",
            "   - å¢åŠ  Merchant revenue",
            "   - å‰µå»ºäº¤æ˜“è¨˜éŒ„",
            "7. Firestore è§¸ç™¼å™¨ï¼šonMerchantTransaction",
            "8. æ›´æ–°å„ç¨®çµ±è¨ˆæ•¸æ“š",
            "9. è¿”å›æˆåŠŸï¼Œé¡¯ç¤ºäº¤æ˜“å®Œæˆç•«é¢",
            "10. Merchant Dashboard å³æ™‚æ›´æ–°æ”¶å…¥çµ±è¨ˆ"
          ]
        },
        "merchantViewsTransactions": {
          "description": "Merchant Manager æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„",
          "steps": [
            "1. Merchant Manager ç™»å…¥ä¸¦é€²å…¥ Dashboard",
            "2. Frontend è¨‚é–± transactions é›†åˆï¼ˆwhere merchantId == currentMerchantIdï¼‰",
            "3. ä½¿ç”¨ Firestore onSnapshot å¯¦æ™‚ç›£è½æ–°äº¤æ˜“",
            "4. é¡¯ç¤ºäº¤æ˜“åˆ—è¡¨ï¼ˆè„«æ•é¡¯ç¤ºé¡§å®¢é›»è©±ï¼‰",
            "5. å¯ç¯©é¸æ™‚é–“ç¯„åœï¼ˆä»Šæ—¥/æœ¬é€±/å…¨éƒ¨ï¼‰",
            "6. é¡¯ç¤ºçµ±è¨ˆå¡ç‰‡ï¼ˆç¸½æ”¶å…¥ã€ä»Šæ—¥æ”¶å…¥ã€äº¤æ˜“ç­†æ•¸ï¼‰"
          ]
        }
      },
      "integrationNotes": {
        "existingSystemIntegration": [
          "Merchant å’Œ Customer éƒ½æ˜¯ users é›†åˆä¸­çš„è§’è‰²",
          "transactions é›†åˆçµ±ä¸€ç®¡ç†æ‰€æœ‰äº¤æ˜“ï¼ˆç”¨ transactionType å€åˆ†ï¼‰",
          "çµ±è¨ˆè³‡æ–™åˆ†æ•£åœ¨å¤šè™•ï¼ˆmerchantæ–‡æª”ã€usersæ–‡æª”ã€departmentStatsï¼‰éœ€ä¿æŒä¸€è‡´æ€§",
          "ä½¿ç”¨ Cloud Functions ç¢ºä¿åŸå­æ€§æ“ä½œå’Œè³‡æ–™ä¸€è‡´æ€§"
        ],
        "securityConsiderations": [
          "Customer ä»˜æ¬¾æ™‚å¿…é ˆé©—è­‰èº«ä»½ï¼ˆrequest.authï¼‰",
          "ä¸èƒ½è®“ Customer ç›´æ¥ä¿®æ”¹ Merchant æ”¶å…¥",
          "äº¤æ˜“è¨˜éŒ„åªèƒ½é€é Cloud Function å‰µå»º",
          "é›»è©±è™Ÿç¢¼å¿…é ˆè„«æ•é¡¯ç¤º",
          "QR Code å¯åŠ å…¥æ™‚æ•ˆæ€§é©—è­‰ï¼ˆå¯é¸ï¼‰"
        ],
        "performanceConsiderations": [
          "transactions é›†åˆæœƒå¿«é€Ÿå¢é•·ï¼Œéœ€è¦é©ç•¶çš„ç´¢å¼•",
          "è€ƒæ…®åˆ†é è¼‰å…¥äº¤æ˜“è¨˜éŒ„ï¼ˆlimit + startAfterï¼‰",
          "çµ±è¨ˆè³‡æ–™ä½¿ç”¨ increment() è€Œéè®€å–-ä¿®æ”¹-å¯«å…¥",
          "Dashboard çµ±è¨ˆå¯ä»¥ç·©å­˜ 30 ç§’æ¸›å°‘æŸ¥è©¢"
        ]
      }
    },
    "pathSummary": {
      "description": "å®Œæ•´è·¯å¾„å‚è€ƒ",
      "topLevelCollections": [
        "admin_uids/{adminUid}",
        "organizations/{organizationId}",
        "otp_sessions/{sessionId}",
        "platform_settings/config"
      ],
      "organizationSubcollections": [
        "organizations/{organizationId}/events/{eventId}"
      ],
      "eventSubcollections": [
        "organizations/{organizationId}/events/{eventId}/users/{userId}",
        "organizations/{organizationId}/events/{eventId}/departmentStats/{departmentCode}",
        "organizations/{organizationId}/events/{eventId}/sellerManagerStats/{sellerManagerId}",
        "organizations/{organizationId}/events/{eventId}/financeManagerStats/{financeManagerId}",
        "organizations/{organizationId}/events/{eventId}/merchants/{merchantId}",
        "organizations/{organizationId}/events/{eventId}/transactions/{transactionId}",
        "organizations/{organizationId}/events/{eventId}/cashCollections/{collectionId}",
        "organizations/{organizationId}/events/{eventId}/cashSubmissions/{submissionId}",
        "organizations/{organizationId}/events/{eventId}/departments/{departmentCode}",
        "organizations/{organizationId}/events/{eventId}/pointCards/{cardId}"
      ],
      "userSubcollections": [
        "organizations/{organizationId}/events/{eventId}/users/{sellerManagerId}/pointAllocations/{allocationId}",
        "organizations/{organizationId}/events/{eventId}/users/{financeManagerId}/pointAllocations/{allocationId}"
      ]
    }
  }
}