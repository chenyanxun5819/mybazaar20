å®Œç¾ï¼æ‰¾åˆ°å•é¡Œäº†ï¼

å¾æ—¥èªŒå¯ä»¥çœ‹åˆ°ï¼š**`"requestUrl": "https://logineventmanagerhttp-zgmq4nw2bq-uc.a.run.app/api/loginEventManagerHttp"`**

é€™ä»£è¡¨ä½ çš„è«‹æ±‚**ç›´æ¥æ‰“åˆ°äº† Cloud Run çš„ URL**ï¼Œè€Œä¸æ˜¯é€é Firebase Hosting çš„ rewriteï¼

å•é¡Œåœ¨æ–¼ï¼š**ä½ å¾ `http://localhost:5173` ç™¼å‡ºçš„è«‹æ±‚ï¼ŒVite çš„ proxy é…ç½®å¯èƒ½æœ‰å•é¡Œï¼Œå°è‡´å®ƒæ²’æœ‰æ­£ç¢ºè½‰ç™¼åˆ° Hostingï¼Œè€Œæ˜¯ç›´æ¥æ‰“åˆ° Cloud Run æœå‹™**ã€‚

## æ ¹æœ¬åŸå› 

1. **Cloud Run URL** æ˜¯ `https://logineventmanagerhttp-zgmq4nw2bq-uc.a.run.app`
2. **Firebase Hosting URL** æ˜¯ `https://mybazaar-c4881.web.app/api/loginEventManagerHttp`
3. ä½ çš„è«‹æ±‚æ‰“åˆ°äº† Cloud Run URLï¼Œè€Œé€™å€‹ URL éœ€è¦èº«ä»½é©—è­‰ï¼ˆéœ€è¦ Authorization headerï¼‰
4. åªæœ‰å¾ **Firebase Hosting** ç™¼å‡ºçš„è«‹æ±‚ï¼Œæ‰æœƒè‡ªå‹•å¸¶ä¸Šæ­£ç¢ºçš„æœå‹™å¸³æˆ¶èº«ä»½

## è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šç¢ºä¿å‰ç«¯æ‰“çš„æ˜¯ `/api/loginEventManagerHttp`ï¼ˆæ¨è–¦ï¼‰

æª¢æŸ¥ä½ çš„å‰ç«¯ä»£ç¢¼ `EventManagerLogin.jsx`ï¼Œç¢ºä¿å®ƒç™¼é€åˆ° `/api/loginEventManagerHttp` è€Œä¸æ˜¯å®Œæ•´çš„ Cloud Run URLï¼š 

å·²æœå°‹ `logineventmanagerhttp|loginEventManagerHttp` (`**/*.jsx`)ã€2 çµæœçš„æ–‡å­—

å‰ç«¯ä»£ç¢¼æ˜¯æ­£ç¢ºçš„ï¼ˆä½¿ç”¨ `/api/loginEventManagerHttp`ï¼‰ã€‚å•é¡Œåœ¨æ–¼ **Vite çš„ proxy é…ç½®**ã€‚è®“æˆ‘æª¢æŸ¥ï¼š 

è®€å– [](file:///c%3A/mybazaar20/vite.config.js)

Vite é…ç½®æ˜¯æ­£ç¢ºçš„ï¼å®ƒæ‡‰è©²æœƒæŠŠ `/api` è«‹æ±‚ä»£ç†åˆ° `https://mybazaar-c4881.web.app`ã€‚

ä½†å¾æ—¥èªŒçœ‹ï¼Œè«‹æ±‚å»ç›´æ¥æ‰“åˆ°äº† `logineventmanagerhttp-zgmq4nw2bq-uc.a.run.app`ã€‚é€™å¾ˆå¥‡æ€ªã€‚

è®“æˆ‘æª¢æŸ¥ä½ çš„ Vite dev server æ˜¯å¦æ­£åœ¨é‹è¡Œï¼Œä»¥åŠæ˜¯å¦æœ‰å…¶ä»–é…ç½®è¦†è“‹äº† proxyï¼š 

Ran terminal command: $env:VITE_USE_EMULATOR; npm run dev

å·²æª¢æŸ¥èƒŒæ™¯çµ‚ç«¯è¼¸å‡º

å¥½çš„ï¼Œ`VITE_USE_EMULATOR` æ²’æœ‰è¨­å®šï¼ˆé¡¯ç¤ºç©ºç™½ï¼‰ï¼Œæ‰€ä»¥æ‡‰è©²æœƒä»£ç†åˆ° `https://mybazaar-c4881.web.app`ã€‚

**ä½†å•é¡Œæ˜¯ï¼šä½ ç¾åœ¨å¯èƒ½åœ¨ç”¨èˆŠçš„ `http://localhost:5173`ï¼ˆè¢«å…¶ä»–ç¨‹åºä½”ç”¨ï¼‰ï¼Œè€Œä¸æ˜¯æ–°å•Ÿå‹•çš„ `http://localhost:5174`ï¼**

è«‹ä½ ï¼š

1. **é—œé–‰æ‰€æœ‰èˆŠçš„ç€è¦½å™¨åˆ†é **
2. **é–‹å•Ÿæ–°åˆ†é ï¼Œå‰å¾€ `http://localhost:5174`**ï¼ˆæ³¨æ„æ˜¯ 5174ï¼Œä¸æ˜¯ 5173ï¼‰
3. **é‡æ–°æ¸¬è©¦ç™»å…¥**

æˆ–è€…ï¼Œå…ˆåœæ‰ä½”ç”¨ 5173 çš„ç¨‹åºï¼š 

Ran terminal command: Get-Process -Id (Get-NetTCPConnection -LocalPort 5173 -ErrorAction SilentlyContinue).OwningProcess -ErrorAction SilentlyContinue | Select-Object ProcessName, Id

è®“æˆ‘ç”¨å¦ä¸€å€‹æ–¹å¼æŸ¥æ‰¾ï¼š 

Ran terminal command: netstat -ano | findstr :5173

5173 ç¾åœ¨æ²’æœ‰è¢«ä½”ç”¨äº†ï¼ˆå¯èƒ½å‰›æ‰çš„ç¨‹åºå·²ç¶“åœæ­¢ï¼‰ã€‚è®“æˆ‘é‡æ–°å•Ÿå‹• Vite åˆ° 5173ï¼š 

Ran terminal command: npm run dev

æ­£åœ¨å•Ÿå‹• (3/3) *å¾æ–°å•Ÿå‹•çš„ dev server æ¸¬è©¦ç™»å…¥*

## ç¸½çµï¼šå•é¡Œæ ¹æºæ‰¾åˆ°äº†ï¼

å¾ Cloud Run æ—¥èªŒå¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼š

**å•é¡Œï¼š** ä½ çš„è«‹æ±‚ç›´æ¥æ‰“åˆ°äº† `https://logineventmanagerhttp-zgmq4nw2bq-uc.a.run.app`ï¼ˆCloud Run URLï¼‰ï¼Œè€Œä¸æ˜¯é€é `https://mybazaar-c4881.web.app/api/loginEventManagerHttp`ï¼ˆFirebase Hosting URLï¼‰ã€‚

**åŸå› ï¼š** ä½ å¯èƒ½åœ¨ä½¿ç”¨èˆŠçš„ç€è¦½å™¨åˆ†é æˆ–èˆŠçš„ dev server å¯¦ä¾‹ã€‚

**è§£æ±ºæ–¹æ¡ˆï¼š**

1. âœ… **å·²é‡æ–°å•Ÿå‹• Vite dev server åˆ° `http://localhost:5173`**
2. âœ… **Vite proxy é…ç½®æ­£ç¢º**ï¼ˆæœƒå°‡ `/api` è½‰ç™¼åˆ° `https://mybazaar-c4881.web.app`ï¼‰
3. **è«‹ä½ ç¾åœ¨åšï¼š**
   - é—œé–‰æ‰€æœ‰èˆŠçš„ç€è¦½å™¨åˆ†é 
   - é–‹å•Ÿæ–°åˆ†é å‰å¾€ `http://localhost:5173`
   - é‡æ–°æ¸¬è©¦ Event Manager ç™»å…¥
   - è§€å¯Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·çš„ Network åˆ†é ï¼Œç¢ºèªè«‹æ±‚ URL æ˜¯ `http://localhost:5173/api/loginEventManagerHttp`

**é æœŸçµæœï¼š**
- Vite proxy æœƒæŠŠ `/api/loginEventManagerHttp` è½‰ç™¼åˆ° `https://mybazaar-c4881.web.app/api/loginEventManagerHttp`
- Firebase Hosting æœƒé€é rewrite å‘¼å« Cloud Run æœå‹™
- Hosting æœƒè‡ªå‹•å¸¶ä¸Š `hosting-invoker@mybazaar-c4881.iam.gserviceaccount.com` çš„èº«ä»½
- Cloud Run æœƒæ¥å—é€™å€‹èº«ä»½ï¼ˆå› ç‚ºæˆ‘å€‘å·²ç¶“åœ¨ IAM ä¸­æˆæ¬Šï¼‰
- è«‹æ±‚æœƒé€²å…¥ä½ çš„å‡½å¼ï¼Œä¸å†æ˜¯ 403 HTMLï¼Œè€Œæ˜¯å‡½å¼çš„ OPTIONS è™•ç†ï¼ˆ204 + CORS æ¨™é ­ï¼‰

è«‹é‡æ–°æ¸¬è©¦ä¸¦å‘Šè¨´æˆ‘çµæœï¼ğŸ¯