# MyBazaar - ç¾©è³£æœƒç®¡ç†ç³»çµ±å°ˆæ¡ˆæ–‡æª”

## å°ˆæ¡ˆæ¦‚è¿°

MyBazaar æ˜¯ä¸€å€‹ç‚ºç¾©è³£æœƒè¨­è¨ˆçš„ç„¡ç´™åŒ–å›ºæœ¬ç®¡ç†ç³»çµ±ã€‚è©²ç³»çµ±æ”¯æŒå¤šè§’è‰²ç®¡ç†ã€é»æ•¸äº¤æ˜“ã€å¤šèªè¨€ç•Œé¢ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰ï¼Œä¸¦åŸºæ–¼ Firebase é€²è¡Œæ•¸æ“šç®¡ç†ã€‚

**æŠ€è¡“æ£§ï¼š**
- å‰ç«¯ï¼šHTML5, CSS3, JavaScript (ES6+)
- æ§‹å»ºå·¥å…·ï¼šVite
- å¾Œç«¯æœå‹™ï¼šFirebase (Authentication, Firestore)
- åœ‹éš›åŒ–ï¼šè‡ªå®šç¾© i18n å¯¦ç¾

---

## ç³»çµ±è§’è‰²èªªæ˜

### 1. Super Adminï¼ˆè¶…ç´šç®¡ç†å“¡ï¼‰
- ç³»çµ±æœ€é«˜æ¬Šé™ç®¡ç†å“¡
- è² è²¬ç®¡ç†çµ„ç¹”å’ŒæŒ‡æ´¾ç®¡ç†å“¡
- ç®¡ç†ç³»çµ±é…ç½®å’Œè³‡æœ¬åˆ†é…

### 2. Managerï¼ˆç®¡ç†å“¡ï¼‰
- ç®¡ç†æ´»å‹•çš„ç®¡ç†å“¡
- è² è²¬åˆ†é…è³‡æœ¬çµ¦éŠ·å”®å“¡
- ç®¡ç†ç”¨æˆ¶å’ŒæŸ¥çœ‹äº¤æ˜“è¨˜éŒ„

### 3. Sellerï¼ˆéŠ·å”®å“¡ï¼‰
- éŠ·å”®é»æ•¸çµ¦æ¶ˆè²»è€…
- æŸ¥çœ‹å€‹äººéŠ·å”®è¨˜éŒ„
- ç®¡ç†åº«å­˜é»æ•¸

### 4. Customerï¼ˆæ¶ˆè²»è€…ï¼‰
- è³¼è²·å’Œæ¶ˆè²»é»æ•¸
- æŸ¥çœ‹å€‹äººé¤˜é¡å’Œäº¤æ˜“è¨˜éŒ„

### 5. Merchantï¼ˆå•†å®¶ï¼‰
- æ¥å—é»æ•¸æ¶ˆè²»
- æŸ¥çœ‹æ”¶æ¬¾è¨˜éŒ„

---

## é é¢çµæ§‹èˆ‡åŠŸèƒ½èªªæ˜

### ğŸ“ é¦–é èˆ‡å°èˆª

#### 1. **ç³»çµ±é¦–é **
- **è·¯å¾‘ï¼š** `public-vite/src/home/index.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/home/main.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - ç³»çµ±å…¥å£é é¢
  - æ”¯æ´ä¸­è‹±æ–‡åˆ‡æ›
  - æä¾›ç™»å…¥å…¥å£
  - é¡¯ç¤ºç³»çµ±ç°¡ä»‹

#### 2. **å°èˆªä¸­å¿ƒ**
- **è·¯å¾‘ï¼š** `public-vite/src/home/navigation-center.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/home/navigation-center.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - ç™»å…¥å¾Œçš„å°èˆªæ¨ç´
  - æ ¹æ“šç”¨æˆ¶è§’è‰²é¡¯ç¤ºå°æ‡‰çš„åŠŸèƒ½å¡ç‰‡
  - å¿«é€Ÿå°èˆªåˆ°å„è§’è‰²çš„æ§åˆ¶é¢æ¿
  - é¡¯ç¤ºç”¨æˆ¶åŸºæœ¬è³‡è¨Š
  - æ”¯æ´å¤šèªè¨€åˆ‡æ›
  - ç™»å‡ºåŠŸèƒ½

---

### ğŸ” èªè­‰ç›¸é—œ

#### 3. **ç™»å…¥é é¢**
- **è·¯å¾‘ï¼š** `public-vite/src/auth/login.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/auth/login.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - ç”¨æˆ¶ç™»å…¥ï¼ˆæ‰‹æ©Ÿè™Ÿ + å¯†ç¢¼ï¼‰
  - Firebase Authentication æ•´åˆ
  - ç™»å…¥å¾Œæ ¹æ“šè§’è‰²è·³è½‰åˆ°å°æ‡‰é é¢
  - æ”¯æ´å¤šèªè¨€ç•Œé¢
  - è¨˜ä½æˆ‘åŠŸèƒ½ï¼ˆå¯é¸ï¼‰

#### 4. **è¨»å†Šé é¢ï¼ˆæ¶ˆè²»è€…ï¼‰**
- **è·¯å¾‘ï¼š** `public-vite/src/customer/register.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/customer/register.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - æ¶ˆè²»è€…è‡ªåŠ©è¨»å†Š
  - æ‰‹æ©Ÿè™Ÿé©—è­‰
  - åŸºæœ¬è³‡æ–™å¡«å¯«ï¼ˆè‹±æ–‡åã€ä¸­æ–‡åï¼‰
  - å¯é¸èº«ä»½æ¨™ç±¤ï¼ˆå­¸ç”Ÿ/æ•™å¸«/è·å“¡/å¤–éƒ¨ç”¨æˆ¶ï¼‰
  - OTP é©—è­‰æ”¯æ´
  - è¨­ç½® PIN ç¢¼

---

### ğŸ‘¨â€ğŸ’¼ Super Admin é é¢

#### 5. **Super Admin æ§åˆ¶é¢æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/admin/admin-dashboard.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/admin/admin-dashboard.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - æŸ¥çœ‹å°ˆæ¡ˆé…ç½®è³‡è¨Š
  - é¡¯ç¤ºç³»çµ±çµ±è¨ˆæ•¸æ“š
    - ç¸½åƒèˆ‡è€…æ•¸
    - ç¸½äº¤æ˜“æ•¸
    - è³‡æœ¬åˆ†é…æ¦‚æ³
    - å„è§’è‰²ç”¨æˆ¶æ•¸é‡
  - ç®¡ç†äººå“¡åˆ—è¡¨ï¼ˆManager åˆ—è¡¨ï¼‰
  - ç·¨è¼¯ Manager è³‡æ–™
  - ä¿®æ”¹å¯†ç¢¼
  - å¤šèªè¨€åˆ‡æ›
  - ç™»å‡ºåŠŸèƒ½

#### 6. **å‰µå»º Manager**
- **è·¯å¾‘ï¼š** `public-vite/src/admin/create-manager.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/admin/create-manager.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - æ–°å¢ç®¡ç†å“¡å¸³è™Ÿ
  - å¡«å¯«ç®¡ç†å“¡åŸºæœ¬è³‡æ–™
    - è‹±æ–‡åå­—
    - ä¸­æ–‡åå­—ï¼ˆå¯é¸ï¼‰
    - ç®¡ç†å“¡ç·¨è™Ÿ
    - è¯ç¹«é›»è©±
    - é›»å­éƒµç®±
  - è¨­ç½®åˆå§‹å¯†ç¢¼
  - åˆ†é…èº«ä»½æ¨™ç±¤ï¼ˆteacher/staffï¼‰
  - è‡ªå‹•å‰µå»º Firebase Authentication å¸³è™Ÿ

#### 7. **Admin Bootstrap**
- **è·¯å¾‘ï¼š** `public-vite/src/admin/admin-bootstrap.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/admin/admin-bootstrap.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - ç³»çµ±åˆå§‹åŒ–é é¢
  - å‰µå»ºç¬¬ä¸€å€‹ Super Admin å¸³è™Ÿ
  - åƒ…åœ¨ç³»çµ±é¦–æ¬¡éƒ¨ç½²æ™‚ä½¿ç”¨

---

### ğŸ‘¨â€ğŸ’¼ Manager é é¢

#### 8. **ç”¨æˆ¶ç®¡ç†é é¢**
- **è·¯å¾‘ï¼š** `public-vite/src/manager/admin-manage-users.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/manager/admin-manage-users.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ¶åˆ—è¡¨
  - ç”¨æˆ¶ç¯©é¸åŠŸèƒ½
    - æŒ‰è§’è‰²ç¯©é¸ï¼ˆCustomer/Seller/Merchantï¼‰
    - æŒ‰èº«ä»½æ¨™ç±¤ç¯©é¸
    - æŒ‰æ‰‹æ©Ÿè™Ÿæœå°‹
  - ç”¨æˆ¶çµ±è¨ˆå¡ç‰‡
    - ç¸½ç”¨æˆ¶æ•¸
    - å„è§’è‰²åˆ†ä½ˆ
  - ç·¨è¼¯ç”¨æˆ¶è³‡æ–™
  - æ‰¹é‡å°å…¥éŠ·å”®å“¡
    - CSV æª”æ¡ˆä¸Šå‚³
    - æ•¸æ“šé è¦½èˆ‡é©—è­‰
    - æ‰¹é‡å‰µå»ºå¸³è™Ÿ
  - ä¿®æ”¹å¯†ç¢¼åŠŸèƒ½
  - å›åˆ°é¦–é å°èˆª
  - ç™»å‡ºå¾Œè·³è½‰åˆ°ç³»çµ±é¦–é 

#### 9. **æ–°å¢å•†å®¶**
- **è·¯å¾‘ï¼š** `public-vite/src/manager/add-merchant.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/manager/add-merchant.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - æ–°å¢å•†å®¶å¸³è™Ÿ
  - å¡«å¯«å•†å®¶è³‡æ–™
    - å•†å®¶åç¨±ï¼ˆä¸­è‹±æ–‡ï¼‰
    - è¯çµ¡äººè³‡è¨Š
    - æ‰‹æ©Ÿè™Ÿç¢¼
    - é›»å­éƒµç®±ï¼ˆå¯é¸ï¼‰
    - ç‡Ÿæ¥­æ™‚é–“
    - å•†å®¶é¡å‹
    - å•†å®¶æè¿°
  - å¯é¸æ“‡æ˜¯å¦ç‚ºçµ„ç¹”å…§éƒ¨å•†å®¶
  - æ”¯æ´èº«ä»½æ¨™ç±¤ï¼ˆteacher/staffï¼‰
  - è¡¨å–®é©—è­‰èˆ‡éŒ¯èª¤æç¤º

---

### ğŸ‘¨â€ğŸ’¼ Seller é é¢

#### 10. **éŠ·å”®å“¡æ§åˆ¶é¢æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/seller/seller-dashboard.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/seller/seller-dashboard.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - **ç¸½è¦½æ¨™ç±¤é **
    - é¡¯ç¤ºå¯ç”¨é»æ•¸ï¼ˆå¾ customer.currentBalance è®€å–ï¼‰
    - é¡¯ç¤ºç¸½éŠ·å”®é¡
    - é¡¯ç¤ºä»Šæ—¥éŠ·å”®
    - é¡¯ç¤ºäº¤æ˜“æ¬¡æ•¸
    - è³‡æœ¬ä¾†æºè³‡è¨Šï¼ˆåˆ†é…è€…ã€åˆ†é…æ™‚é–“ï¼‰
    - æœ€è¿‘äº¤æ˜“è¨˜éŒ„ï¼ˆæœ€æ–° 5 ç­†ï¼‰
  - **æ–°éŠ·å”®æ¨™ç±¤é **
    - è¼¸å…¥é¡§å®¢æ‰‹æ©Ÿè™Ÿ
    - è¼¸å…¥éŠ·å”®é»æ•¸
    - è‡ªå‹•è¨ˆç®—éŠ·å”®é‡‘é¡ï¼ˆ1 é» = RM 1ï¼‰
    - é¡¯ç¤ºå¯ç”¨é»æ•¸
    - æäº¤éŠ·å”®äº¤æ˜“
    - å³æ™‚æ‰£æ¸›è³£å®¶é»æ•¸ï¼Œå¢åŠ é¡§å®¢é»æ•¸
  - **éŠ·å”®è¨˜éŒ„æ¨™ç±¤é **
    - å®Œæ•´éŠ·å”®æ­·å²è¨˜éŒ„
    - é¡¯ç¤ºäº¤æ˜“ IDã€é¡§å®¢ã€é»æ•¸ã€é‡‘é¡ã€æ™‚é–“ã€ç‹€æ…‹
  - **å€‹äººè³‡æ–™æ¨™ç±¤é **
    - é¡¯ç¤ºè¯ç¹«è³‡è¨Š
    - é¡¯ç¤ºèº«ä»½è³‡è¨Šï¼ˆä¾æ“š identityTag å‹•æ…‹é¡¯ç¤ºï¼‰
  - èªè¨€åˆ‡æ›ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
  - å›é¦–é æŒ‰éˆ•ï¼ˆå°èˆªåˆ° navigation-center.htmlï¼‰
  - ç™»å‡ºåŠŸèƒ½ï¼ˆè·³è½‰åˆ° index.htmlï¼‰

---

### ğŸª Merchant é é¢

#### 11. **å•†å®¶æ§åˆ¶é¢æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/merchant/merchant-dashboard.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/merchant/merchant-dashboard.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - é¡¯ç¤ºå•†å®¶åŸºæœ¬è³‡è¨Š
  - çµ±è¨ˆå¡ç‰‡
    - ä»Šæ—¥æ”¶æ¬¾
    - æœ¬æœˆæ”¶æ¬¾
    - ç¸½æ”¶æ¬¾
  - QR Code ç”Ÿæˆèˆ‡ç®¡ç†
    - ç”Ÿæˆæ”¯ä»˜ QR Codeï¼ˆåŒ…å«å•†å®¶ IDï¼‰
    - ä¸‹è¼‰ QR Code åœ–ç‰‡
    - é¡§å®¢æƒæå¾Œé€²è¡Œé»æ•¸æ¶ˆè²»
  - éŠ·å”®è¨˜éŒ„åˆ—è¡¨
    - é¡¯ç¤ºæ”¶æ¬¾è¨˜éŒ„
    - äº¤æ˜“æ™‚é–“ã€é¡§å®¢ã€é»æ•¸
  - ç™»å‡ºåŠŸèƒ½

---

### ğŸ‘¤ Customer é é¢

#### 12. **æ¶ˆè²»è€…æ§åˆ¶é¢æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/customer/customer-dashboard.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/customer/customer-dashboard.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - é¡¯ç¤ºç•¶å‰é»æ•¸é¤˜é¡
  - é¡¯ç¤ºç¸½è³¼è²·é»æ•¸
  - é¡¯ç¤ºç¸½æ¶ˆè²»é»æ•¸
  - äº¤æ˜“æ­·å²è¨˜éŒ„
    - è³¼è²·è¨˜éŒ„
    - æ¶ˆè²»è¨˜éŒ„
  - æƒæ QR Code é€²è¡Œæ¶ˆè²»
  - å€‹äººè³‡æ–™æŸ¥çœ‹
  - ç™»å‡ºåŠŸèƒ½

---

### ğŸ’³ äº¤æ˜“ç›¸é—œ

#### 13. **æ¶ˆè²»è€…æ”¯ä»˜é é¢**
- **è·¯å¾‘ï¼š** `public-vite/src/transaction/customer-payment.html`
- **å°æ‡‰ JSï¼š** `public-vite/src/transaction/customer-payment.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - æƒæå•†å®¶ QR Code å¾Œé€²å…¥
  - é¡¯ç¤ºå•†å®¶è³‡è¨Š
  - è¼¸å…¥æ¶ˆè²»é»æ•¸
  - ç¢ºèªæ”¯ä»˜
  - PIN ç¢¼é©—è­‰
  - æ‰£æ¸›é¡§å®¢é»æ•¸ï¼Œå¢åŠ å•†å®¶æ”¶æ¬¾
  - é¡¯ç¤ºäº¤æ˜“çµæœ

---

### ğŸ”§ å…±ç”¨æ¨¡çµ„èˆ‡å¾Œç«¯æœå‹™

#### 14. **Firebase é…ç½®**
- **è·¯å¾‘ï¼š** `public-vite/src/shared/firebase.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - Firebase åˆå§‹åŒ–
  - å°å‡º authï¼ˆAuthenticationï¼‰
  - å°å‡º dbï¼ˆFirestoreï¼‰
  - çµ±ä¸€çš„ Firebase é…ç½®ç®¡ç†

#### 15. **åœ‹éš›åŒ–æ¨¡çµ„**
- **è·¯å¾‘ï¼š** `public-vite/src/shared/i18n.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - å¤šèªè¨€ç¿»è­¯ç®¡ç†
  - æ”¯æ´ zh-CNï¼ˆç°¡é«”ä¸­æ–‡ï¼‰å’Œ en-USï¼ˆè‹±æ–‡ï¼‰
  - å‹•æ…‹åˆ‡æ›èªè¨€
  - ç¿»è­¯éµå€¼å°ç®¡ç†
  - é é¢å…ƒç´ è‡ªå‹•æ›´æ–°

#### 16. **èªè­‰ UI æ¨¡æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/common/auth-ui-template.html`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - é€šç”¨çš„èªè­‰é é¢ UI æ¨£å¼
  - ç™»å…¥/è¨»å†Šé é¢å…±ç”¨æ¨¡æ¿

---

### âš™ï¸ Firebase Cloud Functions (å¾Œç«¯æœå‹™)

#### 17. **ä¸»å‡½æ•¸å…¥å£**
- **è·¯å¾‘ï¼š** `functions/src/index.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - Firebase Cloud Functions ä¸»å…¥å£æª”æ¡ˆ
  - å°å‡ºæ‰€æœ‰ Cloud Functions

**ä¸»è¦åŠŸèƒ½å‡½æ•¸ï¼š**

1. **`loginWithPin`** - PIN ç¢¼ç™»å…¥
   - æ¥æ”¶æ‰‹æ©Ÿè™Ÿå’Œ PIN ç¢¼
   - é©—è­‰ç”¨æˆ¶èº«ä»½
   - ç”Ÿæˆ Custom Token
   - è¿”å›ç”¨æˆ¶è³‡è¨Šå’Œè·³è½‰ URL
   - è‡ªå‹•å‰µå»ºæˆ–æ›´æ–° Firebase Auth ç”¨æˆ¶

2. **`changePassword`** - ä¿®æ”¹å¯†ç¢¼
   - é©—è­‰ç•¶å‰å¯†ç¢¼
   - æª¢æŸ¥æ–°å¯†ç¢¼å¼·åº¦ï¼ˆè‡³å°‘ 8 å­—ç¬¦ï¼ŒåŒ…å«è‹±æ–‡å’Œæ•¸å­—ï¼‰
   - æ›´æ–°å¯†ç¢¼ hash
   - å‘å¾Œå…¼å®¹ pinHash æ¬„ä½

3. **`loginAndRedirect`** - ç™»å…¥å¾Œè·³è½‰
   - æ ¹æ“šç”¨æˆ¶è§’è‰²è¿”å›å°æ‡‰çš„è·³è½‰ URL
   - æ”¯æ´å¤šè§’è‰²è™•ç†
   - å„ªå…ˆç´šï¼šsuper_admin > manager > merchant > seller > customer

4. **`sendOtpToPhone`** - ç™¼é€ OTP
   - ç”Ÿæˆ 6 ä½æ•¸ OTP
   - å‰µå»º OTP session
   - è¨­å®š 5 åˆ†é˜éæœŸæ™‚é–“
   - æ•´åˆ Twilioï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

5. **`getManagers`** - ç²å–ç®¡ç†å“¡åˆ—è¡¨
   - æŸ¥è©¢æ‰€æœ‰ Manager
   - è¿”å›ç®¡ç†å“¡è³‡è¨Šé™£åˆ—

**è§’è‰²è·³è½‰é‚è¼¯ï¼š**
```javascript
- super_admin â†’ ../admin/admin-dashboard.html
- manager â†’ ../manager/admin-manage-users.html
- merchant â†’ ../merchant/merchant-dashboard.html
- seller â†’ ../seller/seller-dashboard.html
- customer â†’ ../customer/consume.html
- default â†’ ../home/index.html
```

#### 18. **ç®¡ç†å“¡å‡½æ•¸æ¨¡çµ„**
- **è·¯å¾‘ï¼š** `functions/src/admin.js`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - ç®¡ç†å“¡ç›¸é—œçš„ Cloud Functions
  - ç³»çµ±åˆå§‹åŒ–å’Œé…ç½®ç®¡ç†

**ä¸»è¦åŠŸèƒ½å‡½æ•¸ï¼š**

1. **`checkAdminExists`** - æª¢æŸ¥ç®¡ç†å“¡æ˜¯å¦å­˜åœ¨
   - æŸ¥è©¢æ˜¯å¦å·²æœ‰ super_admin
   - ç”¨æ–¼ç³»çµ±åˆå§‹åŒ–æª¢æŸ¥

2. **`createInitialAdmin`** - å‰µå»ºåˆå§‹è¶…ç´šç®¡ç†å“¡
   - ç³»çµ±é¦–æ¬¡éƒ¨ç½²æ™‚å‰µå»ºç¬¬ä¸€å€‹ super_admin
   - æ”¯æ´å¤šè§’è‰²åˆ†é…ï¼ˆsuper_admin + seller + customer + merchant å¯é¸ï¼‰
   - é©—è­‰èº«ä»½æ¨™ç±¤ï¼ˆåƒ…å…è¨± staff æˆ– teacherï¼‰
   - å‰µå»º Firebase Auth å¸³è™Ÿ
   - åˆå§‹åŒ– Firestore ç”¨æˆ¶æ–‡æª”ï¼ˆå®Œå…¨ç¬¦åˆæ–°æ¶æ§‹ï¼‰
   - è¨­ç½®åˆå§‹è³‡æœ¬é¡åº¦
   - ä¿å­˜å°ˆæ¡ˆé…ç½®è³‡è¨Š
   - åˆå§‹åŒ–å…¨å±€è¨­å®š
   
   **å¿…å¡«æ¬„ä½ï¼š**
   - phoneNumber: æ‰‹æ©Ÿè™Ÿç¢¼
   - englishName: è‹±æ–‡åå­—
   - email: é›»å­éƒµç®±
   - password: åˆå§‹å¯†ç¢¼
   - identityTag: èº«ä»½æ¨™ç±¤ï¼ˆstaff/teacherï¼‰
   
   **å¯é¸æ¬„ä½ï¼š**
   - chineseName: ä¸­æ–‡åå­—
   - department: éƒ¨é–€åç¨±
   - includeMerchant: æ˜¯å¦åŒ…å« merchant è§’è‰²
   - projectInfo: å°ˆæ¡ˆé…ç½®è³‡è¨Š

3. **`createManager`** - å‰µå»ºç®¡ç†å“¡
   - åƒ… super_admin å¯åŸ·è¡Œ
   - é©—è­‰æ¬Šé™ï¼ˆé›™é‡æª¢æŸ¥ï¼šauthUid å’Œ docIdï¼‰
   - é©—è­‰å¯†ç¢¼å¼·åº¦ï¼ˆè‡³å°‘ 8 å­—ç¬¦ï¼Œè‹±æ–‡+æ•¸å­—ï¼‰
   - æª¢æŸ¥æ‰‹æ©Ÿè™Ÿæ˜¯å¦å·²å­˜åœ¨
   - é©—è­‰åˆ†é…é¡åº¦æ˜¯å¦è¶…éå¯ç”¨é¡åº¦
   - è‡ªå‹•ç”Ÿæˆ Manager IDï¼ˆM001, M002...ï¼‰
   - å‰µå»º Firebase Auth å¸³è™Ÿ
   - å‰µå»º Firestore ç”¨æˆ¶æ–‡æª”
   - æ›´æ–°ç³»çµ±çµ±è¨ˆè³‡æ–™
   - è¨˜éŒ„è³‡æœ¬åˆ†é…ä¾†æº
   
   **å¿…å¡«æ¬„ä½ï¼š**
   - phoneNumber: æ‰‹æ©Ÿè™Ÿç¢¼
   - password: åˆå§‹å¯†ç¢¼
   - englishName: è‹±æ–‡åå­—
   - identityTag: èº«ä»½æ¨™ç±¤ï¼ˆstaff/teacherï¼‰
   - assignedCapital: åˆ†é…è³‡æœ¬é¡åº¦
   
   **å¯é¸æ¬„ä½ï¼š**
   - chineseName: ä¸­æ–‡åå­—

4. **`sendOtpToPhone`** - ç™¼é€ OTPï¼ˆç®¡ç†å“¡ç‰ˆæœ¬ï¼‰
   - é©—è­‰ç”¨æˆ¶ PIN ç¢¼
   - ç”Ÿæˆ 6 ä½æ•¸ OTP
   - å‰µå»º OTP session
   - å­˜å„²åˆ° otp_collection
   - 5 åˆ†é˜éæœŸæ™‚é–“

5. **`verifyOtpCode`** - é©—è­‰ OTP
   - æª¢æŸ¥ OTP session æ˜¯å¦å­˜åœ¨
   - é©—è­‰æ˜¯å¦éæœŸ
   - é©—è­‰ OTP æ­£ç¢ºæ€§
   - è¨˜éŒ„å¤±æ•—æ¬¡æ•¸
   - ç”Ÿæˆ Custom Token
   - åˆªé™¤å·²ä½¿ç”¨çš„ OTP session

6. **`setProjectInfo`** - è¨­ç½®å°ˆæ¡ˆé…ç½®
   - ä¿å­˜å°ˆæ¡ˆè³‡è¨Šåˆ° system_config
   - åŒ…å«æ´»å‹•åç¨±ã€æ—¥æœŸã€åœ°é»ç­‰

7. **`getTotalCapital`** - ç²å–ç¸½è³‡æœ¬è³‡è¨Š
   - æŸ¥è©¢å°ˆæ¡ˆç¸½è³‡æœ¬
   - è¿”å›å·²åˆ†é…å’Œå¯ç”¨è³‡æœ¬
   - ç”¨æ–¼è³‡æœ¬åˆ†é…ç®¡ç†

8. **`getAssignedCapitalSum`** - ç²å–å·²åˆ†é…è³‡æœ¬ç¸½å’Œ
   - çµ±è¨ˆæ‰€æœ‰ Manager çš„å·²åˆ†é…è³‡æœ¬
   - ç”¨æ–¼é©—è­‰åˆ†é…é¡åº¦

**å®‰å…¨æ©Ÿåˆ¶ï¼š**
- ä½¿ç”¨ SHA-256 é€²è¡Œå¯†ç¢¼åŠ å¯†
- éš¨æ©Ÿç”Ÿæˆ salt å€¼
- OTP é›™é‡é©—è­‰
- æ¬Šé™é©—è­‰ï¼ˆsuper_admin å°ˆå±¬åŠŸèƒ½ï¼‰
- è³‡æœ¬é¡åº¦é©—è­‰
- æ‰‹æ©Ÿè™Ÿå”¯ä¸€æ€§æª¢æŸ¥
- å¯†ç¢¼å¼·åº¦é©—è­‰

---

### ğŸ” Cloud Functions èª¿ç”¨æ–¹å¼

å‰ç«¯é€šé Firebase SDK èª¿ç”¨ Cloud Functionsï¼š

```javascript
import { getFunctions, httpsCallable } from 'firebase/functions';

const functions = getFunctions();

// èª¿ç”¨ç™»å…¥å‡½æ•¸
const loginWithPin = httpsCallable(functions, 'loginWithPin');
const result = await loginWithPin({ 
  phoneNumber: '0123456789', 
  pin: 'password123' 
});

// èª¿ç”¨å‰µå»º Manager å‡½æ•¸
const createManager = httpsCallable(functions, 'createManager');
const result = await createManager({
  phoneNumber: '0123456788',
  password: 'Manager123',
  englishName: 'John Doe',
  chineseName: 'å¼µä¸‰',
  identityTag: 'staff',
  assignedCapital: 100000
});
```

---

### ğŸ”§ å…±ç”¨å·¥å…·å‡½æ•¸

**å¯†ç¢¼å“ˆå¸Œå‡½æ•¸ï¼š**
```javascript
function sha256(str) {
  return crypto.createHash("sha256").update(str).digest("hex");
}
```

**Auth UID ç”Ÿæˆè¦å‰‡ï¼š**
```javascript
// é¦¬ä¾†è¥¿äºåœ‹ç¢¼ 60ï¼Œå»é™¤æ‰‹æ©Ÿè™Ÿå‰å° 0
const authUid = `phone_60${phoneNumber.replace(/^0/, "")}`;
// ä¾‹å¦‚ï¼š0123456789 â†’ phone_60123456789
```

---

### ğŸ”§ åŸæœ‰çš„å…±ç”¨æ¨¡çµ„ï¼ˆçºŒï¼‰

#### 19. **èªè­‰ UI æ¨¡æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/common/auth-ui-template.html`
  - å‹•æ…‹åˆ‡æ›èªè¨€
  - ç¿»è­¯éµå€¼å°ç®¡ç†
  - é é¢å…ƒç´ è‡ªå‹•æ›´æ–°

#### 16. **èªè­‰ UI æ¨¡æ¿**
- **è·¯å¾‘ï¼š** `public-vite/src/common/auth-ui-template.html`
- **åŠŸèƒ½èªªæ˜ï¼š**
  - é€šç”¨çš„èªè­‰é é¢ UI æ¨£å¼
  - ç™»å…¥/è¨»å†Šé é¢å…±ç”¨æ¨¡æ¿

---

## æ•¸æ“šçµæ§‹èªªæ˜

### Firestore Collections

#### 1. **users** Collection
å„²å­˜æ‰€æœ‰ç”¨æˆ¶è³‡æ–™ï¼ŒåŒ…å«å¤šè§’è‰²æ”¯æ´

**ä¸»è¦æ¬„ä½ï¼š**
```javascript
{
  userId: string,
  authUid: string,
  roles: array, // ['customer', 'seller', 'merchant', 'manager', 'super_admin']
  identityTag: string, // 'student', 'teacher', 'staff', null
  basicInfo: {
    phoneNumber: string,
    englishName: string,
    chineseName: string,
    email: string,
    pinHash: string,
    passwordHash: string,
    isPhoneVerified: boolean
  },
  identityInfo: {
    // ä¾æ“š identityTag ä¸åŒè€Œæœ‰ä¸åŒæ¬„ä½
    studentId: string,
    className: string,
    teacherId: string,
    department: string,
    staffId: string,
    position: string
  },
  roleSpecificData: {
    customer: {
      currentBalance: number, // ç•¶å‰é»æ•¸é¤˜é¡
      totalPointsPurchased: number,
      totalPointsConsumed: number
    },
    seller: {
      totalPointsSold: number,
      currentSalesAmount: number,
      capitalSource: {
        assignedBy: string,
        assignedAt: timestamp,
        allocationId: string
      }
    },
    merchant: {
      totalReceivedPoints: number,
      monthlyReceivedPoints: number
    },
    manager: {
      managerId: string,
      assignedCapital: number,
      allocatedToSellers: number,
      availableCapital: number,
      totalSellersManaged: number
    },
    super_admin: {
      superAdminId: string,
      totalCapitalManaged: number,
      allocatedCapital: number,
      availableCapital: number
    }
  },
  accountStatus: {
    status: string, // 'active', 'suspended', 'inactive'
    createdAt: timestamp,
    updatedAt: timestamp
  }
}
```

#### 2. **transactions** Collection
å„²å­˜æ‰€æœ‰äº¤æ˜“è¨˜éŒ„

**ä¸»è¦æ¬„ä½ï¼š**
```javascript
{
  transactionId: string,
  transactionType: string, // 'sale', 'consumption', 'allocation'
  sellerId: string,
  sellerName: string,
  customerId: string,
  customerName: string,
  merchantId: string,
  merchantName: string,
  points: number,
  amount: number,
  status: string, // 'completed', 'pending', 'failed'
  timestamp: timestamp,
  createdAt: timestamp
}
```

#### 3. **system_config** Collection
å„²å­˜ç³»çµ±é…ç½®è³‡è¨Š

**ä¸»è¦æ¬„ä½ï¼š**
- `global_settings`: å…¨åŸŸè¨­å®š
- `project_info`: å°ˆæ¡ˆè³‡è¨Š
- æ”¯æ´èªè¨€ã€æ™‚å€ã€è²¨å¹£ç­‰é…ç½®

#### 4. **role_definitions** Collection
è§’è‰²å®šç¾©å’Œæ¬Šé™ç®¡ç†

#### 5. **identity_tag_definitions** Collection
èº«ä»½æ¨™ç±¤å®šç¾©

#### 6. **capital_allocations** Collection
è³‡æœ¬åˆ†é…è¨˜éŒ„

#### 7. **admin_uids** Collection
ç®¡ç†å“¡ UID ç™½åå–®

---

## é‡è¦åŠŸèƒ½æµç¨‹

### 1. ç”¨æˆ¶ç™»å…¥æµç¨‹
1. ç”¨æˆ¶åœ¨ç™»å…¥é é¢è¼¸å…¥æ‰‹æ©Ÿè™Ÿå’Œå¯†ç¢¼
2. ç³»çµ±é©—è­‰ Firebase Authentication
3. æ ¹æ“š authUid æŸ¥è©¢ Firestore users collection
4. è®€å–ç”¨æˆ¶è§’è‰²ï¼ˆroles é™£åˆ—ï¼‰
5. è·³è½‰åˆ°å°èˆªä¸­å¿ƒæˆ–å°æ‡‰è§’è‰²çš„æ§åˆ¶é¢æ¿

### 2. éŠ·å”®å“¡éŠ·å”®æµç¨‹
1. éŠ·å”®å“¡åœ¨æ§åˆ¶é¢æ¿é¸æ“‡ã€Œæ–°éŠ·å”®ã€
2. è¼¸å…¥é¡§å®¢æ‰‹æ©Ÿè™Ÿã€éŠ·å”®é»æ•¸
3. ç³»çµ±æª¢æŸ¥éŠ·å”®å“¡å¯ç”¨é»æ•¸ï¼ˆå¾ customer.currentBalance è®€å–ï¼‰
4. æŸ¥è©¢é¡§å®¢è³‡æ–™
5. ä½¿ç”¨ Firestore Transaction åŸ·è¡Œï¼š
   - æ‰£æ¸›éŠ·å”®å“¡çš„ `customer.currentBalance`
   - å¢åŠ éŠ·å”®å“¡çš„ `seller.totalPointsSold`
   - å¢åŠ é¡§å®¢çš„ `customer.currentBalance`
   - å‰µå»ºäº¤æ˜“è¨˜éŒ„
6. æ›´æ–°ç•Œé¢é¡¯ç¤º

### 3. æ¶ˆè²»è€…ä»˜æ¬¾æµç¨‹
1. æ¶ˆè²»è€…æƒæå•†å®¶ QR Code
2. è·³è½‰åˆ°æ”¯ä»˜é é¢ï¼Œé¡¯ç¤ºå•†å®¶è³‡è¨Š
3. è¼¸å…¥æ¶ˆè²»é»æ•¸
4. è¼¸å…¥ PIN ç¢¼é©—è­‰
5. ä½¿ç”¨ Firestore Transaction åŸ·è¡Œï¼š
   - æ‰£æ¸›æ¶ˆè²»è€…çš„ `customer.currentBalance`
   - å¢åŠ å•†å®¶çš„ `merchant.totalReceivedPoints`
   - å‰µå»ºäº¤æ˜“è¨˜éŒ„
6. é¡¯ç¤ºäº¤æ˜“æˆåŠŸè¨Šæ¯

### 4. Manager æ‰¹é‡å°å…¥éŠ·å”®å“¡
1. Manager åœ¨ç”¨æˆ¶ç®¡ç†é é¢é¸æ“‡ã€Œæ‰¹é‡å°å…¥éŠ·å”®å“¡ã€
2. ä¸Šå‚³ CSV æª”æ¡ˆ
3. ç³»çµ±è§£æä¸¦é©—è­‰æ•¸æ“š
4. é¡¯ç¤ºé è¦½å’Œé©—è­‰çµæœ
5. ç¢ºèªå¾Œæ‰¹é‡å‰µå»ºï¼š
   - Firebase Authentication å¸³è™Ÿ
   - Firestore user æ–‡æª”
   - è¨­ç½®åˆå§‹å¯†ç¢¼å’Œè§’è‰²
6. é¡¯ç¤ºå°å…¥çµæœ

---

## åœ‹éš›åŒ–æ”¯æ´

ç³»çµ±æ”¯æ´ä¸­è‹±æ–‡é›™èªç•Œé¢ï¼š

### æ”¯æ´èªè¨€
- **zh-CN**: ç°¡é«”ä¸­æ–‡
- **en-US**: è‹±æ–‡

### åˆ‡æ›æ–¹å¼
- æ¯å€‹é é¢éƒ½æœ‰èªè¨€åˆ‡æ›æŒ‰éˆ•
- èªè¨€åå¥½å„²å­˜åœ¨ localStorage
- é é¢è¼‰å…¥æ™‚è‡ªå‹•æ‡‰ç”¨ç”¨æˆ¶åå¥½èªè¨€

### ç¿»è­¯å…§å®¹
- ç•Œé¢æ–‡å­—
- æŒ‰éˆ•æ¨™ç±¤
- æç¤ºè¨Šæ¯
- éŒ¯èª¤è¨Šæ¯
- è¡¨å–®æ¨™ç±¤

---

## æ¬Šé™æ§åˆ¶

### è§’è‰²æ¬Šé™çŸ©é™£

| åŠŸèƒ½ | Customer | Seller | Merchant | Manager | Super Admin |
|------|----------|--------|----------|---------|-------------|
| è³¼è²·é»æ•¸ | âœ… | âœ… | âœ… | âœ… | âœ… |
| éŠ·å”®é»æ•¸ | âŒ | âœ… | âŒ | âœ… | âœ… |
| æ¥å—æ¶ˆè²» | âŒ | âŒ | âœ… | âŒ | âŒ |
| å‰µå»ºéŠ·å”®å“¡ | âŒ | âŒ | âŒ | âœ… | âœ… |
| å‰µå»ºå•†å®¶ | âŒ | âŒ | âŒ | âœ… | âœ… |
| ç”¨æˆ¶ç®¡ç† | âŒ | âŒ | âŒ | âœ… | âœ… |
| å‰µå»º Manager | âŒ | âŒ | âŒ | âŒ | âœ… |
| ç³»çµ±é…ç½® | âŒ | âŒ | âŒ | âŒ | âœ… |
| è³‡æœ¬åˆ†é… | âŒ | âŒ | âŒ | âœ… | âœ… |

### è§’è‰²äº’æ–¥è¦å‰‡
- `super_admin` èˆ‡ `manager` äº’æ–¥
- å…¶ä»–è§’è‰²å¯ä»¥çµ„åˆï¼ˆä¾‹å¦‚ï¼šseller + customer + merchantï¼‰

---

## éƒ¨ç½²èˆ‡é…ç½®

### ç’°å¢ƒè¦æ±‚
- Node.js 14+
- Firebase å°ˆæ¡ˆ
- Vite æ§‹å»ºå·¥å…·

### Firebase é…ç½®
åœ¨ `public-vite/src/shared/firebase.js` ä¸­é…ç½® Firebaseï¼š

```javascript
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
```

### æœ¬åœ°é–‹ç™¼
```bash
# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬
npm run build
```

### è¨ªå•è·¯å¾‘
- é–‹ç™¼ç’°å¢ƒï¼š`http://localhost:5173`
- ç³»çµ±é¦–é ï¼š`http://localhost:5173/home/index.html`
- å°èˆªä¸­å¿ƒï¼š`http://localhost:5173/home/navigation-center.html`

---

## å®‰å…¨æ€§è€ƒæ…®

1. **å¯†ç¢¼åŠ å¯†**ï¼šä½¿ç”¨ SHA-256 é€²è¡Œå¯†ç¢¼å“ˆå¸Œ
2. **PIN ç¢¼ä¿è­·**ï¼šäº¤æ˜“æ™‚éœ€è¦ PIN ç¢¼é©—è­‰
3. **OTP é©—è­‰**ï¼šæ”¯æ´æ‰‹æ©Ÿè™Ÿ OTP é©—è­‰ï¼ˆå¯é¸ï¼‰
4. **Firebase Rules**ï¼šé…ç½® Firestore å®‰å…¨è¦å‰‡
5. **è§’è‰²é©—è­‰**ï¼šå‰å¾Œç«¯é›™é‡è§’è‰²æ¬Šé™æª¢æŸ¥
6. **äº¤æ˜“åŸå­æ€§**ï¼šä½¿ç”¨ Firestore Transaction ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§

---

## å·²çŸ¥å•é¡Œèˆ‡æ³¨æ„äº‹é …

1. **é»æ•¸å„²å­˜ä½ç½®**ï¼š
   - éŠ·å”®å“¡çš„å¯ç”¨é»æ•¸å­˜å„²åœ¨ `roleSpecificData.customer.currentBalance`
   - ä¸æ˜¯ `roleSpecificData.seller.availablePoints`ï¼ˆæ­¤æ¬„ä½å·²å»¢æ£„ï¼‰

2. **ç™»å‡ºè·³è½‰**ï¼š
   - Seller Dashboard ç™»å‡ºå¾Œè·³è½‰åˆ° `http://localhost:5173/home/index.html`
   - Manager é é¢ç™»å‡ºå¾Œè·³è½‰åˆ° `http://localhost:5173/home/index.html`

3. **å¤šè§’è‰²æ”¯æ´**ï¼š
   - ç”¨æˆ¶å¯ä»¥åŒæ™‚æ“æœ‰å¤šå€‹è§’è‰²
   - å°èˆªä¸­å¿ƒæœƒé¡¯ç¤ºæ‰€æœ‰å¯ç”¨è§’è‰²çš„å…¥å£

4. **æ•¸æ“šåˆå§‹åŒ–**ï¼š
   - é¦–æ¬¡éƒ¨ç½²éœ€è¦ä½¿ç”¨ `init_data_20251003.json` åˆå§‹åŒ– Firestore
   - Super Admin é è¨­å¯†ç¢¼ï¼š`password`ï¼ˆç”Ÿç”¢ç’°å¢ƒè«‹ç«‹å³ä¿®æ”¹ï¼‰

---

## æœªä¾†è¦åŠƒ

- [ ] äº¤æ˜“å ±è¡¨ç”Ÿæˆ
- [ ] è³‡æœ¬åˆ†é…å¯©æ‰¹æµç¨‹
- [ ] éƒµä»¶é€šçŸ¥åŠŸèƒ½
- [ ] æ‰‹æ©Ÿ APP ç‰ˆæœ¬
- [ ] æ•¸æ“šåŒ¯å‡ºåŠŸèƒ½ï¼ˆExcel/CSVï¼‰
- [ ] å³æ™‚åº«å­˜è­¦å‘Š
- [ ] äº¤æ˜“çµ±è¨ˆåœ–è¡¨
- [ ] å¤šçµ„ç¹”æ”¯æ´

---

## è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯ç¹«é–‹ç™¼åœ˜éšŠã€‚

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025-10-10
**ç‰ˆæœ¬ï¼š** 4.2.0