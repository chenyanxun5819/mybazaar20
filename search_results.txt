
src\views\sellerManager\components\OverviewStats.jsx:4:import { useSellerManagerStats } from '../../../hooks/sellerManager';
src\views\sellerManager\components\OverviewStats.jsx:14:  const { smStats, loading, error } = useSellerManagerStats(


dist\assets\index-Be6Dd1cq.js:99:ÈÉ®ÈñÄ: ${l.identityInfo?.department||"Êú™Áü•"}`)){if(!k){alert("‚ùå ÈåØË™§ÔºöÁÑ°Ê≥ïÁç≤ÂèñÁï∂ÂâçÁî®Êà∂‰ø°ÊÅØ"),console.error("currentUserId is undefined, userInfo:",a);return}h(l.userId);try{const u=Tn(re),N=Ie(re,`organizations/${R}/events/${B}/cashCollections`),v=ke(N);u.set(v,{collectionId:v.id,sellerId:l.userId,sellerName:l.basicInfo?.chineseName||"Êú™Áü•",sellerDepartment:l.identityInfo?.department||"Êú™ÂàÜÈÖç",sellerIdentityTag:l.identityInfo?.identityTag||"student",sellerIdentityId:l.identityInfo?.identityId||"Êú™Áü•",collectedBy:k,collectedByName:a?.basicInfo?.chineseName||"Seller Manager",collectedByRole:"sellerManager",amount:p,status:"collected",collectedAt:et(),submittedAt:null,submittedToFinance:!1,submissionId:null,confirmedAt:null,confirmedBy:null,eventId:B,organizationId:R,createdAt:et(),updatedAt:et()});const P=ke(re,`organizations/${R}/events/${B}/users/${l.userId}`);u.update(P,{"pointsStats.cashFlow.totalCashCollected":pt(p),"pointsStats.cashFlow.pendingCollection":0,"pointsStats.cashFlow.lastCollectionAt":et(),updatedAt:et()});const _=ke(re,`organizations/${R}/events/${B}/users/${k}`);u.update(_,{"pointsStats.cashFlow.cashHolding":pt(p),"pointsStats.cashFlow.totalCollected":pt(p),"pointsStats.cashFlow.lastCollectionAt":et(),updatedAt:et()}),await u.commit(),console.log("‚úÖ Êî∂Ê¨æÊàêÂäü"),alert(`‚úÖ ÊàêÂäüÊî∂Âèñ RM ${p} Âæû ${l.basicInfo?.chineseName||"Êú™Áü•"}`),n&&n(l,p)}catch(u){console.error("‚ùå Êî∂Ê¨æÂ§±Êïó:",u),alert("Êî∂Ê¨æÂ§±ÊïóÔºåË´ãÈáçË©¶„ÄÇÈåØË™§: "+u.message)}finally{h(null)}}};return e.jsxs("div",{style:ce.container,children:[e.jsxs("div",{style:ce.toolbar,children:[e.jsx("div",{style:ce.searchBox,children:e.jsx("input",{type:"text",placeholder:"ÊêúÂ∞ãÂßìÂêç„ÄÅÂ≠∏ËôüÊàñÈÉ®ÈñÄ...",value:I,onChange:l=>j(l.target.value),style:ce.searchInput})}),e.jsxs("div",{style:ce.filters,children:[e.jsxs("select",{value:g,onChange:l=>i(l.target.value),style:ce.select,children:[e.jsx("option",{value:"all",children:"ÂÖ®ÈÉ®ÁãÄÊÖã"}),e.jsx("option",{value:"active",children:"Ê¥ªË∫ç‰∏≠"}),e.jsx("option",{value:"warning",children:"Êî∂Ê¨æË≠¶Á§∫"}),e.jsx("option",{value:"highRisk",children:"È´òÈ¢®Èö™"})]}),e.jsxs("select",{value:c,onChange:l=>d(l.target.value),style:ce.select,children:[e.jsx("option",{value:"name",children:"ÊåâÂßìÂêç"}),e.jsx("option",{value:"points",children:"ÊåâÁèæÊúâÈªûÊï∏"}),e.jsx("option",{value:"sold",children:"ÊåâÂ∑≤Èä∑ÂîÆ"}),e.jsx("option",{value:"pending",children:"ÊåâÂæÖÊî∂Ê¨æ"})]})]})]}),e.jsx("div",{style:ce.tableContainer,children:e.jsxs("table",{style:ce.table,children:[e.jsx("thead",{children:e.jsxs("tr",{style:ce.headerRow,children:[e.jsx("th",{style:ce.th,children:"#"}),e.jsx("th",{style:ce.th,children:"ÂßìÂêç"}),e.jsx("th",{style:ce.th,children:"Â≠∏Ëôü"}),e.jsx("th",{style:ce.th,children:"ÈÉ®ÈñÄ"}),e.jsx("th",{style:ce.th,children:"ÁèæÊúâÈªûÊï∏"}),e.jsx("th",{style:ce.th,children:"Â∑≤Èä∑ÂîÆ"}),e.jsx("th",{style:ce.th,children:"ÂæÖÊî∂Ê¨æ"}),e.jsx("th",{style:ce.th,children:"ÁãÄÊÖã"}),e.jsx("th",{style:ce.th,children:"Êìç‰Ωú"})]})}),e.jsx("tbody",{children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",style:ce.noData,children:"Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑ Sellers"})}):f.map((l,p)=>{const u=l.pointsStats?.cashFlow?.pendingCollection||0,N=m===l.userId,v=w===l.userId,P=l.collectionAlert?.hasWarning,_=l.collectionAlert?.riskLevel;return e.jsxs(ln.Fragment,{children:[e.jsxs("tr",{style:ce.row,children:[e.jsx("td",{style:ce.td,children:p+1}),e.jsx("td",{style:ce.td,children:l.basicInfo?.chineseName||l.basicInfo?.englishName||"Êú™Áü•"}),e.jsxs("td",{style:ce.td,children:[l.identityInfo?.identityId||"-","  "]}),e.jsx("td",{style:ce.td,children:l.identityInfo?.department||"-"}),e.jsx("td",{style:ce.td,children:l.seller?.availablePoints||0}),e.jsx("td",{style:ce.td,children:l.pointsStats?.totalSold||0}),e.jsx("td",{style:ce.td,children:e.jsxs("span",{style:{color:u>0?"#ef4444":"#6b7280",fontWeight:u>0?"bold":"normal"},children:["RM ",u.toLocaleString()]})}),e.jsx("td",{style:ce.td,children:P?e.jsx("span",{style:{...ce.badge,background:_==="high"?"#fee2e2":"#fef3c7",color:_==="high"?"#dc2626":"#d97706"},children:_==="high"?"‚ö†Ô∏è È´òÈ¢®Èö™":"‚ö° Ë≠¶Á§∫"}):e.jsx("span",{style:{...ce.badge,background:"#dcfce7",color:"#16a34a"},children:"‚úì Ê≠£Â∏∏"})}),e.jsx("td",{style:ce.td,children:e.jsxs("div",{style:ce.actionButtons,children:[u>0&&e.jsx("button",{onClick:()=>x(l),disabled:v,style:{...ce.actionBtn,background:"#10b981",opacity:v?.5:1},children:v?"ËôïÁêÜ‰∏≠...":"üí∞ Êî∂Ê¨æ"}),e.jsx("button",{onClick:()=>C(N?null:l.userId),style:{...ce.actionBtn,background:"#6b7280"},children:N?"Êî∂Ëµ∑":"Ë©≥ÊÉÖ"})]})})]}),N&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"10",style:ce.detailsCell,children:["  ",e.jsxs("div",{style:ce.detailsContainer,children:[e.jsx("h4",{style:ce.detailsTitle,children:"ËØ¶ÁªÜ‰ø°ÊÅØ"}),e.jsxs("div",{style:ce.detailsGrid,children:[e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"ÁîµËØù:"}),e.jsx("span",{children:l.basicInfo?.phoneNumber||"-"}),"  "]}),e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"Â≠¶Âè∑:"}),e.jsx("span",{children:l.identityInfo?.identityId||"-"}),"  "]}),e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"Á¥ØËÆ°ÂàÜÈÖç:"}),e.jsx("span",{children:l.pointsStats?.totalAllocated||0})]}),e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"ÈîÄÂîÆÈáëÈ¢ù:"}),e.jsxs("span",{children:["RM ",l.pointsStats?.currentSalesAmount||0]})]}),e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"Êâã‰∏äÁé∞Èáë:"}),e.jsxs("span",{style:{color:"#ef4444",fontWeight:"bold"},children:["RM ",l.seller?.pendingCollection||0]})]}),e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"Â∑≤‰∫§‰ªòSM:"}),e.jsxs("span",{style:{color:"#10b981",fontWeight:"bold"},children:["RM ",l.seller?.totalSubmitted||0]})]}),e.jsxs("div",{style:ce.detailItem,children:[e.jsx("span",{style:ce.detailLabel,children:"Á¥ØËÆ°Êî∂Ê¨æ:"}),e.jsxs("span",{children:["RM ",l.pointsStats?.cashFlow?.totalCashCollected||0]})]})]})]})]})})]},l.userId)})})]})}),e.jsxs("div",{style:ce.summary,children:[e.jsxs("div",{style:ce.summaryItem,children:[e.jsx("span",{style:ce.summaryLabel,children:"Á∏Ω‰∫∫Êï∏:"}),e.jsx("span",{style:ce.summaryValue,children:f.length})]}),e.jsxs("div",{style:ce.summaryItem,children:[e.jsx("span",{style:ce.summaryLabel,children:"Á∏ΩÂæÖÊî∂Ê¨æ:"}),e.jsxs("span",{style:{...ce.summaryValue,color:"#ef4444"},children:["RM ",f.reduce((l,p)=>l+(p.pointsStats?.cashFlow?.pendingCollection||0),0).toLocaleString()]})]})]})]})},ce={container:{padding:"1.5rem",background:"white",borderRadius:"8px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},toolbar:{display:"flex",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap"},searchBox:{flex:"1 1 300px"},searchInput:{width:"100%",padding:"0.5rem 1rem",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem"},filters:{display:"flex",gap:"0.5rem"},select:{padding:"0.5rem 1rem",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",background:"white"},tableContainer:{overflowX:"auto",marginBottom:"1rem"},table:{width:"100%",borderCollapse:"collapse"},headerRow:{background:"#f9fafb",borderBottom:"2px solid #e5e7eb"},th:{padding:"0.75rem 1rem",textAlign:"left",fontSize:"0.75rem",fontWeight:"600",color:"#374151",textTransform:"uppercase"},row:{borderBottom:"1px solid #e5e7eb",":hover":{background:"#f9fafb"}},td:{padding:"0.75rem 1rem",fontSize:"0.875rem",color:"#111827"},noData:{padding:"2rem",textAlign:"center",color:"#6b7280"},badge:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"500"},actionButtons:{display:"flex",gap:"0.5rem"},actionBtn:{padding:"0.375rem 0.75rem",border:"none",borderRadius:"6px",color:"white",fontSize:"0.75rem",fontWeight:"500",cursor:"pointer",whiteSpace:"nowrap"},detailsCell:{padding:"0",background:"#f9fafb"},detailsContainer:{padding:"1.5rem",borderTop:"1px solid #e5e7eb"},detailsTitle:{margin:"0 0 1rem 0",fontSize:"0.875rem",fontWeight:"600",color:"#374151"},detailsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},detailItem:{display:"flex",flexDirection:"column",gap:"0.25rem"},detailLabel:{fontSize:"0.75rem",color:"#6b7280"},summary:{display:"flex",gap:"2rem",padding:"1rem",background:"#f9fafb",borderRadius:"6px",marginTop:"1rem"},summaryItem:{display:"flex",alignItems:"center",gap:"0.5rem"},summaryLabel:{fontSize:"0.875rem",color:"#6b7280"},summaryValue:{fontSize:"1rem",fontWeight:"600",color:"#111827"}};function ar(t,o,s){const[n,a]=r.useState(null),[c,d]=r.useState(!0),[g,i]=r.useState(null);return r.useEffect(()=>{if(!t||!o||!s){console.warn("[useSellerManagerStats] Áº∫Â∞ëÂøÖÂ°´ÂèÇÊï∞",{organizationId:t,eventId:o,sellerManagerId:s}),d(!1);return}console.log("[useSellerManagerStats] ÂºÄÂßãÁõëÂê¨ÁªüËÆ°Êï∞ÊçÆ",{organizationId:t,eventId:o,sellerManagerId:s});const j=cn(),m=ke(j,`organizations/${t}/events/${o}/sellerManagerStats/${s}`),C=rt(m,w=>{if(w.exists()){const h=w.data();console.log("[useSellerManagerStats] ‚úÖ ÁªüËÆ°Êï∞ÊçÆÊõ¥Êñ∞",h),a(h),i(null)}else console.warn("[useSellerManagerStats] ‚ö†Ô∏è ÁªüËÆ°ÊñáÊ°£‰∏çÂ≠òÂú®"),a({sellerManagerId:s,managedUsersStats:{totalUsers:0,activeUsers:0,currentBalance:0,totalRevenue:0,totalCashCollected:0,pendingCollection:0,collectionRate:0},allocationStats:{totalAllocations:0,totalPointsAllocated:0,averagePerAllocation:0,lastAllocationAt:null},collectionManagement:{usersWithWarnings:0,highRiskUsers:0,totalCashHolding:0}});d(!1)},w=>{console.error("[useSellerManagerStats] ‚ùå ÁõëÂê¨ÈîôËØØ",w),i(w.message),d(!1)});return()=>{console.log("[useSellerManagerStats] ÂÅúÊ≠¢ÁõëÂê¨"),C()}},[t,o,s]),{smStats:n,loading:c,error:g,refresh:()=>{d(!0)}}}useSellerManagerStats,useManagedDepartments,useManagedUsers;const ir=({organizationId:t,eventId:o,sellerManagerId:s,departmentStats:n,eventData:a})=>{const{smStats:c,loading:d,error:g}=ar(t,o,s);if(d)return e.jsxs("div",{style:fe.emptyState,children:[e.jsx("div",{style:fe.emptyIcon,children:"‚è≥"}),e.jsx("p",{children:"ÁªüËÆ°Êï∞ÊçÆÂä†ËΩΩ‰∏≠..."})]});if(g)return e.jsxs("div",{style:fe.emptyState,children:[e.jsx("div",{style:fe.emptyIcon,children:"‚ùå"}),e.jsxs("p",{children:["Âä†ËΩΩÂ§±Ë¥•: ",g]})]});if(!c)return e.jsxs("div",{style:fe.emptyState,children:[e.jsx("div",{style:fe.emptyIcon,children:"üìä"}),e.jsx("p",{children:"ÁªüËÆ°Êï∞ÊçÆÂä†ËΩΩ‰∏≠..."})]});const i=c.managedUsersStats&&typeof c.managedUsersStats=="object"?c.managedUsersStats:{},I=c.allocationStats&&typeof c.allocationStats=="object"?c.allocationStats:{},j=c.collectionManagement&&typeof c.collectionManagement=="object"?c.collectionManagement:{},C=(()=>{const h={maxPerAllocation:100,warningThreshold:.3};try{if(!a||typeof a!="object"||!a.pointAllocationRules||typeof a.pointAllocationRules!="object"||!a.pointAllocationRules.sellerManager||typeof a.pointAllocationRules.sellerManager!="object")return h;const R=a.pointAllocationRules.sellerManager;return{maxPerAllocation:typeof R.maxPerAllocation=="number"?R.maxPerAllocation:100,warningThreshold:typeof R.warningThreshold=="number"?R.warningThreshold:.3}}catch{return h}})(),w=h=>{const R=typeof h=="number"?h:0;return R>=.8?"#10b981":R>=.5?"#f59e0b":"#ef4444"};return e.jsxs("div",{style:fe.container,children:[e.jsx("h2",{style:fe.sectionTitle,children:"üìä ÁÆ°ÁêÜÊ¶ÇËßà"}),e.jsxs("div",{style:fe.section,children:[e.jsx("h3",{style:fe.subsectionTitle,children:"ÊàëÁöÑÂàÜÈÖçÁªüËÆ°"}),e.jsxs("div",{style:fe.statsGrid,children:[e.jsx(vt,{icon:"üì¶",title:"Á¥ØËÆ°ÂàÜÈÖçÊ¨°Êï∞",value:String(I.totalAllocations||0),color:"#3b82f6"}),e.jsx(vt,{icon:"üí∞",title:"Á¥ØËÆ°ÂàÜÈÖçÁÇπÊï∞",value:`${(I.totalPointsAllocated||0).toLocaleString()}`,color:"#8b5cf6"}),e.jsx(vt,{icon:"üìä",title:"Âπ≥ÂùáÊØèÊ¨°ÂàÜÈÖç",value:`${Math.round(I.averagePerAllocation||0)}`,color:"#06b6d4"}),e.jsx(vt,{icon:"üéØ",title:"ÂàÜÈÖç‰∏äÈôê",value:`${C.maxPerAllocation.toLocaleString()}/Ê¨°`,color:"#84cc16",description:"ÊØèÊ¨°ÊØè‰∫∫ÊúÄÈ´ò"})]})]}),e.jsxs("div",{style:fe.section,children:[e.jsx("h3",{style:fe.subsectionTitle,children:"ÁÆ°ÁêÜÁöÑ Sellers ÁªüËÆ°"}),e.jsxs("div",{style:fe.statsGrid,children:[e.jsx(vt,{icon:"üë•",title:"ÊÄªÁî®Êà∑Êï∞",value:String(i.totalUsers||0),subtitle:`Ê¥ªË∑É: ${i.activeUsers||0}`,color:"#f59e0b"}),e.jsx(vt,{icon:"üí≥",title:"ÂΩìÂâçÊåÅÊúâÁÇπÊï∞",value:`${(i.currentBalance||0).toLocaleString()}`,color:"#10b981"}),e.jsx(vt,{icon:"üìà",title:"Á¥ØËÆ°ÈîÄÂîÆÈ¢ù",value:`${(i.totalRevenue||0).toLocaleString()}`,color:"#6366f1"}),e.jsx(vt,{icon:"‚úÖ",title:"Â∑≤Êî∂Ê¨æ",value:`${(i.totalCollected||0).toLocaleString()}`,color:"#14b8a6"})]})]}),e.jsxs("div",{style:fe.section,children:[e.jsx("h3",{style:fe.subsectionTitle,children:"üí∞ Êî∂Ê¨æÁõëÊéß"}),e.jsxs("div",{style:fe.collectionCard,children:[e.jsxs("div",{style:fe.collectionRow,children:[e.jsx("div",{style:fe.collectionLabel,children:"Êî∂Ê¨æÁéá"}),e.jsx("div",{style:fe.collectionValue,children:e.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:w(i.collectionRate||0)},children:[Math.round((i.collectionRate||0)*100),"%"]})})]}),e.jsx("div",{style:fe.progressBar,children:e.jsx("div",{style:{...fe.progressFill,width:`${Math.min(100,(i.collectionRate||0)*100)}%`,background:w(i.collectionRate||0)}})}),e.jsxs("div",{style:fe.collectionDetails,children:[e.jsxs("div",{style:fe.detailRow,children:[e.jsx("span",{children:"ÂæÖÊî∂Ê¨æÈáëÈ¢ù:"}),e.jsx("span",{style:fe.detailValue,children:(i.pendingCollection||0).toLocaleString()})]}),e.jsxs("div",{style:fe.detailRow,children:[e.jsx("span",{children:"ÊúâË≠¶Á§∫ÁöÑÁî®Êà∑:"}),e.jsxs("span",{style:{...fe.detailValue,color:(j.usersWithWarnings||0)>0?"#ef4444":"#10b981"},children:[j.usersWithWarnings||0," ‰∫∫"]})]}),e.jsxs("div",{style:fe.detailRow,children:[e.jsx("span",{children:"È´òÈ£éÈô©Áî®Êà∑:"}),e.jsxs("span",{style:{...fe.detailValue,color:(j.highRiskUsers||0)>0?"#dc2626":"#10b981"},children:[j.highRiskUsers||0," ‰∫∫"]})]}),e.jsxs("div",{style:fe.detailRow,children:[e.jsx("span",{children:"Ë≠¶Á§∫ÈòàÂÄº:"}),e.jsxs("span",{style:fe.detailValue,children:[Math.round(C.warningThreshold*100),"%"]})]})]}),(j.usersWithWarnings||0)>0&&e.jsxs("div",{style:fe.warningBox,children:["‚ö†Ô∏è Êúâ ",j.usersWithWarnings," ‰ΩçÁî®Êà∑ÈúÄË¶ÅÂÖ≥Ê≥®Êî∂Ê¨æÊÉÖÂÜµ"]})]})]}),Array.isArray(n)&&n.length>0&&e.jsxs("div",{style:fe.section,children:[e.jsxs("h3",{style:fe.subsectionTitle,children:["üè´ ÁÆ°ÁêÜÁöÑÈÉ®Èó® (",n.length,")"]}),e.jsx("div",{style:fe.departmentGrid,children:n.map((h,R)=>e.jsx(lr,{dept:h},h.id||h.departmentCode||`dept-${R}`))})]})]})},vt=({icon:t,title:o,value:s,subtitle:n,color:a,description:c})=>{const d=String(t||"üìä"),g=String(o||""),i=String(s||"0"),I=String(a||"#000000");return e.jsxs("div",{style:{...fe.statCard,borderLeftColor:I},children:[e.jsx("div",{style:fe.statIcon,children:d}),e.jsxs("div",{style:fe.statContent,children:[e.jsx("div",{style:fe.statValue,children:i}),e.jsx("div",{style:fe.statTitle,children:g}),n&&e.jsx("div",{style:fe.statSubtitle,children:String(n)}),c&&e.jsx("div",{style:fe.statDescription,children:String(c)})]})]})},lr=({dept:t})=>{if(!t||typeof t!="object")return null;const o=t.pointsStats&&typeof t.pointsStats=="object"?t.pointsStats:{},s=t.membersStats&&typeof t.membersStats=="object"?t.membersStats:{},n=typeof o.collectionRate=="number"?o.collectionRate:0,a=c=>c>=.8?"#10b981":c>=.5?"#f59e0b":"#ef4444";return e.jsxs("div",{style:fe.deptMiniCard,children:[e.jsxs("div",{style:fe.deptHeader,children:[e.jsx("div",{style:fe.deptCode,children:t.departmentCode||"Êú™Áü•"}),e.jsx("div",{style:fe.deptName,children:t.departmentName||"Êú™ÂëΩÂêçÈÉ®Èó®"})]}),e.jsxs("div",{style:fe.deptStats,children:[e.jsxs("div",{style:fe.deptStatRow,children:[e.jsx("span",{children:"ÊàêÂëò:"}),e.jsx("strong",{children:s.totalCount||0})]}),e.jsxs("div",{style:fe.deptStatRow,children:[e.jsx("span",{children:"ÈîÄÂîÆÈ¢ù:"}),e.jsx("strong",{children:(o.totalRevenue||0).toLocaleString()})]}),e.jsxs("div",{style:fe.deptStatRow,children:[e.jsx("span",{children:"Êî∂Ê¨æÁéá:"}),e.jsxs("strong",{style:{color:a(n)},children:[Math.round(n*100),"%"]})]})]})]})},fe={container:{padding:"0"},sectionTitle:{fontSize:"1.5rem",fontWeight:"bold",color:"#1f2937",marginBottom:"1.5rem"},section:{marginBottom:"2rem"},subsectionTitle:{fontSize:"1.125rem",fontWeight:"600",color:"#374151",marginBottom:"1rem"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},statCard:{background:"#fafafa",padding:"1.25rem",borderRadius:"12px",borderLeft:"4px solid",display:"flex",alignItems:"flex-start",gap:"1rem"},statIcon:{fontSize:"2rem"},statContent:{flex:1},statValue:{fontSize:"1.5rem",fontWeight:"bold",color:"#1f2937",marginBottom:"0.25rem"},statTitle:{fontSize:"0.875rem",color:"#6b7280",fontWeight:"500"},statSubtitle:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},statDescription:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},collectionCard:{background:"#fafafa",padding:"1.5rem",borderRadius:"12px",border:"2px solid #e5e7eb"},collectionRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},collectionLabel:{fontSize:"1rem",fontWeight:"600",color:"#374151"},collectionValue:{textAlign:"right"},progressBar:{height:"12px",background:"#e5e7eb",borderRadius:"6px",overflow:"hidden",marginBottom:"1.5rem"},progressFill:{height:"100%",borderRadius:"6px"},collectionDetails:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1rem"},detailRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem",color:"#6b7280"},detailValue:{fontWeight:"600",color:"#1f2937"},warningBox:{background:"#fef3c7",border:"2px solid #fbbf24",color:"#92400e",padding:"0.75rem",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"500",textAlign:"center"},departmentGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"1rem"},deptMiniCard:{background:"#fafafa",border:"2px solid #e5e7eb",borderRadius:"12px",padding:"1rem"},deptHeader:{marginBottom:"0.75rem",paddingBottom:"0.75rem",borderBottom:"1px solid #e5e7eb"},deptCode:{fontSize:"1.25rem",fontWeight:"bold",color:"#f59e0b",marginBottom:"0.25rem"},deptName:{fontSize:"0.875rem",color:"#6b7280"},deptStats:{display:"flex",flexDirection:"column",gap:"0.5rem"},deptStatRow:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem",color:"#6b7280"},emptyState:{textAlign:"center",padding:"3rem",color:"#6b7280"},emptyIcon:{fontSize:"4rem",marginBottom:"1rem"}},cr=({userInfo:t,eventData:o})=>{const[s,n]=r.useState([]),[a,c]=r.useState([]),[d,g]=r.useState(!0),[i,I]=r.useState([]),[j,m]=r.useState(!1),[C,w]=r.useState("collected"),[h,R]=r.useState(!1),[B,k]=r.useState(""),D=t.organizationId,T=t.eventId,y=t.userId;r.useEffect(()=>{if(!D||!T||!y)return;const z=De(Ie(re,`organizations/${D}/events/${T}/cashCollections`),be("collectedBy","==",y),tt("collectedAt","desc")),M=rt(z,E=>{const X=[];E.forEach(te=>{X.push({id:te.id,...te.data()})}),n(X),g(!1)},E=>{console.error("Âä†ËΩΩÊî∂Ê¨æËÆ∞ÂΩïÂ§±Ë¥•:",E),g(!1)});return()=>M()},[D,T,y]),r.useEffect(()=>{if(!D||!T||!y)return;const z=De(Ie(re,`organizations/${D}/events/${T}/cashSubmissions`),be("submittedBy","==",y),be("submitterRole","==","sellerManager"),tt("submittedAt","desc")),M=rt(z,E=>{const X=[];E.forEach(te=>{X.push({id:te.id,...te.data()})}),c(X)},E=>{console.error("Âä†ËΩΩ‰∏ä‰∫§ËÆ∞ÂΩïÂ§±Ë¥•:",E)});return()=>M()},[D,T,y]);const b=r.useMemo(()=>s.filter(z=>C==="collected"?z.status==="collected"&&!z.submittedToFinance:C==="submitted"?z.submittedToFinance===!0:!0),[s,C]),f=r.useMemo(()=>i.reduce((z,M)=>{const E=s.find(X=>X.id===M);return z+(E?.amount||0)},0),[i,s]),x=r.useMemo(()=>{const z=s.filter(W=>W.status==="collected"&&!W.submittedToFinance),M=z.reduce((W,U)=>W+(U.amount||0),0),E=a.filter(W=>W.status==="pending").length,X=a.filter(W=>W.status==="pending").reduce((W,U)=>W+(U.amount||0),0),te=a.filter(W=>W.status==="confirmed").reduce((W,U)=>W+(U.amount||0),0);return{cashHolding:M,availableCount:z.length,submittedCount:E,submittedAmount:X,confirmedAmount:te,totalSubmitted:a.reduce((W,U)=>W+(U.amount||0),0)}},[s,a]),l=r.useCallback(z=>{I(M=>M.includes(z)?M.filter(E=>E!==z):[...M,z])},[]),p=r.useCallback(()=>{const z=b.filter(M=>M.status==="collected"&&!M.submittedToFinance).map(M=>M.id);I(z)},[b]),u=r.useCallback(()=>{I([])},[]),N=r.useCallback(()=>{if(i.length===0){alert("ËØ∑ÂÖàÈÄâÊã©Ë¶Å‰∏ä‰∫§ÁöÑÊî∂Ê¨æËÆ∞ÂΩï");return}m(!0),k("")},[i]),v=r.useCallback(()=>{m(!1),k("")},[]),P=async()=>{if(i.length===0){alert("ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰∫§ÁöÑÊî∂Ê¨æËÆ∞ÂΩï");return}try{R(!0);const M=s.filter(q=>i.includes(q.id)).map(q=>({collectionId:q.id,sellerName:q.sellerName,sellerId:q.sellerId,amount:q.amount,salesDate:q.collectedAt?_(q.collectedAt):"Êú™Áü•",hasDiscrepancy:q.discrepancy!==0,discrepancy:q.discrepancy||0})),X=Tt().currentUser;if(!X)throw new Error("Áî®Êà∑Êú™ÁôªÂΩï");const te=await X.getIdToken(),U=await it(dt,"submitCashToFinance")({orgId:D,eventId:T,amount:f,note:B,includedCollections:i,includedSales:M});if(U.data.success)alert("‚úÖ ‰∏ä‰∫§ÊàêÂäüÔºÅÁé∞ÈáëÂ∑≤Êèê‰∫§Âà∞ÂæÖËÆ§È¢ÜÊ±†Â≠êÔºåÁ≠âÂæÖCashierÁ°ÆËÆ§„ÄÇ"),m(!1),I([]),k("");else throw new Error(U.data.message||"‰∏ä‰∫§Â§±Ë¥•")}catch(z){console.error("‰∏ä‰∫§Áé∞ÈáëÂ§±Ë¥•:",z),alert("‚ùå ‰∏ä‰∫§Â§±Ë¥•: "+z.message)}finally{R(!1)}},_=z=>z?(z.toDate?z.toDate():new Date(z)).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"Êú™Áü•",H=z=>z?(z.toDate?z.toDate():new Date(z)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Êú™Áü•",A=z=>({pending:{label:"‚è≥ ÂæÖÁ°ÆËÆ§",color:"#f59e0b"},confirmed:{label:"‚úÖ Â∑≤Á°ÆËÆ§",color:"#10b981"},disputed:{label:"‚ö†Ô∏è ÊúâÂºÇËÆÆ",color:"#ef4444"},rejected:{label:"‚ùå Â∑≤ÊãíÁªù",color:"#dc2626"}})[z]||{label:z,color:"#6b7280"};return d?e.jsxs("div",{style:se.loading,children:[e.jsx("div",{style:se.spinner}),e.jsx("p",{children:"Âä†ËΩΩÊï∞ÊçÆ‰∏≠..."})]}):e.jsxs("div",{style:se.container,children:[e.jsxs("div",{style:se.statsGrid,children:[e.jsx(qt,{icon:"üí∞",title:"ÂΩìÂâçÊåÅÊúâÁé∞Èáë",value:`RM ${x.cashHolding.toLocaleString()}`,color:"#10b981",description:`${x.availableCount} Á¨îÂèØ‰∏ä‰∫§`}),e.jsx(qt,{icon:"üì§",title:"ÂæÖËÆ§È¢ÜÊ±†Â≠ê",value:`RM ${x.submittedAmount.toLocaleString()}`,color:"#f59e0b",description:`${x.submittedCount} Á¨îÁ≠âÂæÖFMÁ°ÆËÆ§`}),e.jsx(qt,{icon:"‚úÖ",title:"Â∑≤Á°ÆËÆ§ÊÄªÈ¢ù",value:`RM ${x.confirmedAmount.toLocaleString()}`,color:"#3b82f6",description:"Finance Â∑≤Á°ÆËÆ§"}),e.jsx(qt,{icon:"üìä",title:"Á¥ØËÆ°‰∏ä‰∫§",value:`RM ${x.totalSubmitted.toLocaleString()}`,color:"#8b5cf6",description:"ÂéÜÂè≤ÊÄªÈ¢ù"})]}),e.jsxs("div",{style:se.infoBanner,children:[e.jsx("span",{style:se.infoIcon,children:"‚ÑπÔ∏è"}),e.jsxs("span",{style:se.infoText,children:[e.jsx("strong",{children:"ÂæÖËÆ§È¢ÜÊ±†Â≠êÊ®°ÂºèÔºö"}),"‰∏ä‰∫§ÁöÑÁé∞ÈáëÂ∞ÜËøõÂÖ•ÂæÖËÆ§È¢ÜÊ±†Â≠êÔºå‰ªª‰ΩïCashierÈÉΩÂèØ‰ª•Êé•ÂçïÁ°ÆËÆ§ÔºåÊó†ÈúÄÊåáÂÆöÁâπÂÆöÁöÑCashier„ÄÇ"]})]}),x.availableCount>0&&e.jsxs("div",{style:se.batchActions,children:[e.jsx("div",{style:se.selectionInfo,children:e.jsxs("span",{style:se.selectionText,children:["Â∑≤ÈÄâÊã© ",e.jsx("strong",{children:i.length})," Á¨îÔºå ÊÄªÈ¢ù ",e.jsxs("strong",{style:{color:"#10b981"},children:["RM ",f.toLocaleString()]})]})}),e.jsxs("div",{style:se.actionButtons,children:[e.jsx("button",{onClick:p,style:se.actionButton,children:"ÂÖ®ÈÄâÂèØ‰∏ä‰∫§"}),e.jsx("button",{onClick:u,style:se.actionButton,children:"ÂèñÊ∂àÈÄâÊã©"}),e.jsx("button",{onClick:N,style:{...se.submitBtn,opacity:i.length===0?.5:1,cursor:i.length===0?"not-allowed":"pointer"},disabled:i.length===0,children:"üì§ ‰∏ä‰∫§Âà∞ÂæÖËÆ§È¢ÜÊ±†Â≠ê"})]})]}),e.jsxs("div",{style:se.toolbar,children:[e.jsx("h3",{style:se.sectionTitle,children:"Êî∂Ê¨æËÆ∞ÂΩï"}),e.jsxs("select",{value:C,onChange:z=>w(z.target.value),style:se.select,children:[e.jsxs("option",{value:"collected",children:["ÂèØ‰∏ä‰∫§ (",s.filter(z=>z.status==="collected"&&!z.submittedToFinance).length,")"]}),e.jsxs("option",{value:"submitted",children:["Â∑≤‰∏ä‰∫§ (",s.filter(z=>z.submittedToFinance).length,")"]}),e.jsxs("option",{value:"all",children:["ÂÖ®ÈÉ® (",s.length,")"]})]})]}),b.length===0?e.jsxs("div",{style:se.emptyState,children:[e.jsx("div",{style:se.emptyIcon,children:"üì≠"}),e.jsx("h3",{children:"Ê≤°ÊúâÊî∂Ê¨æËÆ∞ÂΩï"}),e.jsx("p",{children:'ËØ∑ÂÖàÂà∞"Êî∂ÂèñÁé∞Èáë"È°µÈù¢Êî∂ÂèñÂ≠¶ÁîüÁé∞Èáë'})]}):e.jsx("div",{style:se.collectionsList,children:b.map(z=>e.jsx(dr,{collection:z,isSelected:i.includes(z.id),onToggle:()=>l(z.id),formatDate:_},z.id))}),a.length>0&&e.jsxs("div",{style:se.historySection,children:[e.jsx("h3",{style:se.sectionTitle,children:"üìú ‰∏ä‰∫§ÂéÜÂè≤"}),e.jsx("div",{style:se.submissionsList,children:a.map(z=>e.jsx(mr,{submission:z,formatFullDate:H,getStatusBadge:A},z.id))})]}),j&&e.jsx(ur,{selectedTotal:f,selectedCount:i.length,collections:s,selectedCollections:i,submitNote:B,setSubmitNote:k,submitting:h,onSubmit:P,onClose:v,formatDate:_})]})},qt=({icon:t,title:o,value:s,color:n,description:a})=>e.jsxs("div",{style:{...se.statCard,borderLeftColor:n},children:[e.jsx("div",{style:se.statIcon,children:t}),e.jsxs("div",{style:se.statContent,children:[e.jsx("div",{style:se.statValue,children:s}),e.jsx("div",{style:se.statTitle,children:o}),a&&e.jsx("div",{style:se.statDescription,children:a})]})]}),dr=({collection:t,isSelected:o,onToggle:s,formatDate:n})=>{const a=t.status==="collected"&&!t.submittedToFinance;return e.jsxs("div",{style:{...se.collectionCard,borderColor:o?"#10b981":"#e5e7eb",background:o?"#f0fdf4":"#fafafa"},children:[e.jsxs("div",{style:se.cardHeader,children:[a&&e.jsx("input",{type:"checkbox",checked:o,onChange:s,style:se.checkbox}),e.jsxs("div",{style:se.cardInfo,children:[e.jsxs("div",{style:se.cardTitle,children:[e.jsx("span",{className:"seller-icon",children:"üõçÔ∏è"}),e.jsx("span",{children:t.sellerName})]}),e.jsx("div",{style:se.cardMeta,children:e.jsx("span",{children:n(t.collectedAt)})})]}),e.jsxs("div",{style:se.cardAmount,children:["RM ",(t.amount||0).toLocaleString()]})]}),t.discrepancy!==0&&e.jsxs("div",{style:se.discrepancyBox,children:["‚ö†Ô∏è Â∑ÆÂºÇ: RM ",t.discrepancy," (",t.discrepancyType,")"]}),t.notes&&e.jsxs("div",{style:se.noteBox,children:["üìù ",t.notes]}),t.submittedToFinance&&e.jsx("div",{style:se.submittedBadge,children:"‚úÖ Â∑≤‰∏ä‰∫§Âà∞ÂæÖËÆ§È¢ÜÊ±†Â≠ê"})]})},mr=({submission:t,formatFullDate:o,getStatusBadge:s})=>{const[n,a]=r.useState(!1),c=s(t.status);return e.jsxs("div",{style:se.submissionCard,children:[e.jsxs("div",{style:se.submissionHeader,children:[e.jsxs("div",{children:[e.jsxs("div",{style:se.submissionTitle,children:["‰∏ä‰∫§ÁºñÂè∑: ",t.submissionNumber||t.id.slice(0,8)]}),e.jsxs("div",{style:se.submissionDate,children:["Êèê‰∫§Êó∂Èó¥: ",o(t.submittedAt)]})]}),e.jsx("div",{style:{...se.submissionStatus,background:c.color},children:c.label})]}),e.jsxs("div",{style:se.submissionStats,children:[e.jsxs("div",{style:se.submissionStat,children:[e.jsx("span",{children:"ÈáëÈ¢ù"}),e.jsxs("strong",{children:["RM ",(t.amount||0).toLocaleString()]})]}),e.jsxs("div",{style:se.submissionStat,children:[e.jsx("span",{children:"ÂåÖÂê´ËÆ∞ÂΩï"}),e.jsxs("strong",{children:[t.includedSales?.length||0," Á¨î"]})]})]}),t.note&&e.jsxs("div",{style:se.submissionNote,children:["üìù Êèê‰∫§Â§áÊ≥®: ",t.note]}),t.status==="confirmed"&&e.jsxs("div",{style:se.confirmedInfo,children:[e.jsxs("div",{style:se.detailRow,children:[e.jsx("span",{children:"Êé•Êî∂‰∫∫:"}),e.jsx("strong",{children:t.receiverName})]}),e.jsxs("div",{style:se.detailRow,children:[e.jsx("span",{children:"Á°ÆËÆ§Êó∂Èó¥:"}),e.jsx("strong",{children:o(t.confirmedAt)})]}),t.confirmationNote&&e.jsxs("div",{style:se.submissionNote,children:["‚úÖ Á°ÆËÆ§Â§áÊ≥®: ",t.confirmationNote]})]}),e.jsx("button",{style:se.expandButton,onClick:()=>a(!n),children:n?"‚ñ≤ Êî∂Ëµ∑ÊòéÁªÜ":"‚ñº Êü•ÁúãÊòéÁªÜ"}),n&&t.includedSales&&e.jsx("div",{style:se.detailsSection,children:t.includedSales.map((d,g)=>e.jsxs("div",{style:se.detailItem,children:[e.jsx("span",{children:d.sellerName}),e.jsxs("span",{children:["RM ",d.amount?.toLocaleString()]})]},g))})]})},ur=({selectedTotal:t,selectedCount:o,collections:s,selectedCollections:n,submitNote:a,setSubmitNote:c,submitting:d,onSubmit:g,onClose:i,formatDate:I})=>{const j=s.filter(m=>n.includes(m.id));return e.jsx("div",{style:se.modalOverlay,onClick:i,children:e.jsxs("div",{style:se.modal,onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{style:se.modalHeader,children:[e.jsx("h2",{style:{margin:0},children:"üì§ Á°ÆËÆ§‰∏ä‰∫§Áé∞Èáë"}),e.jsx("button",{style:se.closeButton,onClick:i,children:"‚úï"})]}),e.jsxs("div",{style:se.modalBody,children:[e.jsxs("div",{style:se.modalInfoBanner,children:[e.jsx("span",{children:"‚ÑπÔ∏è"}),e.jsxs("span",{children:["Áé∞ÈáëÂ∞ÜÊèê‰∫§Âà∞",e.jsx("strong",{children:"ÂæÖËÆ§È¢ÜÊ±†Â≠ê"}),"Ôºå‰ªª‰ΩïCashierÈÉΩÂèØ‰ª•Êé•ÂçïÁ°ÆËÆ§„ÄÇ"]})]}),e.jsxs("div",{style:se.summaryBox,children:[e.jsxs("div",{style:se.summaryRow,children:[e.jsx("span",{children:"ÈÄâ‰∏≠ËÆ∞ÂΩïÊï∞:"}),e.jsxs("strong",{style:{fontSize:"1.25rem"},children:[o," Á¨î"]})]}),e.jsxs("div",{style:se.summaryRow,children:[e.jsx("span",{children:"‰∏ä‰∫§ÊÄªÈ¢ù:"}),e.jsxs("strong",{style:{fontSize:"1.5rem",color:"#10b981"},children:["RM ",t.toLocaleString()]})]})]}),e.jsxs("div",{style:se.detailsList,children:[e.jsx("div",{style:se.detailsTitle,children:"ÂåÖÂê´ÁöÑÊî∂Ê¨æËÆ∞ÂΩï:"}),j.map(m=>e.jsxs("div",{style:se.detailListItem,children:[e.jsx("span",{children:m.sellerName}),e.jsxs("span",{children:["RM ",m.amount?.toLocaleString()]})]},m.id))]}),e.jsxs("div",{style:se.formGroup,children:[e.jsx("label",{style:se.label,children:"Â§áÊ≥®ÔºàÂèØÈÄâÔºâ"}),e.jsx("textarea",{value:a,onChange:m=>c(m.target.value),placeholder:"‰æãÂ¶ÇÔºöÁ¨¨‰∏ÄÊâπÂ≠¶ÁîüÁé∞Èáë‰∏ä‰∫§",style:se.textarea,rows:3,disabled:d})]})]}),e.jsxs("div",{style:se.modalFooter,children:[e.jsx("button",{style:se.cancelButton,onClick:i,disabled:d,children:"ÂèñÊ∂à"}),e.jsx("button",{style:se.submitButton,onClick:g,disabled:d,children:d?"Êèê‰∫§‰∏≠...":"‚úÖ Á°ÆËÆ§‰∏ä‰∫§"})]})]})})},se={container:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},loading:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",color:"#6b7280"},spinner:{width:"40px",height:"40px",border:"4px solid #f3f4f6",borderTop:"4px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",marginBottom:"1.5rem"},statCard:{background:"#fafafa",padding:"1.25rem",borderRadius:"12px",borderLeft:"4px solid",display:"flex",alignItems:"flex-start",gap:"1rem",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},statIcon:{fontSize:"2rem"},statContent:{flex:1},statValue:{fontSize:"1.5rem",fontWeight:"bold",color:"#1f2937",marginBottom:"0.25rem"},statTitle:{fontSize:"0.875rem",color:"#6b7280",fontWeight:"500"},statDescription:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},infoBanner:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",background:"linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%)",borderLeft:"4px solid #3b82f6",borderRadius:"8px",marginBottom:"1.5rem"},infoIcon:{fontSize:"20px"},infoText:{fontSize:"14px",color:"#1e40af",lineHeight:"1.5"},batchActions:{background:"white",padding:"1rem",borderRadius:"12px",border:"2px solid #e5e7eb",marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},selectionInfo:{flex:"1",minWidth:"200px"},selectionText:{fontSize:"0.875rem",color:"#374151"},actionButtons:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},actionButton:{padding:"0.5rem 1rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",color:"#374151",transition:"all 0.2s"},submitBtn:{padding:"0.5rem 1.5rem",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},toolbar:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",flexWrap:"wrap",gap:"1rem"},sectionTitle:{fontSize:"1.25rem",fontWeight:"bold",color:"#1f2937",margin:0},select:{padding:"0.5rem 1rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"0.875rem",cursor:"pointer",background:"white"},collectionsList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"1rem",marginBottom:"2rem"},collectionCard:{background:"#fafafa",border:"2px solid",borderRadius:"12px",padding:"1rem",transition:"all 0.2s"},cardHeader:{display:"flex",alignItems:"flex-start",gap:"0.75rem",marginBottom:"0.75rem"},checkbox:{width:"20px",height:"20px",cursor:"pointer",accentColor:"#10b981"},cardInfo:{flex:1},cardTitle:{fontSize:"1rem",fontWeight:"600",color:"#1f2937",marginBottom:"0.25rem",display:"flex",alignItems:"center",gap:"0.5rem"},cardMeta:{fontSize:"0.75rem",color:"#6b7280"},cardAmount:{fontSize:"1.25rem",fontWeight:"bold",color:"#10b981"},discrepancyBox:{marginTop:"0.75rem",padding:"0.75rem",background:"#fef3c7",borderRadius:"8px",fontSize:"0.75rem",color:"#92400e"},noteBox:{marginTop:"0.75rem",padding:"0.75rem",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.75rem",color:"#374151"},submittedBadge:{marginTop:"0.75rem",padding:"0.5rem",background:"#d1fae5",borderRadius:"6px",fontSize:"0.75rem",color:"#065f46",textAlign:"center",fontWeight:"600"},emptyState:{textAlign:"center",padding:"3rem",color:"#6b7280"},emptyIcon:{fontSize:"4rem",marginBottom:"1rem"},historySection:{marginTop:"3rem",paddingTop:"2rem",borderTop:"2px solid #e5e7eb"},submissionsList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(400px, 1fr))",gap:"1.5rem"},submissionCard:{background:"#fafafa",border:"2px solid #e5e7eb",borderRadius:"12px",padding:"1.5rem"},submissionHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem",gap:"1rem"},submissionTitle:{fontSize:"1rem",fontWeight:"bold",color:"#1f2937",marginBottom:"0.25rem"},submissionDate:{fontSize:"0.75rem",color:"#6b7280"},submissionStatus:{padding:"0.5rem 1rem",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"600",color:"white",whiteSpace:"nowrap"},submissionStats:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",padding:"1rem",background:"white",borderRadius:"8px",marginBottom:"1rem"},submissionStat:{display:"flex",flexDirection:"column",gap:"0.25rem",fontSize:"0.875rem",color:"#6b7280"},submissionNote:{padding:"0.75rem",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.75rem",color:"#374151",marginBottom:"1rem"},confirmedInfo:{padding:"1rem",background:"#f0fdf4",border:"2px solid #10b981",borderRadius:"8px",marginBottom:"1rem"},detailRow:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem",color:"#374151",marginBottom:"0.5rem"},expandButton:{width:"100%",padding:"0.75rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",color:"#374151"},detailsSection:{marginTop:"1rem",paddingTop:"1rem",borderTop:"2px solid #e5e7eb"},detailItem:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"white",borderRadius:"8px",marginBottom:"0.5rem",fontSize:"0.875rem"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},modal:{background:"white",borderRadius:"12px",maxWidth:"600px",width:"100%",maxHeight:"90vh",overflow:"auto"},modalHeader:{padding:"1.5rem",borderBottom:"2px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},closeButton:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#6b7280"},modalBody:{padding:"1.5rem"},modalInfoBanner:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",background:"#dbeafe",borderRadius:"8px",marginBottom:"1.5rem",fontSize:"0.875rem",color:"#1e40af"},summaryBox:{background:"#f0fdf4",border:"2px solid #10b981",borderRadius:"12px",padding:"1.5rem",marginBottom:"1.5rem"},summaryRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},detailsList:{marginBottom:"1.5rem"},detailsTitle:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem"},detailListItem:{display:"flex",justifyContent:"space-between",padding:"0.5rem",background:"#f3f4f6",borderRadius:"8px",marginBottom:"0.5rem",fontSize:"0.875rem"},formGroup:{marginBottom:"1.5rem"},label:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},textarea:{width:"100%",padding:"0.75rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"0.875rem",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box"},modalFooter:{padding:"1.5rem",borderTop:"2px solid #e5e7eb",display:"flex",gap:"1rem",justifyContent:"flex-end"},cancelButton:{padding:"0.75rem 1.5rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",color:"#374151"},submitButton:{padding:"0.75rem 1.5rem",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"}},hr=({userInfo:t,eventData:o})=>{const[s,n]=r.useState([]),[a,c]=r.useState(!0),[d,g]=r.useState(!1),[i,I]=r.useState(null),[j,m]=r.useState(""),[C,w]=r.useState(!1),[h,R]=r.useState(""),[B,k]=r.useState("dateDesc"),D=t?.organizationId?.replace("organization_","")||"",T=t?.eventId?.replace("event_","")||"",y=t?.userId;console.log("[CollectCash] ÂàùÂßãÂåñ:",{orgId:D,eventId:T,smId:y}),r.useEffect(()=>{if(!D||!T||!y){console.warn("[CollectCash] Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞"),c(!1);return}console.log("[CollectCash] ÂºÄÂßãÁõëÂê¨cashSubmissions..."),c(!0);try{const p=Ie(re,`organizations/${D}/events/${T}/cashSubmissions`),u=De(p,be("receivedBy","==",y),be("status","==","pending"),tt("submittedAt","desc")),N=rt(u,v=>{const P=[];v.forEach(_=>{P.push({id:_.id,..._.data()})}),console.log(`[CollectCash] Âä†ËΩΩ‰∫Ü ${P.length} Êù°ÂæÖÁ°ÆËÆ§ËÆ∞ÂΩï`),n(P),c(!1)},v=>{console.error("[CollectCash] ÁõëÂê¨Â§±Ë¥•:",v),v.code==="failed-precondition"&&(console.error("[CollectCash] ‚ö†Ô∏è ÈúÄË¶ÅÂàõÂª∫FirestoreÁ¥¢ÂºïÔºÅ"),console.error("ËØ∑ÁÇπÂáªConsole‰∏≠ÁöÑÈìæÊé•ÂàõÂª∫Á¥¢ÂºïÔºåÊàñÊâãÂä®Âú®Firebase ConsoleÂàõÂª∫Ôºö"),console.error("ÈõÜÂêà: cashSubmissions"),console.error("Â≠óÊÆµ: receivedBy (ÂçáÂ∫è), status (ÂçáÂ∫è), submittedAt (ÈôçÂ∫è)")),c(!1)});return()=>{console.log("[CollectCash] Ê∏ÖÁêÜÁõëÂê¨Âô®"),N()}}catch(p){console.error("[CollectCash] ËÆæÁΩÆÁõëÂê¨Â§±Ë¥•:",p),c(!1)}},[D,T,y]);const b={totalPending:s.reduce((p,u)=>p+(u.amount||0),0),count:s.length,cashOnHand:t?.sellerManager?.cashStats?.cashOnHand||0,confirmedFromSellers:t?.sellerManager?.cashStats?.confirmedFromSellers||0},f=()=>{let p=[...s];if(h){const u=h.toLowerCase();p=p.filter(N=>N.submitterName?.toLowerCase().includes(u)||N.submitterDepartment?.toLowerCase().includes(u)||N.submissionNumber?.toLowerCase().includes(u))}return p.sort((u,N)=>{switch(B){case"dateDesc":return(N.submittedAt?.toMillis?.()||0)-(u.submittedAt?.toMillis?.()||0);case"dateAsc":return(u.submittedAt?.toMillis?.()||0)-(N.submittedAt?.toMillis?.()||0);case"amountDesc":return(N.amount||0)-(u.amount||0);case"amountAsc":return(u.amount||0)-(N.amount||0);case"nameAsc":return(u.submitterName||"").localeCompare(N.submitterName||"");default:return 0}}),p},x=async()=>{if(i){console.log("[CollectCash] ÂºÄÂßãÁ°ÆËÆ§Êî∂Ê¨æ:",i.id),w(!0);try{const u=await it(dt,"confirmCashSubmission")({orgId:D,eventId:T,submissionId:i.id,note:j});console.log("[CollectCash] Á°ÆËÆ§ÊàêÂäü:",u.data),alert(`‚úÖ ${u.data.message}`),g(!1),I(null),m("")}catch(p){console.error("[CollectCash] Á°ÆËÆ§Â§±Ë¥•:",p),alert(`‚ùå Á°ÆËÆ§Â§±Ë¥•: ${p.message}`)}finally{w(!1)}}};if(a)return e.jsxs("div",{style:he.loading,children:[e.jsx("div",{style:he.spinner}),e.jsx("p",{children:"Âä†ËΩΩÊï∞ÊçÆ‰∏≠..."})]});const l=f();return e.jsxs("div",{style:he.container,children:[e.jsxs("div",{style:he.statsGrid,children:[e.jsx(Vt,{icon:"‚è≥",title:"ÂæÖÁ°ÆËÆ§Á¨îÊï∞",value:b.count,color:"#f59e0b",description:"Â≠¶ÁîüÂ∑≤‰∏ä‰∫§"}),e.jsx(Vt,{icon:"üí∞",title:"ÂæÖÁ°ÆËÆ§ÈáëÈ¢ù",value:`RM ${b.totalPending.toLocaleString()}`,color:"#ef4444",description:"ÈúÄË¶ÅÁ°ÆËÆ§Êî∂Ê¨æ"}),e.jsx(Vt,{icon:"‚úÖ",title:"Â∑≤Á°ÆËÆ§ÈáëÈ¢ù",value:`RM ${b.confirmedFromSellers.toLocaleString()}`,color:"#10b981",description:"Á¥ØËÆ°Â∑≤Á°ÆËÆ§"}),e.jsx(Vt,{icon:"üè¶",title:"ÊåÅÊúâÁé∞Èáë",value:`RM ${b.cashOnHand.toLocaleString()}`,color:"#3b82f6",description:"ÂèØ‰∏ä‰∫§ÁªôFinance"})]}),e.jsxs("div",{style:he.toolbar,children:[e.jsx("input",{type:"text",placeholder:"üîç ÊêúÁ¥¢Â≠¶ÁîüÂßìÂêç„ÄÅÁè≠Á∫ßÊàñÊµÅÊ∞¥Âè∑...",value:h,onChange:p=>R(p.target.value),style:he.searchInput}),e.jsxs("select",{value:B,onChange:p=>k(p.target.value),style:he.select,children:[e.jsx("option",{value:"dateDesc",children:"Êèê‰∫§Êó∂Èó¥: Êñ∞‚ÜíÊóß"}),e.jsx("option",{value:"dateAsc",children:"Êèê‰∫§Êó∂Èó¥: Êóß‚ÜíÊñ∞"}),e.jsx("option",{value:"amountDesc",children:"ÈáëÈ¢ù: È´ò‚Üí‰Ωé"}),e.jsx("option",{value:"amountAsc",children:"ÈáëÈ¢ù: ‰Ωé‚ÜíÈ´ò"}),e.jsx("option",{value:"nameAsc",children:"ÂßìÂêç: A‚ÜíZ"})]})]}),l.length===0?e.jsxs("div",{style:he.emptyState,children:[e.jsx("div",{style:he.emptyIcon,children:"üì≠"}),e.jsx("h3",{children:"Ê≤°ÊúâÂæÖÁ°ÆËÆ§ÁöÑÁé∞Èáë"}),h?e.jsx("p",{children:"Â∞ùËØïË∞ÉÊï¥ÊêúÁ¥¢Êù°‰ª∂"}):e.jsx("p",{children:"ÂΩìÂ≠¶Áîü‰∏ä‰∫§Áé∞ÈáëÂêéÔºå‰ºöÂú®ËøôÈáåÊòæÁ§∫"})]}):e.jsx("div",{style:he.submissionsList,children:l.map(p=>e.jsx(gr,{submission:p,onConfirm:()=>{I(p),g(!0)}},p.id))}),d&&i&&e.jsx(pr,{submission:i,note:j,onNoteChange:m,onConfirm:x,onCancel:()=>{g(!1),I(null),m("")},confirming:C})]})},Vt=({icon:t,title:o,value:s,color:n,description:a})=>e.jsxs("div",{style:{...he.statCard,borderLeftColor:n},children:[e.jsx("div",{style:he.statIcon,children:t}),e.jsxs("div",{style:he.statContent,children:[e.jsx("div",{style:he.statValue,children:s}),e.jsx("div",{style:he.statTitle,children:o}),a&&e.jsx("div",{style:he.statDescription,children:a})]})]}),gr=({submission:t,onConfirm:o})=>{const s=n=>{if(!n||!n.toDate)return"-";const a=n.toDate();return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)};return e.jsxs("div",{style:he.submissionCard,children:[e.jsxs("div",{style:he.submissionHeader,children:[e.jsxs("div",{style:he.submissionInfo,children:[e.jsx("div",{style:he.submitterName,children:t.submitterName||"Êú™Áü•"}),e.jsxs("div",{style:he.submissionMeta,children:[t.submitterDepartment||"-"," | ",t.submissionNumber||"-"]})]}),e.jsx("div",{style:he.submissionActions,children:e.jsxs("div",{style:he.submissionAmount,children:[e.jsx("div",{style:he.amountLabel,children:"ÈáëÈ¢ù"}),e.jsxs("div",{style:he.amountValue,children:["RM ",(t.amount||0).toLocaleString()]})]})})]}),e.jsxs("div",{style:he.submissionDetails,children:[e.jsxs("div",{style:he.detailRow,children:[e.jsx("span",{style:he.detailLabel,children:"Êèê‰∫§Êó∂Èó¥:"}),e.jsx("span",{children:s(t.submittedAt)})]}),t.note&&e.jsxs("div",{style:he.detailRow,children:[e.jsx("span",{style:he.detailLabel,children:"Â§áÊ≥®:"}),e.jsx("span",{children:t.note})]})]}),e.jsx("button",{onClick:o,style:he.confirmButton,children:"‚úÖ Á°ÆËÆ§Êî∂Ê¨æ"})]})},pr=({submission:t,note:o,onNoteChange:s,onConfirm:n,onCancel:a,confirming:c})=>e.jsx("div",{style:he.modalOverlay,onClick:a,children:e.jsxs("div",{style:he.modal,onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{style:he.modalHeader,children:[e.jsx("h3",{style:{margin:0},children:"Á°ÆËÆ§Êî∂Ê¨æ"}),e.jsx("button",{onClick:a,style:he.closeButton,children:"√ó"})]}),e.jsxs("div",{style:he.modalBody,children:[e.jsxs("div",{style:he.confirmInfo,children:[e.jsxs("div",{style:he.infoRow,children:[e.jsx("span",{style:he.infoLabel,children:"Â≠¶Áîü:"}),e.jsx("span",{style:he.infoValue,children:t.submitterName})]}),e.jsxs("div",{style:he.infoRow,children:[e.jsx("span",{style:he.infoLabel,children:"Áè≠Á∫ß:"}),e.jsx("span",{style:he.infoValue,children:t.submitterDepartment||"-"})]}),e.jsxs("div",{style:he.infoRow,children:[e.jsx("span",{style:he.infoLabel,children:"ÈáëÈ¢ù:"}),e.jsxs("span",{style:{...he.infoValue,color:"#ef4444",fontWeight:"bold",fontSize:"1.125rem"},children:["RM ",(t.amount||0).toLocaleString()]})]}),e.jsxs("div",{style:he.infoRow,children:[e.jsx("span",{style:he.infoLabel,children:"ÊµÅÊ∞¥Âè∑:"}),e.jsx("span",{style:he.infoValue,children:t.submissionNumber})]})]}),e.jsxs("div",{style:he.formGroup,children:[e.jsx("label",{style:he.label,children:"Á°ÆËÆ§Â§áÊ≥®ÔºàÂèØÈÄâÔºâ:"}),e.jsx("textarea",{value:o,onChange:d=>s(d.target.value),placeholder:"‰æãÂ¶ÇÔºöÂ∑≤Ê∏ÖÁÇπÊ†∏ÂØπÔºåÁé∞ÈáëÊó†ËØØ",rows:3,style:he.textarea})]}),e.jsx("div",{style:he.warningBox,children:"‚ö†Ô∏è Á°ÆËÆ§ÂêéÔºåÊ≠§Á¨îÁé∞ÈáëÂ∞ÜÂä†ÂÖ•ÊÇ®ÁöÑÊåÅÊúâÁé∞Èáë‰∏≠ÔºåÂèØ‰∏ä‰∫§ÁªôCashier"})]}),e.jsxs("div",{style:he.modalFooter,children:[e.jsx("button",{onClick:a,style:he.cancelButton,disabled:c,children:"ÂèñÊ∂à"}),e.jsx("button",{onClick:n,style:he.submitButton,disabled:c,children:c?"Á°ÆËÆ§‰∏≠...":"‚úÖ Á°ÆËÆ§Êî∂Ê¨æ"})]})]})}),he={container:{padding:"0"},loading:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",color:"#6b7280"},spinner:{width:"3rem",height:"3rem",border:"4px solid #e5e7eb",borderTopColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1.5rem"},statCard:{background:"#fafafa",padding:"1.25rem",borderRadius:"12px",borderLeft:"4px solid",display:"flex",alignItems:"flex-start",gap:"1rem"},statIcon:{fontSize:"2rem"},statContent:{flex:1},statValue:{fontSize:"1.5rem",fontWeight:"bold",color:"#1f2937",marginBottom:"0.25rem"},statTitle:{fontSize:"0.875rem",color:"#6b7280",fontWeight:"500"},statDescription:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},toolbar:{display:"flex",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap"},searchInput:{flex:"1 1 300px",padding:"0.75rem 1rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"0.875rem"},select:{padding:"0.75rem 1rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"0.875rem",background:"white",cursor:"pointer"},submissionsList:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"1.5rem"},submissionCard:{background:"#fafafa",border:"2px solid #e5e7eb",borderRadius:"12px",padding:"1.5rem",transition:"all 0.2s",":hover":{borderColor:"#f59e0b",boxShadow:"0 4px 12px rgba(245, 158, 11, 0.1)"}},submissionHeader:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem",gap:"1rem"},submissionInfo:{flex:1},submitterName:{fontSize:"1.125rem",fontWeight:"bold",color:"#1f2937",marginBottom:"0.25rem"},submissionMeta:{fontSize:"0.875rem",color:"#6b7280"},submissionActions:{display:"flex",flexDirection:"column",alignItems:"flex-end"},submissionAmount:{textAlign:"right"},amountLabel:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},amountValue:{fontSize:"1.25rem",fontWeight:"bold",color:"#ef4444"},submissionDetails:{padding:"1rem",background:"white",borderRadius:"8px",marginBottom:"1rem"},detailRow:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem",color:"#374151",marginBottom:"0.5rem"},detailLabel:{color:"#6b7280",fontWeight:"500"},confirmButton:{width:"100%",padding:"0.75rem",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",transition:"opacity 0.2s"},emptyState:{textAlign:"center",padding:"3rem",color:"#6b7280"},emptyIcon:{fontSize:"4rem",marginBottom:"1rem"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},modal:{background:"white",borderRadius:"12px",maxWidth:"500px",width:"100%",maxHeight:"90vh",overflow:"auto"},modalHeader:{padding:"1.5rem",borderBottom:"2px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},closeButton:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#6b7280",padding:"0",width:"2rem",height:"2rem"},modalBody:{padding:"1.5rem"},confirmInfo:{background:"#f3f4f6",padding:"1rem",borderRadius:"8px",marginBottom:"1.5rem"},infoRow:{display:"flex",justifyContent:"space-between",padding:"0.5rem 0",fontSize:"0.875rem"},infoLabel:{color:"#6b7280",fontWeight:"500"},infoValue:{color:"#1f2937",fontWeight:"600"},formGroup:{marginBottom:"1.5rem"},label:{display:"block",fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},textarea:{width:"100%",padding:"0.75rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"0.875rem",resize:"vertical",fontFamily:"inherit",boxSizing:"border-box"},warningBox:{background:"#fef3c7",border:"2px solid #fbbf24",color:"#92400e",padding:"0.75rem",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"500"},modalFooter:{padding:"1.5rem",borderTop:"2px solid #e5e7eb",display:"flex",gap:"1rem",justifyContent:"flex-end"},cancelButton:{padding:"0.75rem 1.5rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",color:"#374151"},submitButton:{padding:"0.75rem 1.5rem",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"}},tn=document.styleSheets[0];if(tn)try{tn.insertRule("@keyframes spin { to { transform: rotate(360deg); } }",tn.cssRules.length)}catch{}const fr=t=>{if(!t||typeof t!="object")return 100;try{const o=t.pointAllocationRules?.sellerManager;return o&&typeof o.maxPerAllocation=="number"?o.maxPerAllocation:100}catch{return 100}},xr=t=>{if(!t||typeof t!="object")return .3;try{const o=t.pointAllocationRules?.sellerManager;return o&&typeof o.warningThreshold=="number"?o.warningThreshold:.3}catch{return .3}},br=t=>t==null?"":typeof t=="string"||typeof t=="number"?String(t):typeof t=="object"&&(t["zh-TW"]||t["zh-CN"]||t.en||t.zh||t.cn)||"",yr=()=>{const t=_e(),{orgEventCode:o}=ht(),{userProfile:s,loading:n}=lt(),[a,c]=r.useState(!0),[d,g]=r.useState(null),[i,I]=r.useState(null),[j,m]=r.useState(null),[C,w]=r.useState(null),[h,R]=r.useState([]),[B,k]=r.useState(null),[D,T]=r.useState([]),[y,b]=r.useState(!1),[f,x]=r.useState(!1),[l,p]=r.useState(null),[u,N]=r.useState("overview");r.useEffect(()=>{if(n)return;(async()=>{try{if(c(!0),!s){console.warn("[SM Dashboard] Êú™ÊâæÂà∞ÁôªÂΩï‰ø°ÊÅØ"),localStorage.getItem("sellerManagerInfo")&&console.warn("[SM Dashboard] ÂèëÁé∞ÊóßÁöÑ localStorageÔºåÂª∫ËÆÆÈáçÊñ∞ÁôªÂΩï"),t(`/login/${o}`);return}if(console.log("[SM Dashboard] Áî®Êà∑‰ø°ÊÅØ (AuthContext):",s),!s.roles||!s.roles.includes("sellerManager")){alert("ÊÇ®Ê≤°Êúâ Seller Manager ÊùÉÈôê"),t(`/login/${o}`);return}const F=s.sellerManager?.managedDepartments||s.managedDepartments||[];(!Array.isArray(F)||F.length===0)&&console.warn("[SM Dashboard] ‚ö†Ô∏è Ê≥®ÊÑèÔºöÊÇ®ËøòÊ≤°ÊúâË¢´ÂàÜÈÖçÁÆ°ÁêÜ‰ªª‰ΩïÈÉ®Èó®");const O={...s,managedDepartments:F};g(O),m(s.eventId);const G=await Ve(ke(re,"organizations",s.organizationId,"events",s.eventId));if(G.exists()){const oe=G.data();I(oe||{}),console.log("[SM Dashboard] Ê¥ªÂä®Êï∞ÊçÆÂä†ËΩΩÊàêÂäü")}}catch(F){console.error("[SM Dashboard] ÂàùÂßãÂåñÂ§±Ë¥•:",F)}finally{c(!1)}})()},[s,n,o,t]),r.useEffect(()=>{let L=null;return d&&j&&(L=v()),()=>{typeof L=="function"&&L()}},[d,j]);const v=()=>{if(!(!d||!j))try{if(b(!0),!Array.isArray(d.managedDepartments)||d.managedDepartments.length===0){console.warn("‚ö†Ô∏è Ê≤°ÊúâÁÆ°ÁêÜÁöÑÈÉ®Èó®"),T([]),b(!1);return}console.log(`üìä ÂºÄÂßãÂä†ËΩΩ SellersÔºåÁÆ°ÁêÜ ${d.managedDepartments.length} ‰∏™ÈÉ®Èó®:`,d.managedDepartments);const L=De(Ie(re,"organizations",d.organizationId,"events",j,"users"),be("roles","array-contains","seller"));return rt(L,O=>{const G=[];let oe=0;O.forEach(xe=>{oe++;const Ee=xe.data()||{};d.managedDepartments&&Ee.identityInfo?.department&&d.managedDepartments.includes(Ee.identityInfo.department)&&G.push({id:xe.id,userId:xe.id,...Ee})}),G.sort((xe,Ee)=>{const We=xe.accountStatus?.createdAt?.toMillis?xe.accountStatus.createdAt.toMillis():0;return(Ee.accountStatus?.createdAt?.toMillis?Ee.accountStatus.createdAt.toMillis():0)-We}),console.log(`‚úÖ Âä†ËΩΩÂÆåÊàê: ËØªÂèñ ${oe} Êù°ÔºåÁ≠õÈÄâÂá∫ ${G.length} Êù° (ËøáÊª§ ${oe-G.length} Êù°)`),T(G),b(!1);const ue=P(G),ye=_(G);k(ue),R(ye)},O=>{console.error("‚ùå Âä†ËΩΩ Sellers Â§±Ë¥•:",O),T([]),b(!1)})}catch(L){console.error("‚ùå Âä†ËΩΩ Sellers ÂºÇÂ∏∏:",L),T([]),b(!1)}},P=L=>{if(!Array.isArray(L)||L.length===0)return{totalUsers:0,activeUsers:0,currentBalance:0,totalRevenue:0,totalCollected:0,pendingCollection:0,collectionRate:0};let F=0,O=0,G=0,oe=0,ue=0,ye=0,xe=0,Ee=0;L.forEach(ot=>{const $e=ot.seller||{};F++;const Be=$e.availablePoints||0,Oe=$e.totalPointsSold||0,Q=$e.totalCashCollected||0;Oe>0&&O++,G+=Be,oe+=$e.totalRevenue||0,ue+=Q,ye+=$e.pendingCollection||0;const ae=$e.collectionAlert||{};ae.hasWarning&&(xe++,ae.warningLevel==="high"&&Ee++)});const We=oe>0?ue/oe:0;return{totalUsers:F,activeUsers:O,currentBalance:G,totalRevenue:oe,totalCollected:ue,pendingCollection:ye,collectionRate:We,usersWithWarnings:xe,highRiskUsers:Ee}},_=L=>{if(!Array.isArray(L)||L.length===0)return[];const F={};return L.forEach(G=>{const oe=G.identityInfo?.department;if(!oe)return;F[oe]||(F[oe]={departmentCode:oe,departmentName:G.identityInfo?.departmentName||oe,totalCount:0,activeCount:0,currentBalance:0,totalRevenue:0,totalCollected:0,pendingCollection:0,usersWithWarnings:0,highRiskUsers:0});const ue=F[oe],ye=G.seller||{};ue.totalCount++,(ye.totalPointsSold||0)>0&&ue.activeCount++,ue.currentBalance+=ye.availablePoints||0,ue.totalRevenue+=ye.totalRevenue||0,ue.totalCollected+=ye.totalCashCollected||0,ue.pendingCollection+=ye.pendingCollection||0;const xe=ye.collectionAlert||{};xe.hasWarning&&(ue.usersWithWarnings++,xe.warningLevel==="high"&&ue.highRiskUsers++)}),Object.values(F).map(G=>({...G,id:G.departmentCode,membersStats:{totalCount:G.totalCount,activeCount:G.activeCount},pointsStats:{currentBalance:G.currentBalance,totalRevenue:G.totalRevenue,totalCollected:G.totalCollected,pendingCollection:G.pendingCollection,collectionRate:G.totalRevenue>0?G.totalCollected/G.totalRevenue:0},collectionAlerts:{usersWithWarnings:G.usersWithWarnings,highRiskUsers:G.highRiskUsers>0?[]:[]}}))},H=L=>{console.log("[SM Dashboard] ÈÄâÊã© Seller ËøõË°åÂàÜÈÖç:",L),p(L),x(!0)},A=async()=>{try{await Rt(we),localStorage.removeItem("sellerManagerInfo"),localStorage.removeItem("currentUser"),console.log("[SM Dashboard] Áî®Êà∑Â∑≤ÁôªÂá∫"),t(`/login/${o}`)}catch(L){console.error("[SM Dashboard] ÁôªÂá∫Â§±Ë¥•:",L),alert("ÁôªÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØï")}};if(a)return e.jsx("div",{style:ve.container,children:e.jsxs("div",{style:ve.loadingCard,children:[e.jsx("div",{style:ve.spinner}),e.jsx("p",{children:"Âä†ËΩΩ‰∏≠..."})]})});const z=d||{},M=i||{},E=Array.isArray(D)?D:[],X=B||{},te=Array.isArray(h)?h:[],W=fr(M);xr(M);const U=z.basicInfo?.chineseName||z.basicInfo?.englishName||"Êú™Áü•Áî®Êà∑",q=br(M.eventName)||"Ê¥ªÂä®ÂêçÁß∞",pe={managedUsersStats:X,allocationStats:{totalAllocations:0,totalPointsAllocated:0,averagePerAllocation:0},collectionManagement:{usersWithWarnings:X.usersWithWarnings||0,highRiskUsers:X.highRiskUsers||0}};return e.jsxs("div",{style:ve.container,children:[e.jsxs("div",{style:ve.header,children:[e.jsx("div",{style:ve.headerLeft,children:e.jsxs("div",{children:[e.jsx("h1",{style:ve.title,children:"Seller Manager ÊéßÂà∂Âè∞"}),e.jsx("p",{style:ve.subtitle,children:q}),e.jsxs("p",{style:ve.roleLabel,children:["ÁÆ°ÁêÜ ",z.managedDepartments?.length||0," ‰∏™ÈÉ®Èó®"]})]})}),e.jsxs("div",{style:ve.headerActions,children:[e.jsxs("div",{style:ve.userInfo,children:[e.jsx("div",{style:ve.userName,children:U}),e.jsxs("div",{style:ve.allocationLimit,children:["ÊØèÊ¨°ÊúÄÈ´òÂàÜÈÖç: RM ",W]})]}),e.jsx("button",{style:ve.logoutButton,onClick:A,children:"ÁôªÂá∫"}),an&&e.jsx("div",{style:ve.versionBadge,children:an})]})]}),e.jsxs("div",{style:ve.tabs,children:[e.jsx("button",{style:{...ve.tab,...u==="overview"?ve.activeTab:{}},onClick:()=>N("overview"),children:"üìä ÊÄªËßà"}),e.jsx("button",{style:{...ve.tab,...u==="allocate"?ve.activeTab:{}},onClick:()=>N("allocate"),children:"üì¶ ÂàÜÈÖçÁÇπÊï∞"}),e.jsx("button",{style:{...ve.tab,...u==="collect"?ve.activeTab:{}},onClick:()=>N("collect"),children:"üíµ Êî∂ÂèñÁé∞Èáë"}),e.jsx("button",{style:{...ve.tab,...u==="submit"?ve.activeTab:{}},onClick:()=>N("submit"),children:"üì§ ‰∏ä‰∫§Áé∞Èáë"}),e.jsx("button",{style:{...ve.tab,...u==="sellers"?ve.activeTab:{}},onClick:()=>N("sellers"),children:"üë• Sellers"})]}),e.jsxs("div",{style:ve.content,children:[u==="overview"&&e.jsx("div",{children:e.jsx(ir,{smStats:pe,departmentStats:te,eventData:M})}),u==="allocate"&&e.jsxs("div",{style:ve.section,children:[e.jsxs("div",{style:ve.sectionHeader,children:[e.jsx("h2",{style:ve.sectionTitle,children:"üì¶ ÂàÜÈÖçÁÇπÊï∞"}),e.jsxs("p",{style:{margin:0,color:"#6b7280",fontSize:"0.875rem"},children:["ÈÄâÊã© Seller ÂàÜÈÖçÁÇπÊï∞ÔºàÊØèÊ¨°ÊúÄÈ´ò ",W," ÁÇπÔºâ"]})]}),y?e.jsxs("div",{style:ve.loadingCard,children:[e.jsx("div",{style:ve.spinner}),e.jsx("p",{children:"Âä†ËΩΩ Sellers..."})]}):e.jsx(vn,{sellers:E,selectedDepartment:null,onSelectSeller:H,eventId:j,orgId:z.organizationId,currentUser:z})]}),u==="collect"&&e.jsx("div",{style:ve.section,children:e.jsx(hr,{userInfo:z,eventData:M,sellers:E})}),u==="submit"&&e.jsx("div",{style:ve.section,children:e.jsx(cr,{userInfo:z,eventData:M})}),u==="sellers"&&e.jsxs("div",{children:[e.jsxs("div",{style:ve.sectionHeader,children:[e.jsxs("h2",{style:ve.sectionTitle,children:["üë• Sellers (",E.length,")"]}),e.jsxs("div",{style:ve.actionsBar,children:[e.jsx("button",{style:ve.refreshButton,children:"üîÑ Êï∞ÊçÆÂÆûÊó∂Êõ¥Êñ∞‰∏≠"}),e.jsxs("div",{style:ve.allocationInfo,children:["üí° ÊØèÊ¨°ÊúÄÈ´òÂàÜÈÖç: ",e.jsxs("strong",{children:["RM ",W]})]})]})]}),y?e.jsxs("div",{style:ve.loadingCard,children:[e.jsx("div",{style:ve.spinner}),e.jsx("p",{children:"Âä†ËΩΩ Sellers..."})]}):e.jsx(vn,{sellers:E,selectedDepartment:null,onSelectSeller:H,eventId:j,orgId:z.organizationId,currentUser:z})]})]}),f&&l&&e.jsx(sr,{seller:l,sellerManager:z,organizationId:z.organizationId,eventId:j,maxPerAllocation:W,onClose:()=>{x(!1),p(null)},onSuccess:()=>{console.log("[SM Dashboard] ÁÇπÊï∞ÂàÜÈÖçÊàêÂäüÔºåÊï∞ÊçÆÂ∞ÜËá™Âä®Êõ¥Êñ∞")}})]})},ve={container:{minHeight:"100vh",background:"#f3f4f6",padding:"1rem"},loadingCard:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"3rem",background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},spinner:{width:"3rem",height:"3rem",border:"4px solid #e5e7eb",borderTopColor:"#f59e0b",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:"1rem"},header:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem",background:"white",padding:"1.5rem",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",flexWrap:"wrap",gap:"1rem"},headerLeft:{display:"flex",alignItems:"flex-start"},title:{fontSize:"1.75rem",fontWeight:"bold",color:"#1f2937",margin:"0 0 0.5rem 0"},subtitle:{color:"#6b7280",margin:"0 0 0.25rem 0",fontSize:"0.95rem"},roleLabel:{color:"#f59e0b",margin:0,fontSize:"0.875rem",fontWeight:"600"},headerActions:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},userInfo:{padding:"0.5rem 1rem",background:"#fef3c7",borderRadius:"8px"},userName:{fontSize:"0.875rem",fontWeight:"600",color:"#92400e",marginBottom:"0.25rem"},allocationLimit:{fontSize:"0.75rem",fontWeight:"500",color:"#b45309"},logoutButton:{padding:"0.5rem 1rem",background:"#ef4444",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500"},versionBadge:{padding:"0.5rem 0.75rem",background:"#e5e7eb",color:"#374151",borderRadius:"8px",fontSize:"0.625rem",fontWeight:"600",letterSpacing:"0.5px"},section:{background:"white",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",padding:"1.5rem",marginBottom:"1rem"},sectionHeader:{marginBottom:"1.5rem"},sectionTitle:{fontSize:"1.25rem",fontWeight:"bold",color:"#1f2937",margin:"0 0 1rem 0"},actionsBar:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},refreshButton:{padding:"0.75rem 1.5rem",background:"#f3f4f6",color:"#6b7280",border:"2px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600"},allocationInfo:{padding:"0.75rem 1.5rem",background:"#fef3c7",color:"#92400e",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"500"},tabs:{display:"flex",gap:"0.5rem",marginBottom:"1rem",flexWrap:"wrap",background:"white",padding:"1rem",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},tab:{padding:"0.75rem 1.5rem",background:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",color:"#6b7280",transition:"all 0.2s"},activeTab:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",color:"white"},content:{background:"white",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",marginBottom:"1rem"}},nn=document.styleSheets[0];if(nn)try{nn.insertRule("@keyframes spin { to { transform: rotate(360deg); } }",nn.cssRules.length)}catch{}const jr=({submission:t,onConfirm:o,onCancel:s})=>{const[n,a]=r.useState(""),[c,d]=r.useState(""),[g,i]=r.useState(""),[I,j]=r.useState(!1),m=r.useRef(null);r.useEffect(()=>{m.current&&m.current.focus()},[]);const C=k=>!k&&k!==0?"RM 0.00":`RM ${k.toLocaleString("en-MY",{minimumFractionDigits:2,maximumFractionDigits:2})}`,w=k=>k?(k.toDate?k.toDate():new Date(k)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",h=k=>{const D=k.target.value.replace(/\D/g,"");D.length<=6&&(a(D),i(""))},R=async()=>{if(n.length!==6){i("ËØ∑ËæìÂÖ•6‰ΩçÊï∞Â≠ó‰∫§ÊòìÂØÜÁ†Å");return}try{j(!0),await o(n,c)}catch(k){i(k.message||"Á°ÆËÆ§Â§±Ë¥•ÔºåËØ∑ÈáçËØï"),j(!1)}},B=k=>{k.key==="Enter"&&n.length===6?R():k.key==="Escape"&&s()};return e.jsx("div",{className:"pin-dialog-overlay",onClick:s,children:e.jsxs("div",{className:"pin-dialog",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"pin-dialog-header",children:[e.jsx("h3",{children:"üîê Êé•ÂçïÁ°ÆËÆ§Êî∂Ê¨æ"}),e.jsx("button",{className:"close-button",onClick:s,children:"‚úï"})]}),e.jsxs("div",{className:"pin-dialog-content",children:[e.jsxs("div",{className:"submission-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Êèê‰∫§ËÄÖÔºö"}),e.jsx("span",{className:"summary-value",children:t.submitterName})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"ËßíËâ≤Ôºö"}),e.jsx("span",{className:"summary-value",children:t.submitterRole})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"ÈáëÈ¢ùÔºö"}),e.jsx("span",{className:"summary-value amount",children:C(t.amount)})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Êèê‰∫§Êó∂Èó¥Ôºö"}),e.jsx("span",{className:"summary-value",children:w(t.submittedAt)})]}),t.note&&e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{className:"summary-label",children:"Â§áÊ≥®Ôºö"}),e.jsx("span",{className:"summary-value",children:t.note})]})]}),e.jsxs("div",{className:"pin-input-section",children:[e.jsxs("label",{htmlFor:"transactionPin",className:"pin-label",children:[e.jsx("span",{className:"label-icon",children:"üîë"}),"ËØ∑ËæìÂÖ•‰∫§ÊòìÂØÜÁ†Å"]}),e.jsx("input",{ref:m,id:"transactionPin",type:"password",inputMode:"numeric",value:n,onChange:h,onKeyPress:B,placeholder:"6‰ΩçÊï∞Â≠óÂØÜÁ†Å",className:`pin-input ${g?"error":""}`,disabled:I,maxLength:6}),e.jsx("div",{className:"pin-dots",children:[0,1,2,3,4,5].map(k=>e.jsx("div",{className:`pin-dot ${k<n.length?"filled":""}`},k))}),g&&e.jsx("p",{className:"error-message",children:g})]}),e.jsxs("div",{className:"note-section",children:[e.jsx("label",{htmlFor:"confirmationNote",className:"note-label",children:"Á°ÆËÆ§Â§áÊ≥®ÔºàÂèØÈÄâÔºâ"}),e.jsx("textarea",{id:"confirmationNote",value:c,onChange:k=>d(k.target.value),placeholder:"‰æãÂ¶ÇÔºöÂ∑≤Ê†∏ÂØπÊó†ËØØÔºåÊî∂Âà∞50Âº†100ÂÖÉÁ∫∏Èíû",className:"note-textarea",disabled:I,maxLength:200,rows:3}),e.jsxs("div",{className:"char-count",children:[c.length," / 200"]})]}),e.jsxs("div",{className:"security-tip",children:[e.jsx("span",{className:"tip-icon",children:"‚ö†Ô∏è"}),e.jsx("span",{className:"tip-text",children:"ËØ∑Á°ÆËÆ§Â∑≤Êî∂Âà∞Áé∞ÈáëÂπ∂ÂΩìÈù¢Ê†∏ÂØπÈáëÈ¢ùÂêéÂÜçÁÇπÂáªÁ°ÆËÆ§„ÄÇÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ"})]})]}),e.jsxs("div",{className:"pin-dialog-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:s,disabled:I,children:"ÂèñÊ∂à"}),e.jsx("button",{className:"confirm-btn",onClick:R,disabled:I||n.length!==6,children:I?"Á°ÆËÆ§‰∏≠...":"‚úÖ Á°ÆËÆ§Êî∂Ê¨æ"})]})]})})},vr=({statistics:t,pendingSubmissions:o,onRefresh:s,onClaim:n,currentUser:a})=>{const{cashStats:c,pendingStats:d}=t,[g,i]=r.useState(null),[I,j]=r.useState(!1),[m,C]=r.useState(null),w=f=>!f&&f!==0?"RM 0.00":`RM ${f.toLocaleString("en-MY",{minimumFractionDigits:2,maximumFractionDigits:2})}`,h=f=>f?(f.toDate?f.toDate():new Date(f)).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",R=f=>f?(f.toDate?f.toDate():new Date(f)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",B=f=>({seller:"Seller",sellerManager:"Seller Manager",pointSeller:"Point Seller"})[f]||f,k=f=>({seller:"üõçÔ∏è",sellerManager:"üë®‚Äçüè´",pointSeller:"üí≥"})[f]||"üë§",D=f=>{C(f),j(!0)},T=async(f,x)=>{if(m)try{i(m.id),j(!1),await n(m.id,f,x),alert("‚úÖ Êî∂Ê¨æÁ°ÆËÆ§ÊàêÂäüÔºÅ"),C(null),s()}catch(l){console.error("Êé•ÂçïÁ°ÆËÆ§Â§±Ë¥•:",l),alert("‚ùå Á°ÆËÆ§Â§±Ë¥•: "+l.message)}finally{i(null)}},y=()=>{j(!1),C(null)},b=[{title:"‰ªäÊó•Êî∂Ê¨æ",icon:"üí∞",amount:c.todayCollected||0,count:c.todayCollections||0,color:"blue"},{title:"Êú¨Âë®Êî∂Ê¨æ",icon:"üìÖ",amount:c.thisWeekCollected||0,count:c.thisWeekCollections||0,color:"green"},{title:"Êú¨ÊúàÊî∂Ê¨æ",icon:"üìÜ",amount:c.thisMonthCollected||0,count:c.thisMonthCollections||0,color:"purple"},{title:"Á¥ØËÆ°Êî∂Ê¨æ",icon:"üìä",amount:c.totalCollected||0,count:c.totalCollections||0,color:"orange"}];return e.jsxs("div",{className:"collection-overview",children:[e.jsxs("div",{className:"overview-header",children:[e.jsx("h2",{children:"üìä Êî∂Ê¨æÊ¶ÇËßà"}),e.jsx("button",{className:"refresh-button",onClick:s,children:"üîÑ Âà∑Êñ∞Êï∞ÊçÆ"})]}),e.jsx("div",{className:"stats-cards",children:b.map((f,x)=>e.jsxs("div",{className:`stat-card ${f.color}`,children:[e.jsxs("div",{className:"card-header",children:[e.jsx("span",{className:"card-icon",children:f.icon}),e.jsx("span",{className:"card-title",children:f.title})]}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"amount",children:w(f.amount)}),e.jsxs("div",{className:"count",children:[f.count," Á¨î"]})]})]},x))}),e.jsxs("div",{className:"pending-summary",children:[e.jsx("h3",{children:"‚è≥ ÂæÖÁ°ÆËÆ§Êî∂Ê¨æ"}),e.jsxs("div",{className:"pending-cards",children:[e.jsxs("div",{className:"pending-card",children:[e.jsx("div",{className:"pending-label",children:"ÂæÖÁ°ÆËÆ§ÈáëÈ¢ù"}),e.jsx("div",{className:"pending-amount",children:w(d.pendingAmount||0)})]}),e.jsxs("div",{className:"pending-card",children:[e.jsx("div",{className:"pending-label",children:"ÂæÖÁ°ÆËÆ§Á¨îÊï∞"}),e.jsxs("div",{className:"pending-count",children:[d.pendingCount||0," Á¨î"]})]}),d.oldestPendingDate&&e.jsxs("div",{className:"pending-card",children:[e.jsx("div",{className:"pending-label",children:"ÊúÄÊó©ÂæÖÁ°ÆËÆ§"}),e.jsx("div",{className:"pending-date",children:h(d.oldestPendingDate)})]})]})]}),e.jsxs("div",{className:"pending-pool-section",children:[e.jsxs("div",{className:"pool-header",children:[e.jsx("h3",{children:"üí∞ ÂæÖËÆ§È¢ÜÊî∂Ê¨æÊ±†"}),e.jsxs("span",{className:"pool-count",children:[o?.length||0," Á¨îÂæÖËÆ§È¢Ü"]})]}),o&&o.length>0?e.jsx("div",{className:"pool-table-container",children:e.jsxs("table",{className:"pool-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Êèê‰∫§ËÄÖ"}),e.jsx("th",{children:"ÈáëÈ¢ù"}),e.jsx("th",{children:"Êèê‰∫§Êó∂Èó¥"}),e.jsx("th",{children:"Â§áÊ≥®"}),e.jsx("th",{children:"Êìç‰Ωú"})]})}),e.jsx("tbody",{children:o.map(f=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"submitter-cell",children:[e.jsx("span",{className:"role-icon",children:k(f.submitterRole)}),e.jsxs("div",{className:"submitter-info",children:[e.jsx("div",{className:"submitter-name",children:f.submitterName}),e.jsx("div",{className:"submitter-meta",children:e.jsx("span",{className:"role-badge",children:B(f.submitterRole)})})]})]})}),e.jsx("td",{children:e.jsx("div",{className:"amount-cell",children:w(f.amount)})}),e.jsx("td",{children:e.jsx("div",{className:"time-cell",children:R(f.submittedAt)})}),e.jsx("td",{children:e.jsx("div",{className:`note-cell ${f.note?"":"empty"}`,children:f.note||"-"})}),e.jsx("td",{className:"action-cell",children:e.jsx("button",{className:"claim-button",onClick:()=>D(f),disabled:g===f.id,children:g===f.id?"‚è≥ Â§ÑÁêÜ‰∏≠...":"üéØ Êé•ÂçïÁ°ÆËÆ§"})})]},f.id))})]})}):e.jsxs("div",{className:"pool-empty",children:[e.jsx("div",{className:"empty-icon",children:"‚úÖ"}),e.jsx("p",{className:"empty-message",children:"Â§™Ê£í‰∫ÜÔºÅÂæÖËÆ§È¢ÜÊ±†Â≠êÊòØÁ©∫ÁöÑ"}),e.jsx("p",{className:"empty-hint",children:"ÊâÄÊúâÁé∞Èáë‰∏ä‰∫§ÈÉΩÂ∑≤Â§ÑÁêÜÂÆåÊØï"})]})]}),c.lastCollectionAt&&e.jsxs("div",{className:"last-collection",children:[e.jsx("h3",{children:"üïê ÊúÄÂêéÊî∂Ê¨æÊó∂Èó¥"}),e.jsx("p",{className:"last-collection-time",children:h(c.lastCollectionAt)})]}),I&&m&&e.jsx(jr,{submission:m,onConfirm:T,onCancel:y})]})},Sr=({submissions:t,onRefresh:o})=>{const[s,n]=r.useState(""),[a,c]=r.useState("all"),[d,g]=r.useState("all"),[i,I]=r.useState(null),j=b=>!b&&b!==0?"RM 0.00":`RM ${b.toLocaleString("en-MY",{minimumFractionDigits:2,maximumFractionDigits:2})}`,m=b=>b?(b.toDate?b.toDate():new Date(b)).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",C=b=>b?(b.toDate?b.toDate():new Date(b)).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",w=b=>({seller:"Seller",sellerManager:"Seller Manager",pointSeller:"Point Seller"})[b]||b,h=b=>({seller:"üõçÔ∏è",sellerManager:"üë®‚Äçüè´",pointSeller:"üí≥"})[b]||"üë§",R=b=>({pending:"ÂæÖÁ°ÆËÆ§",confirmed:"Â∑≤Á°ÆËÆ§",disputed:"Êúâ‰∫âËÆÆ",rejected:"Â∑≤ÊãíÁªù"})[b]||b,B=r.useMemo(()=>t.filter(b=>{if(a!=="all"&&b.status!==a||d!=="all"&&b.submitterRole!==d)return!1;if(s){const f=s.toLowerCase(),x=b.submitterName?.toLowerCase().includes(f),l=b.note?.toLowerCase().includes(f),p=b.receivedByName?.toLowerCase().includes(f),u=b.amount?.toString().includes(f),N=b.submitterPhone?.includes(f),v=b.submitterEmployeeId?.toLowerCase().includes(f);if(!x&&!l&&!p&&!u&&!N&&!v)return!1}return!0}),[t,a,d,s]),k=r.useMemo(()=>{const b=t.length,f=t.filter(N=>N.status==="confirmed").length,x=t.filter(N=>N.status==="pending").length,l=t.reduce((N,v)=>N+(v.amount||0),0),p=t.filter(N=>N.status==="confirmed").reduce((N,v)=>N+(v.amount||0),0),u=t.filter(N=>N.status==="pending").reduce((N,v)=>N+(v.amount||0),0);return{total:b,confirmed:f,pending:x,totalAmount:l,confirmedAmount:p,pendingAmount:u}},[t]),D=r.useMemo(()=>{const b=new Map;return t.filter(f=>f.status==="confirmed"&&f.receivedBy).forEach(f=>{const x=f.receivedBy;if(!b.has(x)){const p=f.receiverChineseName||"",u=f.receiverEnglishName||"";let N="";p&&u?N=`${p} ${u}`:p?N=p:u?N=u:N=f.receiverName||f.receivedBy,b.set(x,{name:N,count:0,amount:0})}const l=b.get(x);l.count+=1,l.amount+=f.amount||0}),Array.from(b.values()).sort((f,x)=>x.count-f.count)},[t]),T=()=>{n(""),c("all"),g("all")},y=b=>{I(i===b?null:b)};return e.jsxs("div",{className:"collection-history",children:[e.jsxs("div",{className:"history-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx("h2",{children:"üìã Êî∂Ê¨æËÆ∞ÂΩï"}),e.jsxs("p",{className:"header-subtitle",children:["ÊâÄÊúâCashierÁöÑÊî∂Ê¨æËÆ∞ÂΩïÔºàÂÖ± ",t.length," Á¨îÔºâ"]})]}),e.jsx("button",{className:"refresh-button",onClick:o,children:"üîÑ Âà∑Êñ∞"})]}),e.jsxs("div",{className:"history-stats",children:[e.jsx("div",{className:"stat-card total",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-label",children:"üìä ÊÄªËÆ∞ÂΩï"}),e.jsxs("div",{className:"stat-value",children:[k.total," Á¨î"]}),e.jsx("div",{className:"stat-amount",children:j(k.totalAmount)})]})}),e.jsx("div",{className:"stat-card confirmed",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-label",children:"‚úÖ Â∑≤Á°ÆËÆ§"}),e.jsxs("div",{className:"stat-value",children:[k.confirmed," Á¨î"]}),e.jsx("div",{className:"stat-amount",children:j(k.confirmedAmount)})]})}),e.jsx("div",{className:"stat-card pending",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-label",children:"‚è≥ ÂæÖÁ°ÆËÆ§"}),e.jsxs("div",{className:"stat-value",children:[k.pending," Á¨î"]}),e.jsx("div",{className:"stat-amount",children:j(k.pendingAmount)})]})})]}),D.length>0&&e.jsxs("div",{className:"fm-statistics",children:[e.jsx("h3",{children:"üë• Cashier Êî∂Ê¨æÁªüËÆ°"}),e.jsx("div",{className:"fm-list",children:D.map((b,f)=>e.jsxs("div",{className:"fm-item",children:[e.jsx("span",{className:"fm-name",children:b.name}),e.jsxs("span",{className:"fm-count",children:[b.count," Á¨î"]}),e.jsx("span",{className:"fm-amount",children:j(b.amount)})]},f))})]}),e.jsxs("div",{className:"history-filters",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Áä∂ÊÄÅ"}),e.jsxs("select",{className:"filter-select",value:a,onChange:b=>c(b.target.value),children:[e.jsx("option",{value:"all",children:"ÂÖ®ÈÉ®Áä∂ÊÄÅ"}),e.jsx("option",{value:"pending",children:"ÂæÖÁ°ÆËÆ§"}),e.jsx("option",{value:"confirmed",children:"Â∑≤Á°ÆËÆ§"}),e.jsx("option",{value:"disputed",children:"Êúâ‰∫âËÆÆ"}),e.jsx("option",{value:"rejected",children:"Â∑≤ÊãíÁªù"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"ËßíËâ≤"}),e.jsxs("select",{className:"filter-select",value:d,onChange:b=>g(b.target.value),children:[e.jsx("option",{value:"all",children:"ÂÖ®ÈÉ®ËßíËâ≤"}),e.jsx("option",{value:"seller",children:"Seller"}),e.jsx("option",{value:"sellerManager",children:"Seller Manager"}),e.jsx("option",{value:"pointSeller",children:"Point Seller"})]})]}),e.jsxs("div",{className:"filter-group search-group",children:[e.jsx("label",{children:"ÊêúÁ¥¢"}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",className:"search-input",placeholder:"ÊêúÁ¥¢ÂßìÂêç„ÄÅÁîµËØù„ÄÅÂ∑•Âè∑„ÄÅÈáëÈ¢ù...",value:s,onChange:b=>n(b.target.value)}),s&&e.jsx("button",{className:"clear-search-btn",onClick:()=>n(""),children:"‚úï"})]})]}),e.jsx("button",{className:"reset-filters-btn",onClick:T,children:"üîÑ ÈáçÁΩÆ"})]}),B.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"üì≠"}),e.jsx("p",{className:"empty-message",children:"Ê≤°ÊúâÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑËÆ∞ÂΩï"}),(s||a!=="all"||d!=="all")&&e.jsx("button",{className:"reset-btn",onClick:T,children:"ÈáçÁΩÆÁ≠õÈÄâÊù°‰ª∂"})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Êèê‰∫§ËÄÖ"}),e.jsx("th",{children:"ÁîµËØù"}),e.jsx("th",{children:"Â∑•Âè∑"}),e.jsx("th",{children:"ÈáëÈ¢ù"}),e.jsx("th",{children:"Áä∂ÊÄÅ"}),e.jsx("th",{children:"Êèê‰∫§Êó∂Èó¥"}),e.jsx("th",{children:"Êé•Êî∂ËÄÖ"}),e.jsx("th",{children:"ÊòéÁªÜ"})]})}),e.jsx("tbody",{children:B.map(b=>e.jsxs(ln.Fragment,{children:[e.jsxs("tr",{className:`status-${b.status}`,children:[e.jsx("td",{children:e.jsxs("div",{className:"submitter-cell",children:[e.jsx("span",{className:"role-icon",children:h(b.submitterRole)}),e.jsxs("div",{className:"submitter-info",children:[e.jsx("div",{className:"submitter-name",children:b.submitterName}),e.jsx("div",{className:"submitter-meta",children:e.jsx("span",{className:"role-badge",children:w(b.submitterRole)})})]})]})}),e.jsx("td",{children:e.jsx("div",{className:"phone-cell",children:b.submitterPhone||"-"})}),e.jsx("td",{children:e.jsx("div",{className:"employee-id-cell",children:b.submitterEmployeeId||"-"})}),e.jsx("td",{children:e.jsx("div",{className:"amount-cell",children:j(b.amount)})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${b.status}`,children:R(b.status)})}),e.jsx("td",{children:e.jsx("div",{className:"time-cell",children:m(b.submittedAt)})}),e.jsx("td",{children:e.jsx("div",{className:"receiver-cell",children:(()=>{const f=b.receiverChineseName||"",x=b.receiverEnglishName||"";return f&&x?`${f} ${x}`:f||x||b.receiverName||"-"})()})}),e.jsx("td",{className:"detail-cell",children:b.includedSales?.length>0||b.confirmationNote||b.pointCardInfo?e.jsx("button",{className:"detail-button",onClick:()=>y(b.id),children:i===b.id?"‚ñº":"‚ñ∂"}):e.jsx("span",{style:{color:"#d1d5db"},children:"-"})})]}),i===b.id&&e.jsx("tr",{className:"expanded-row",children:e.jsx("td",{colSpan:"8",children:e.jsxs("div",{className:"expanded-content",children:[b.status==="confirmed"&&b.confirmationNote&&e.jsxs("div",{className:"expanded-section",children:[e.jsx("div",{className:"section-title",children:"‚úÖ Á°ÆËÆ§‰ø°ÊÅØ"}),e.jsxs("div",{className:"confirmed-info",children:[(()=>{const f=b.receiverChineseName||"",x=b.receiverEnglishName||"",l=f&&x?`${f} ${x}`:f||x||b.receiverName;return l&&e.jsxs("div",{className:"confirmed-item",children:[e.jsx("span",{className:"confirmed-label",children:"Êé•Êî∂ËÄÖÔºö"}),e.jsx("span",{className:"confirmed-value",children:l})]})})(),b.confirmedAt&&e.jsxs("div",{className:"confirmed-item",children:[e.jsx("span",{className:"confirmed-label",children:"Á°ÆËÆ§Êó∂Èó¥Ôºö"}),e.jsx("span",{className:"confirmed-value",children:C(b.confirmedAt)})]}),b.confirmationNote&&e.jsxs("div",{className:"confirmed-item",children:[e.jsx("span",{className:"confirmed-label",children:"Á°ÆËÆ§Â§áÊ≥®Ôºö"}),e.jsx("span",{className:"confirmed-value",children:b.confirmationNote})]})]})]}),b.pointCardInfo&&e.jsxs("div",{className:"expanded-section",children:[e.jsx("div",{className:"section-title",children:"üí≥ ÁÇπÊï∞Âç°‰ø°ÊÅØ"}),e.jsxs("div",{className:"pointcard-info",children:[e.jsxs("div",{className:"pointcard-item",children:[e.jsx("span",{className:"pointcard-label",children:"ÂèëË°åÂç°Êï∞Ôºö"}),e.jsxs("span",{className:"pointcard-value",children:[b.pointCardInfo.cardsIssued," Âº†"]})]}),e.jsxs("div",{className:"pointcard-item",children:[e.jsx("span",{className:"pointcard-label",children:"ÊÄªÁÇπÊï∞Ôºö"}),e.jsxs("span",{className:"pointcard-value",children:[b.pointCardInfo.totalPoints," ÁÇπ"]})]})]})]}),b.includedSales&&b.includedSales.length>0&&e.jsxs("div",{className:"expanded-section",children:[e.jsxs("div",{className:"section-title",children:["üìä ÂåÖÂê´ÈîÄÂîÆÊòéÁªÜ (",b.includedSales.length," Á¨î)"]}),e.jsxs("table",{className:"sales-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Seller"}),e.jsx("th",{children:"ÈîÄÂîÆÊó•Êúü"}),e.jsx("th",{children:"ÈáëÈ¢ù"})]})}),e.jsx("tbody",{children:b.includedSales.map((f,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:f.sellerName}),e.jsx("td",{children:f.salesDate}),e.jsx("td",{children:j(f.amount)})]},x))})]})]})]})})})]},b.id))})]})})]})},Cr=()=>{const{orgEventCode:t}=ht(),o=_e(),{currentUser:s,userProfile:n,loading:a,logout:c}=lt(),{organizationId:d,eventId:g,loading:i,error:I}=zt();r.useEffect(()=>{const A=document.getElementById("root"),z=A?.style.maxWidth,M=A?.style.padding,E=A?.style.textAlign,X=A?.style.margin;return A&&(A.style.maxWidth="100%",A.style.padding="0",A.style.textAlign="center",A.style.margin="0"),()=>{A&&(A.style.maxWidth=z||"1280px",A.style.padding=M||"2rem",A.style.textAlign=E||"center",A.style.margin=X||"0 auto")}},[]);const j=(A,z,M)=>{let E;const X=new Promise((te,W)=>{E=setTimeout(()=>W(new Error(`ËØ∑Ê±ÇË∂ÖÊó∂Ôºà${z}msÔºâÔºö${M}`)),z)});return Promise.race([A,X]).finally(()=>{E&&clearTimeout(E)})},m=async()=>{const A=s||we.currentUser;if(!A)throw new Error("Áî®Êà∑Êú™ÁôªÂΩï");return A.getIdToken(!0)},C=async(A,z,M=12e3)=>{const E=it(dt,A);try{return await j(E(z),M,A)}catch(X){const te=X?.code||"",W=X?.message||"";if(!(te==="functions/unauthenticated"||te==="unauthenticated"||/unauthenticated/i.test(W)||/Áî®Êà∑Êú™ÁôªÂΩï/.test(W)))throw X;const q=await m(),pe=`/api/${A}`,L=await j(fetch(pe,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${q}`},body:JSON.stringify({data:z})}),M,`${A} (fetch fallback)`),F=await L.text();let O;try{O=F?JSON.parse(F):null}catch{O=null}if(!L.ok){const G=O?.error?.message||O?.message||F||`HTTP ${L.status}`;throw new Error(G)}return{data:O?.result}}},[w,h]=r.useState("overview"),[R,B]=r.useState(!0),[k,D]=r.useState(null),[T,y]=r.useState(null),[b,f]=r.useState([]),[x,l]=r.useState([]),[p,u]=r.useState({cashStats:{totalCollected:0,todayCollected:0,thisWeekCollected:0,thisMonthCollected:0,totalCollections:0,todayCollections:0},pendingStats:{pendingAmount:0,pendingCount:0}}),[N,v]=t?.split("-")||[],P=async()=>{if(window.confirm("Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü"))try{await c(),o(`/login/${t}`)}catch(z){console.error("ÈÄÄÂá∫ÁôªÂΩïÂ§±Ë¥•:",z),alert("ÈÄÄÂá∫ÁôªÂΩïÂ§±Ë¥•: "+z.message)}};r.useEffect(()=>{if(a||i)return;if(I){D(I),B(!1);return}if(!s){o(`/login/${t}`);return}if(!N||!v){D("Êó†ÊïàÁöÑÊ¥ªÂä®‰ª£Á†Å"),B(!1);return}if(!(n?.roles||[]).includes("cashier")){D("ÊÇ®Ê≤°ÊúâÊùÉÈôêËÆøÈóÆÊ≠§È°µÈù¢"),B(!1);return}_()},[a,i,I,s,n,N,v,t,o]);const _=async()=>{try{B(!0),await m();const A=n?.organizationId||d,z=n?.eventId||g;if(!A||!z){D("Êó†Ê≥ïËé∑ÂèñÊ¥ªÂä®‰ø°ÊÅØÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),B(!1);return}const M=await C("getCashierStats",{orgId:A,eventId:z},12e3);if(M.data.success){const E=M.data.data;y(E),u({cashStats:E.cashStats||{},pendingStats:E.pendingStats||{}})}B(!1)}catch(A){console.error("Âä†ËΩΩË¥¢Âä°Êï∞ÊçÆÂ§±Ë¥•:",A),console.log("‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ..."),y({basicInfo:{name:n?.basicInfo?.chineseName||n?.basicInfo?.englishName||"Ë¥¢Âä°ÁªèÁêÜ"}}),B(!1)}};r.useEffect(()=>{const A=n?.organizationId||d,z=n?.eventId||g;if(!A||!z)return;const M=Ie(re,"organizations",A,"events",z,"cashSubmissions"),E=De(M,be("status","==","pending"),be("receivedBy","==",null),tt("submittedAt","asc")),X=rt(E,te=>{const W=te.docs.map(q=>({id:q.id,...q.data()}));f(W);const U=W.reduce((q,pe)=>q+(pe.amount||0),0);u(q=>({...q,pendingStats:{...q.pendingStats,pendingAmount:U,pendingCount:W.length}}))},te=>{console.error("ÁõëÂê¨ÂæÖËÆ§È¢ÜËÆ∞ÂΩïÂ§±Ë¥•:",te)});return()=>X()},[n?.organizationId,n?.eventId,d,g]),r.useEffect(()=>{const A=n?.organizationId||d,z=n?.eventId||g;if(!A||!z)return;const M=Ie(re,"organizations",A,"events",z,"cashSubmissions"),E=De(M,tt("submittedAt","desc")),X=rt(E,te=>{const W=te.docs.map(U=>({id:U.id,...U.data()}));l(W)},te=>{console.error("ÁõëÂê¨Êî∂Ê¨æËÆ∞ÂΩïÂ§±Ë¥•:",te)});return()=>X()},[n?.organizationId,n?.eventId,d,g]);const H=async(A,z,M)=>{try{await m();const E=n?.organizationId||d,X=n?.eventId||g;if(!E||!X)throw new Error("Êó†Ê≥ïËé∑ÂèñÊ¥ªÂä®‰ø°ÊÅØ");return(await C("claimAndConfirmCashSubmission",{orgId:E,eventId:X,submissionId:A,transactionPin:z,confirmationNote:M||""},15e3)).data.success?(await _(),!0):!1}catch(E){throw console.error("Êé•ÂçïÁ°ÆËÆ§Â§±Ë¥•:",E),E}};return R?e.jsxs("div",{className:"fm-loading-container",children:[e.jsx("div",{className:"fm-spinner"}),e.jsx("p",{children:"Âä†ËΩΩ‰∏≠..."})]}):k?e.jsxs("div",{className:"fm-error-container",children:[e.jsx("p",{className:"fm-error-message",children:k}),e.jsx("button",{className:"fm-button",onClick:()=>o(`/login/${t}`),children:"ËøîÂõûÁôªÂΩï"})]}):e.jsxs("div",{className:"fm-container",children:[e.jsxs("header",{className:"fm-header",children:[e.jsxs("div",{className:"fm-header-left",children:[e.jsx("h1",{className:"fm-title",children:"üí∞ Ë¥¢Âä°ÁÆ°ÁêÜ"}),e.jsxs("p",{className:"fm-welcome-text",children:["Ê¨¢ËøéÔºå",T?.basicInfo?.name||n?.basicInfo?.chineseName||n?.basicInfo?.englishName||"Êî∂Èì∂Âëò"]})]}),e.jsxs("div",{className:"fm-header-right",children:[e.jsx("span",{className:"fm-date",children:new Date().toLocaleDateString("zh-CN")}),e.jsx("button",{className:"fm-logout-button",onClick:P,children:"üö™ ÈÄÄÂá∫ÁôªÂΩï"})]})]}),e.jsxs("nav",{className:"fm-tab-nav",children:[e.jsxs("button",{className:`fm-tab-button ${w==="overview"?"fm-tab-button-active":""}`,onClick:()=>h("overview"),children:[e.jsx("span",{className:"fm-tab-icon",children:"üìä"}),e.jsx("span",{children:"Êî∂Ê¨æÊ¶ÇËßà"})]}),e.jsxs("button",{className:`fm-tab-button ${w==="history"?"fm-tab-button-active":""}`,onClick:()=>h("history"),children:[e.jsx("span",{className:"fm-tab-icon",children:"üìã"}),e.jsx("span",{children:"Êî∂Ê¨æËÆ∞ÂΩï"}),x.length>0&&e.jsx("span",{className:"fm-badge",children:x.length})]})]}),e.jsxs("main",{className:"fm-content",children:[w==="overview"&&e.jsx(vr,{pendingSubmissions:b,statistics:p,onClaim:H,onRefresh:_,currentUser:s}),w==="history"&&e.jsx(Sr,{submissions:x,onRefresh:_})]})]})};function un(){const{userProfile:t}=lt(),[o,s]=r.useState(null),[n,a]=r.useState(!0),[c,d]=r.useState(null);return r.useEffect(()=>{if(console.log("=== useSellerStats Debug ==="),console.log("1. userProfile:",t),console.log("2. organizationId:",t?.organizationId),console.log("3. eventId:",t?.eventId),console.log("4. userId:",t?.userId),!t?.organizationId||!t?.eventId||!t?.userId){console.warn("[useSellerStats] ‚ö†Ô∏è Áº∫Â∞ëÂøÖË¶ÅÂ≠óÊÆµÔºåÂÅúÊ≠¢ÁõëÂê¨"),console.warn("[useSellerStats] userProfile:",t),a(!1);return}const g=`organizations/${t.organizationId}/events/${t.eventId}/users/${t.userId}`;console.log("5. Firestore Ë∑ØÂæÑ:",g);const i=ke(re,g);console.log("[useSellerStats] üî• ÂºÄÂßãÁõëÂê¨ Firestore...");const I=rt(i,j=>{if(console.log("=== Firestore Snapshot Êî∂Âà∞ ==="),console.log("6. Document exists:",j.exists()),j.exists()){const m=j.data();console.log("7. ÂÆåÊï¥ÊñáÊ°£Êï∞ÊçÆ:",m),console.log("8. seller ÂØπË±°:",m.seller),console.log("9. seller Â≠óÊÆµÂàóË°®:",m.seller?Object.keys(m.seller):"N/A");const C=m.seller||null;console.log("10. ËÆæÁΩÆ stats ‰∏∫:",C),s(C),d(null)}else console.error("[useSellerStats] ‚ùå Áî®Êà∑ÊñáÊ°£‰∏çÂ≠òÂú®ÔºÅ"),s(null),d("Áî®Êà∑Êï∞ÊçÆ‰∏çÂ≠òÂú®");console.log("11. ËÆæÁΩÆ loading = false"),a(!1),console.log("================================")},j=>{console.error("=== Firestore ÈîôËØØ ==="),console.error("Error:",j),console.error("Error message:",j.message),console.error("Error code:",j.code),console.error("======================"),d(j.message),a(!1)});return()=>{console.log("[useSellerStats] üîö ÂÅúÊ≠¢ÁõëÂê¨ Firestore"),I()}},[t]),console.log("=== useSellerStats ËøîÂõûÂÄº ==="),console.log("stats:",o),console.log("loading:",n),console.log("error:",c),console.log("============================"),{stats:o,loading:n,error:c}}function wr(){const{stats:t,loading:o,error:s}=un(),{userProfile:n}=lt();console.log("=== PointsOverview Debug ==="),console.log("1. Loading:",o),console.log("2. Error:",s),console.log("3. Stats:",t),console.log("4. Stats type:",typeof t),console.log("5. Stats is null:",t===null),console.log("6. Stats is undefined:",t===void 0),console.log("7. Stats keys:",t?Object.keys(t):"N/A"),console.log("8. availablePoints:",t?.availablePoints),console.log("============================");const a=n?.identityTag||n?.identityInfo?.identityTag,c=a==="student"||a==="students";return console.log("[PointsOverview] Áî®Êà∑Á±ªÂûã:",{identityTag:a,isStudent:c}),o?(console.log("[PointsOverview] ÊòæÁ§∫Âä†ËΩΩ‰∏≠..."),e.jsx("div",{className:"points-overview",children:e.jsx("div",{className:"loading-message",children:"Âä†ËΩΩ‰∏≠..."})})):s?(console.log("[PointsOverview] ÊòæÁ§∫ÈîôËØØ:",s),e.jsx("div",{className:"points-overview",children:e.jsxs("div",{className:"error-message",children:["ÈîôËØØ: ",s]})})):t?(console.log("[PointsOverview] Ê∏≤ÊüìÊ≠£Â∏∏ÁïåÈù¢ÔºåavailablePoints:",t.availablePoints),e.jsxs("div",{className:"points-overview",children:[e.jsxs("div",{className:"card points-card",children:[e.jsx("h2",{className:"card-title",children:"üí∞ ÊàëÁöÑÁÇπÊï∞"}),e.jsxs("div",{className:"balance-display",children:[e.jsx("span",{className:"balance-amount",children:t.availablePoints||0}),e.jsx("span",{className:"balance-unit",children:"ÁÇπ"})]}),e.jsx("div",{className:"sub-info",children:"ÂèØÁî®‰∫éÈîÄÂîÆÁªôÂÆ¢Êà∑"}),e.jsxs("div",{className:"sales-stats",children:[e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{className:"stat-label",children:"Á¥ØËÆ°ÂîÆÂá∫"}),e.jsxs("span",{className:"stat-value",children:[t.totalPointsSold||0," ÁÇπ"]})]}),e.jsxs("div",{className:"stat-row",children:[e.jsx("span",{className:"stat-label",children:"Á¥ØËÆ°ÈîÄÂîÆÈ¢ù"}),e.jsxs("span",{className:"stat-value",children:["RM ",t.totalRevenue||0]})]})]})]}),e.jsxs("div",{className:"card cash-card",children:[e.jsx("h2",{className:"card-title",children:"üíµ Áé∞ÈáëÁä∂ÊÄÅ"}),e.jsxs("div",{className:"cash-summary",children:[e.jsxs("div",{className:"cash-item highlight",children:[e.jsx("span",{className:"cash-label",children:"Êâã‰∏äÁé∞Èáë"}),e.jsxs("span",{className:"cash-amount",children:["RM ",t.pendingCollection||0]}),e.jsx("small",{className:"cash-hint",children:c?"ÂæÖ‰∏ä‰∫§Áªô Seller Manager":"ÂæÖ‰∏ä‰∫§Áé∞Èáë"})]}),e.jsx("div",{className:"cash-divider"}),e.jsxs("div",{className:"cash-item",children:[e.jsx("span",{className:"cash-label",children:"Á¥ØËÆ°Êî∂Âà∞Áé∞Èáë"}),e.jsxs("span",{className:"cash-amount secondary",children:["RM ",t.totalCashCollected||0]})]})]}),(t.pendingCollection||0)>0&&e.jsxs("div",{className:"collection-reminder",children:[e.jsx("span",{className:"reminder-icon",children:"üí°"}),e.jsx("span",{className:"reminder-text",children:c?"ËÆ∞Âæó‰∏ä‰∫§Áé∞ÈáëÁªô Seller Manager":"ËÆ∞Âæó‰∏ä‰∫§Áé∞Èáë"})]})]})]})):(console.log('[PointsOverview] Stats ÊòØ null/undefinedÔºåÊòæÁ§∫"Êó†Êï∞ÊçÆ"'),e.jsx("div",{className:"points-overview",children:e.jsx("div",{className:"no-data-message",children:"Êó†Êï∞ÊçÆ"})}))}function Nr(){const{userProfile:t}=lt(),{organizationId:o,eventId:s}=zt(),{stats:n,loading:a}=un(),[c,d]=r.useState(""),[g,i]=r.useState(""),[I,j]=r.useState(null),[m,C]=r.useState(!1),[w,h]=r.useState(null),[R,B]=r.useState(null),k=async()=>{if(!c.trim()){h("ËØ∑ËæìÂÖ•ÂÆ¢Êà∑ÊâãÊú∫Âè∑Á†Å");return}if(!o||!s){h("Êó†Ê≥ïËé∑ÂèñÁªÑÁªáÊàñÊ¥ªÂä®‰ø°ÊÅØÔºåËØ∑Âà∑Êñ∞È°µÈù¢");return}C(!0),h(null),B(null);try{console.log("[MakeSale] Êü•ÊâæÂÆ¢Êà∑:",{phone:c.trim(),organizationId:o,eventId:s,currentUserId:t?.userId});const f=Ie(re,`organizations/${o}/events/${s}/users`),x=De(f,be("basicInfo.phoneNumber","==",c.trim()));console.log("[MakeSale] ÊâßË°åÊü•ËØ¢...");const l=await Xe(x);if(console.log("[MakeSale] Êü•ËØ¢ÁªìÊûú:",l.size,"‰∏™ÊñáÊ°£"),l.empty){h("Êâæ‰∏çÂà∞ËØ•ÊâãÊú∫Âè∑Á†ÅÁöÑÁî®Êà∑ÔºåËØ∑Ê£ÄÊü•ÊòØÂê¶Ê≠£Á°Æ"),j(null);return}const p=l.docs.filter(P=>{const _=P.data();return _.roles&&_.roles.includes("customer")});if(console.log("[MakeSale] ËøáÊª§ÂêéÁöÑÂÆ¢Êà∑:",p.length,"‰∏™"),p.length===0){h("ËØ•Áî®Êà∑‰∏çÊòØÂÆ¢Êà∑ËßíËâ≤ÔºåÊó†Ê≥ïËøõË°åÈîÄÂîÆ"),j(null);return}const u=p[0],N={id:u.id,...u.data()},v=N.customer?.pointsAccount?.availablePoints||0;console.log("[MakeSale] ÊâæÂà∞ÂÆ¢Êà∑:",{id:N.id,name:N.basicInfo?.chineseName||N.basicInfo?.englishName,currentPoints:v}),j(N),h(null)}catch(f){console.error("[MakeSale] Êü•ÊâæÂÆ¢Êà∑Â§±Ë¥•:",f),console.error("[MakeSale] ÈîôËØØËØ¶ÊÉÖ:",{code:f.code,message:f.message,stack:f.stack}),f.code==="permission-denied"?h("ÊùÉÈôê‰∏çË∂≥ÔºåÊó†Ê≥ïÊü•ËØ¢Áî®Êà∑Êï∞ÊçÆ„ÄÇËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÊ£ÄÊü• Security Rules„ÄÇ"):f.message.includes("index")?h("Êï∞ÊçÆÂ∫ìÁ¥¢ÂºïÁº∫Â§±ÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÂàõÂª∫ÂøÖË¶ÅÁöÑÁ¥¢Âºï„ÄÇ"):h(`Êü•ÊâæÂ§±Ë¥•: ${f.message}`),j(null)}finally{C(!1)}},D=async()=>{if(!I||!g){h("ËØ∑ÂÆåÊàêÊâÄÊúâÂ≠óÊÆµ");return}if(!o||!s||!t?.userId){h("Êó†Ê≥ïËé∑ÂèñÁªÑÁªá„ÄÅÊ¥ªÂä®ÊàñÁî®Êà∑‰ø°ÊÅØÔºåËØ∑Âà∑Êñ∞È°µÈù¢");return}const f=parseInt(g);if(isNaN(f)||f<=0){h("ÈáëÈ¢ùÂøÖÈ°ªÂ§ß‰∫é 0");return}if(b<f){h(`ÊÇ®ÁöÑÁÇπÊï∞Â∫ìÂ≠ò‰∏çË∂≥ÔºÅÂΩìÂâçÂ∫ìÂ≠ò: ${b} ÁÇπ`);return}C(!0),h(null),B(null);try{console.log("[MakeSale] ÂºÄÂßãÈîÄÂîÆ:",{sellerId:t.userId,sellerBalance:b,customerId:I.id,saleAmount:f});const x=ke(Ie(re,`organizations/${o}/events/${s}/transactions`));console.log("[MakeSale] Â∞áÂØ´ÂÖ• transaction Ë∑ØÂæë:",x.path);const l={transactionId:x.id,organizationId:o,eventId:s,type:"seller_to_customer",sellerId:t.userId,sellerName:t.basicInfo?.chineseName||t.basicInfo?.englishName||"Unknown",customerId:I.id,customerName:I.basicInfo?.chineseName||I.basicInfo?.englishName||"Unknown",points:f,amount:f,paymentMethod:"cash",status:"completed",timestamp:et(),createdAt:et()};try{await ws(x,l),console.log("[MakeSale] ‚úÖ ‰∫§ÊòìÂØ´ÂÖ•ÊàêÂäü")}catch(P){console.error("[MakeSale] ‚ùå ‰∫§ÊòìÂØ´ÂÖ•Â§±Êïó:",P),h("‰∫§ÊòìÂª∫Á´ãÂ§±Êïó: "+(P.message||"Êú™Áü•ÈåØË™§")),C(!1);return}const p=ke(re,`organizations/${o}/events/${s}/users/${t.userId}`);console.log("[MakeSale] Â∞áÊõ¥Êñ∞ seller Ë∑ØÂæë:",p.path);const u={"seller.availablePoints":pt(-f),"seller.totalPointsSold":pt(f),"seller.totalRevenue":pt(f),"seller.totalCashCollected":pt(f),"seller.pendingCollection":pt(f),updatedAt:et()};try{await Et(p,u),console.log("[MakeSale] ‚úÖ Seller Êõ¥Êñ∞ÊàêÂäü")}catch(P){console.error("[MakeSale] ‚ùå Seller Êõ¥Êñ∞Â§±Êïó:",P),h("Êõ¥Êñ∞ Seller Â§±Êïó: "+(P.message||"Êú™Áü•ÈåØË™§")),C(!1);return}const N=ke(re,`organizations/${o}/events/${s}/users/${I.id}`);console.log("[MakeSale] Â∞áÊõ¥Êñ∞ customer Ë∑ØÂæë:",N.path);const v={"customer.pointsAccount.availablePoints":pt(f),"customer.pointsAccount.totalReceived":pt(f),updatedAt:et()};try{await Et(N,v),console.log("[MakeSale] ‚úÖ Customer Êõ¥Êñ∞ÊàêÂäü")}catch(P){console.error("[MakeSale] ‚ùå Customer Êõ¥Êñ∞Â§±Êïó:",P),h("Êõ¥Êñ∞ Customer Â§±Êïó: "+(P.message||"Êú™Áü•ÈåØË™§")),C(!1);return}console.log("[MakeSale] ‚úÖ Èä∑ÂîÆ‰∏âÊ≠•È©üÂÖ®ÈÉ®ÊàêÂäü"),B(`ÈîÄÂîÆÊàêÂäüÔºÅÈáëÈ¢ù: RM ${f}ÔºåÂÆ¢Êà∑Ëé∑Âæó ${f} ÁÇπ`),d(""),i(""),j(null)}catch(x){console.error("[MakeSale] ÈîÄÂîÆÂ§±Ë¥•:",x),console.error("[MakeSale] ÈîôËØØËØ¶ÊÉÖ:",{code:x.code,message:x.message}),x.code==="permission-denied"?h("ÊùÉÈôê‰∏çË∂≥ÔºåÊó†Ê≥ïÂÆåÊàêÈîÄÂîÆ„ÄÇËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÊ£ÄÊü• Security Rules„ÄÇ"):h(`ÈîÄÂîÆÂ§±Ë¥•: ${x.message}`)}finally{C(!1)}},T=f=>{f.key==="Enter"&&k()},y=f=>{f.key==="Enter"&&D()},b=n?.availablePoints||0;return a?e.jsx("div",{className:"make-sale",children:e.jsx("div",{className:"loading-message",children:"Âä†ËΩΩÂ∫ìÂ≠òÊï∞ÊçÆ‰∏≠..."})}):e.jsxs("div",{className:"make-sale",children:[e.jsx("h2",{className:"section-title",children:"üõí ÈîÄÂîÆÁÇπÊï∞"}),e.jsxs("div",{className:"seller-inventory",children:[e.jsx("div",{className:"inventory-label",children:"ÊÇ®ÁöÑÁÇπÊï∞Â∫ìÂ≠ò"}),e.jsxs("div",{className:"inventory-amount",children:[b," ÁÇπ"]}),e.jsx("div",{className:"inventory-hint",children:"ÂèØÈîÄÂîÆÁªôÂÆ¢Êà∑"})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"customerPhone",children:"ÂÆ¢Êà∑ÊâãÊú∫Âè∑Á†Å"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{id:"customerPhone",type:"tel",value:c,onChange:f=>d(f.target.value),onKeyPress:T,placeholder:"60123456789",disabled:m}),e.jsx("button",{onClick:k,disabled:m||!c.trim(),className:"search-button",children:m?"Êü•Êâæ‰∏≠...":"Êü•ÊâæÂÆ¢Êà∑"})]}),e.jsx("small",{className:"hint",children:"È©¨Êù•Ë•ø‰∫öÊâãÊú∫Âè∑ÔºàÂê´ÂõΩÂÆ∂‰ª£Á†Å60Ôºâ"})]}),I&&e.jsxs("div",{className:"customer-info success-box",children:[e.jsxs("div",{className:"customer-name",children:["‚úì ÊâæÂà∞ÂÆ¢Êà∑: ",e.jsx("strong",{children:I.basicInfo?.chineseName||I.basicInfo?.englishName})]}),e.jsxs("div",{className:"customer-balance",children:["ÂÆ¢Êà∑ÂΩìÂâçÁÇπÊï∞: ",e.jsx("strong",{children:I.customer?.pointsAccount?.availablePoints||0})," ÁÇπ"]})]}),I&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"amount",children:"ÈîÄÂîÆÈáëÈ¢ù (ÁÇπÊï∞)"}),e.jsxs("div",{className:"amount-input-wrapper",children:[e.jsx("input",{id:"amount",type:"number",value:g,onChange:f=>i(f.target.value),onKeyPress:y,placeholder:"100",min:"1",max:b,disabled:m}),e.jsxs("span",{className:"input-suffix",children:["ÁÇπ = RM ",g||0]})]}),g&&e.jsx("div",{className:"balance-check",children:parseInt(g)<=b?e.jsxs("span",{className:"balance-ok",children:["‚úì Â∫ìÂ≠òÂÖÖË∂≥ (Ââ©‰Ωô ",b-parseInt(g)," ÁÇπ)"]}):e.jsxs("span",{className:"balance-insufficient",children:["‚úó Â∫ìÂ≠ò‰∏çË∂≥ÔºÅÊÇ®Âè™Êúâ ",b," ÁÇπÂèØÈîÄÂîÆ"]})}),e.jsxs("small",{className:"hint",children:["ÂÆ¢Êà∑ÊîØ‰ªò RM ",g||0," Áé∞ÈáëÔºåËé∑Âæó ",g||0," ÁÇπ"]})]}),w&&e.jsxs("div",{className:"error-message",children:["‚ö†Ô∏è ",w]}),R&&e.jsxs("div",{className:"success-message",children:["‚úì ",R]}),I&&g&&e.jsx("button",{onClick:D,disabled:m||parseInt(g)>b,className:"submit-button",children:m?"Â§ÑÁêÜ‰∏≠...":`Á°ÆËÆ§ÈîÄÂîÆ ${g} ÁÇπ (Êî∂Âèñ RM ${g})`})]})]})}function Ir(t=50){const{userProfile:o}=lt(),[s,n]=r.useState([]),[a,c]=r.useState(!0),[d,g]=r.useState(null);return r.useEffect(()=>{if(console.log("[useTransactions] userProfile:",o),!o?.organizationId||!o?.eventId||!o?.userId){console.warn("[useTransactions] Áº∫Â∞ëÂøÖË¶ÅÂ≠óÊÆµ"),c(!1);return}const i=Ie(re,`organizations/${o.organizationId}/events/${o.eventId}/transactions`),I=De(i,be("sellerId","==",o.userId),tt("timestamp","desc"),kt(t));console.log("[useTransactions] ÂºÄÂßãÁõëÂê¨‰∫§ÊòìËÆ∞ÂΩï...");const j=rt(I,m=>{const C=m.docs.map(w=>({id:w.id,...w.data()}));console.log("[useTransactions] Êî∂Âà∞",C.length,"Êù°‰∫§ÊòìËÆ∞ÂΩï"),n(C),g(null),c(!1)},m=>{console.error("[useTransactions] Ëé∑Âèñ‰∫§ÊòìËÆ∞ÂΩïÂ§±Ë¥•:",m),g(m.message),c(!1)});return()=>{console.log("[useTransactions] ÂÅúÊ≠¢ÁõëÂê¨‰∫§ÊòìËÆ∞ÂΩï"),j()}},[o,t]),{transactions:s,loading:a,error:d}}function kr(){const{transactions:t,loading:o,error:s}=Ir();if(o)return e.jsxs("div",{className:"transaction-history",children:[e.jsx("h2",{className:"section-title",children:"üìã ‰∫§ÊòìÂéÜÂè≤"}),e.jsx("div",{className:"loading-message",children:"Âä†ËΩΩ‰∏≠..."})]});if(s)return e.jsxs("div",{className:"transaction-history",children:[e.jsx("h2",{className:"section-title",children:"üìã ‰∫§ÊòìÂéÜÂè≤"}),e.jsxs("div",{className:"error-message",children:["ÈîôËØØ: ",s]})]});const n=d=>{if(!d)return"Êú™Áü•Êó∂Èó¥";const g=d.toDate?d.toDate():new Date(d),i=g.getFullYear(),I=String(g.getMonth()+1).padStart(2,"0"),j=String(g.getDate()).padStart(2,"0"),m=String(g.getHours()).padStart(2,"0"),C=String(g.getMinutes()).padStart(2,"0");return`${i}-${I}-${j} ${m}:${C}`},a=t.reduce((d,g)=>d+(g.points||0),0),c=t.length;return e.jsxs("div",{className:"transaction-history",children:[e.jsx("h2",{className:"section-title",children:"üìã ‰∫§ÊòìÂéÜÂè≤"}),t.length===0?e.jsxs("div",{className:"no-transactions",children:[e.jsx("p",{children:"ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï"}),e.jsx("p",{className:"hint",children:"ÂÆåÊàêÁ¨¨‰∏ÄÁ¨îÈîÄÂîÆÂêéÔºåËÆ∞ÂΩïÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"transactions-list",children:t.map(d=>e.jsxs("div",{className:"transaction-item",children:[e.jsxs("div",{className:"transaction-header",children:[e.jsx("span",{className:"transaction-status completed",children:"üü¢ Â∑≤ÂÆåÊàê"}),e.jsx("span",{className:"transaction-time",children:n(d.timestamp)})]}),e.jsxs("div",{className:"transaction-details",children:[e.jsxs("div",{className:"transaction-customer",children:["ÂÆ¢Êà∑: ",e.jsx("strong",{children:d.customerName||"Êú™Áü•"})]}),e.jsxs("div",{className:"transaction-amount",children:["ÈáëÈ¢ù: ",e.jsxs("strong",{className:"amount-value",children:["RM ",d.points||0]})]})]})]},d.id))}),e.jsxs("div",{className:"transaction-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"ÊÄªÈîÄÂîÆÈ¢ù"}),e.jsxs("span",{className:"summary-value",children:["RM ",a]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"‰∫§ÊòìÊ¨°Êï∞"}),e.jsxs("span",{className:"summary-value",children:[c," Á¨î"]})]})]})]})]})}const Tr=()=>{const{stats:t,error:o}=un(),{userProfile:s,loading:n}=lt(),[a,c]=r.useState([]),[d,g]=r.useState(!0),[i,I]=r.useState(!1),[j,m]=r.useState(!1),[C,w]=r.useState(""),[h,R]=r.useState(""),[B,k]=r.useState(null),[D,T]=r.useState(!1),[y,b]=r.useState(!1),f=s?.organizationId?.replace("organization_","")||"",x=s?.eventId?.replace("event_","")||"",l=s?.userId,p=t?.pendingCollection||0,u=s?.identityTag||s?.identityInfo?.identityTag,N=u==="student"||u==="students",v=s?.identityInfo?.department,P=s?.roles?.includes("seller"),_=!!s&&!!s.roles,H=!!u,A=_&&(!P||H||y);console.log("================================="),console.log("[SellerSubmitCash] üîç Âä†ËΩΩÁä∂ÊÄÅÊ£ÄÊü•:"),console.log("  authLoading:",n),console.log("  userProfileÂ≠òÂú®:",!!s),console.log("  roles:",s?.roles),console.log("  hasSellerRole:",P),console.log("  identityTag:",u),console.log("  hasIdentityTag:",H),console.log("  identityTagTimeout:",y),console.log("  isStudent:",N),console.log("  isUserProfileLoaded:",A),console.log("  department:",v),console.log("  smLoading:",D),console.log("  sellerManager:",B),console.log("================================="),r.useEffect(()=>{if(P&&!H&&!y){console.warn("[SellerSubmitCash] ‚ö†Ô∏è SellerËßíËâ≤‰ΩÜidentityTagÊú™Âä†ËΩΩÔºåÂêØÂä®2ÁßíË∂ÖÊó∂...");const U=setTimeout(()=>{console.warn("[SellerSubmitCash] ‚è∞ identityTagË∂ÖÊó∂ÔºÅÂà§ÂÆö‰∏∫ÈùûÂ≠¶ÁîüËßíËâ≤"),b(!0)},2e3);return()=>clearTimeout(U)}},[P,H,y]),r.useEffect(()=>{if(n||!A){console.log("[SellerSubmitCash] ‚è≥ Á≠âÂæÖ userProfile Âä†ËΩΩ...");return}if(!N){console.log("[SellerSubmitCash] ‚è≠Ô∏è ‰∏çÊòØÂ≠¶ÁîüÔºåË∑≥ËøáSMÊü•Êâæ"),k(null),T(!1);return}if(!f||!x||!v){console.log("[SellerSubmitCash] ‚è≠Ô∏è Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞ÔºåË∑≥ËøáSMÊü•Êâæ:",{orgId:f,eventId:x,department:v}),T(!1);return}(async()=>{T(!0);try{console.log("[SellerSubmitCash] üîç ÂºÄÂßãÊü•ÊâæSellerManager"),console.log("  orgId:",f),console.log("  eventId:",x),console.log("  department:",v);const q=Ie(re,`organizations/${f}/events/${x}/users`),pe=De(q,be("roles","array-contains","sellerManager")),L=await Xe(pe);console.log("[SellerSubmitCash] üìä ÊâæÂà∞",L.size,"‰∏™SellerManager");let F=null;L.forEach(O=>{const G=O.data(),oe=G.sellerManager?.managedDepartments||[];console.log("[SellerSubmitCash] Ê£ÄÊü•SM:",{id:O.id,name:G.basicInfo?.chineseName,managedDepts:oe,matchesDepartment:oe.includes(v)}),oe.includes(v)&&(F={id:O.id,name:G.basicInfo?.chineseName||G.basicInfo?.englishName||"SM"},console.log("[SellerSubmitCash] ‚úÖ ÊâæÂà∞ÁÆ°ÁêÜËÄÖ:",F))}),F?(k(F),console.log("[SellerSubmitCash] ‚úÖ ËÆæÁΩÆsellerManager:",F)):(console.warn("[SellerSubmitCash] ‚ö†Ô∏è Êú™ÊâæÂà∞ÁÆ°ÁêÜ",v,"ÁöÑSellerManager"),k(null))}catch(q){console.error("[SellerSubmitCash] ‚ùå Êü•ÊâæSMÂ§±Ë¥•:",q),k(null)}finally{T(!1)}})()},[n,A,N,f,x,v]),r.useEffect(()=>{if(!f||!x||!l){console.warn("[SellerSubmitCash] ‚ö†Ô∏è Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞:",{orgId:f,eventId:x,sellerId:l}),g(!1);return}console.log("[SellerSubmitCash] üìä ÂºÄÂßãÂä†ËΩΩ‰∏ä‰∫§ËÆ∞ÂΩï...");try{const U=De(Ie(re,`organizations/${f}/events/${x}/cashSubmissions`),be("submittedBy","==",l),be("submitterRole","==","seller"),tt("submittedAt","desc")),q=rt(U,pe=>{const L=[];pe.forEach(F=>{L.push({id:F.id,...F.data()})}),console.log("[SellerSubmitCash] ‚úÖ Âä†ËΩΩÂÆåÊàê:",L.length,"Á¨îËÆ∞ÂΩï"),c(L),g(!1)},pe=>{console.error("[SellerSubmitCash] ‚ùå Âä†ËΩΩÂ§±Ë¥•:",pe),g(!1)});return()=>q()}catch(U){console.error("[SellerSubmitCash] ‚ùå ËÆæÁΩÆÁõëÂê¨Â§±Ë¥•:",U),g(!1)}},[f,x,l]);const z=r.useMemo(()=>{const U=a.reduce((L,F)=>L+(F.amount||0),0),q=a.filter(L=>L.status==="pending"),pe=a.filter(L=>L.status==="confirmed");return{cashOnHand:p,totalSubmitted:U,pendingCount:q.length,pendingAmount:q.reduce((L,F)=>L+(F.amount||0),0),confirmedCount:pe.length,confirmedAmount:pe.reduce((L,F)=>L+(F.amount||0),0)}},[p,a]),M=()=>{if(console.log("[SellerSubmitCash] üîì ÊâìÂºÄ‰∏ä‰∫§Ê®°ÊÄÅÊ°Ü"),p<=0){alert("ÊÇ®ÁõÆÂâçÊ≤°ÊúâÂèØ‰∏ä‰∫§ÁöÑÁé∞Èáë");return}if(N&&!B){alert(`Êú™ÊâæÂà∞ÊÇ®ÁöÑÁè≠Á∫ßÁÆ°ÁêÜËÄÖÔºàSeller ManagerÔºâ„ÄÇ
src\hooks\sellerManager\index.js:5: * import { useSellerManagerStats, useManagedDepartments, useManagedUsers } from '@/hooks/sellerManager';
src\hooks\sellerManager\index.js:8: * import useSellerManagerStats from '@/hooks/sellerManager/useSellerManagerStats';
src\hooks\sellerManager\index.js:11:export { useSellerManagerStats } from './useSellerManagerStats';
src\hooks\sellerManager\index.js:17:  useSellerManagerStats,
src\hooks\sellerManager\useSellerManagerStats.js:2: * useSellerManagerStats Hook
src\hooks\sellerManager\useSellerManagerStats.js:28: * const { smStats, loading, error } = useSellerManagerStats(orgId, eventId, smId);
src\hooks\sellerManager\useSellerManagerStats.js:40:export function useSellerManagerStats(organizationId, eventId, sellerManagerId) {
src\hooks\sellerManager\useSellerManagerStats.js:48:      console.warn('[useSellerManagerStats] Áº∫Â∞ëÂøÖÂ°´ÂèÇÊï∞', {
src\hooks\sellerManager\useSellerManagerStats.js:57:    console.log('[useSellerManagerStats] ÂºÄÂßãÁõëÂê¨ÁªüËÆ°Êï∞ÊçÆ', {
src\hooks\sellerManager\useSellerManagerStats.js:77:          console.log('[useSellerManagerStats] ‚úÖ ÁªüËÆ°Êï∞ÊçÆÊõ¥Êñ∞', data);
src\hooks\sellerManager\useSellerManagerStats.js:82:          console.warn('[useSellerManagerStats] ‚ö†Ô∏è ÁªüËÆ°ÊñáÊ°£‰∏çÂ≠òÂú®');
src\hooks\sellerManager\useSellerManagerStats.js:113:        console.error('[useSellerManagerStats] ‚ùå ÁõëÂê¨ÈîôËØØ', err);
src\hooks\sellerManager\useSellerManagerStats.js:121:      console.log('[useSellerManagerStats] ÂÅúÊ≠¢ÁõëÂê¨');
src\hooks\sellerManager\useSellerManagerStats.js:151: *   const { smStats, loading, error } = useSellerManagerStats(
src\hooks\sellerManager\useSellerManagerStats.js:165:export default useSellerManagerStats;

